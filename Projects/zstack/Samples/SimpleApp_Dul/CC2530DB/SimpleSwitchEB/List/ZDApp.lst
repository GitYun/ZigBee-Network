###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Jan/2016  17:30:29 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\Work Codes\ZigBee\Network\Components\stack\zdo\ #
#                          ZDApp.c                                            #
#    Command line       =  -f "E:\Work Codes\ZigBee\Network\Projects\zstack\S #
#                          amples\SimpleApp_Dul\CC2530DB\..\..\..\Tools\CC253 #
#                          0DB\f8wEndev.cfg" (-DCPU32MHZ -DROOT=__near_func   #
#                          -DBLINK_LEDS) -f "E:\Work                          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfi #
#                          g.cfg" (-DSECURE=0 -DZG_SECURE_DYNAMIC=0           #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFC                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "E:\Work Codes\ZigBee\Network\Components\stack\zdo #
#                          \ZDApp.c" -D NWK_AUTO_POLL -D HOLD_AUTO_START -D   #
#                          REFLECTOR -D POWER_SAVING -D NV_INIT -D            #
#                          xNV_RESTORE -D xZTOOL_P1 -D xMT_TASK -D            #
#                          xMT_SYS_FUNC -D xMT_SAPI_FUNC -D xMT_SAPI_CB_FUNC  #
#                          -D LCD_SUPPORTED=DEBUG -D LCD_SUPPORTED -lC        #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\SimpleApp_Dul\CC2530DB\SimpleSwitchEB\List\"   #
#                          -lA "E:\Work Codes\ZigBee\Network\Projects\zstack\ #
#                          Samples\SimpleApp_Dul\CC2530DB\SimpleSwitchEB\List #
#                          \" --diag_suppress Pe001,Pa010 -o "E:\Work         #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\SimpleSwitchEB\Obj\" -e --debug  #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "E:\Work                   #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\" -I "E:\Work                    #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\SOURCE\" -I "E:\Work          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I     #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\SimpleApp_Dul\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\MT\" -I "E:\Work Codes\ZigBee\Network\Projects\ #
#                          zstack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\ #
#                          ..\COMPONENTS\HAL\INCLUDE\" -I "E:\Work            #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TA #
#                          RGET\CC2530EB\" -I "E:\Work                        #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\M #
#                          CU\CCSOC\" -I "E:\Work Codes\ZigBee\Network\Projec #
#                          ts\zstack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\ #
#                          ..\..\COMPONENTS\OSAL\INCLUDE\" -I "E:\Work        #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ #
#                          AF\" -I "E:\Work Codes\ZigBee\Network\Projects\zst #
#                          ack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\STACK\NWK\" -I "E:\Work                 #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ #
#                          SEC\" -I "E:\Work Codes\ZigBee\Network\Projects\zs #
#                          tack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SAPI\" -I "E:\Work               #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ #
#                          SYS\" -I "E:\Work Codes\ZigBee\Network\Projects\zs #
#                          tack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "E:\Work                #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F #
#                          8W\" -I "E:\Work Codes\ZigBee\Network\Projects\zst #
#                          ack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\..\ #
#                          COMPONENTS\ZMAC\" -I "E:\Work                      #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\SERVIC #
#                          ES\SADDR\" -I "E:\Work Codes\ZigBee\Network\Projec #
#                          ts\zstack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\ #
#                          ..\..\COMPONENTS\SERVICES\SDATA\" -I "E:\Work      #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\IN #
#                          CLUDE\" -I "E:\Work Codes\ZigBee\Network\Projects\ #
#                          zstack\Samples\SimpleApp_Dul\CC2530DB\..\..\..\..\ #
#                          ..\COMPONENTS\MAC\HIGH_LEVEL\" -I "E:\Work         #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LO #
#                          W_LEVEL\srf04\" -I "E:\Work                        #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\Simpl #
#                          eApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LO #
#                          W_LEVEL\srf04\SINGLE_CHIP\" -Ohz                   #
#                          --require_prototypes                               #
#    List file          =  E:\Work Codes\ZigBee\Network\Projects\zstack\Sampl #
#                          es\SimpleApp_Dul\CC2530DB\SimpleSwitchEB\List\ZDAp #
#                          p.lst                                              #
#    Object file        =  E:\Work Codes\ZigBee\Network\Projects\zstack\Sampl #
#                          es\SimpleApp_Dul\CC2530DB\SimpleSwitchEB\Obj\ZDApp #
#                          .r51                                               #
#                                                                             #
#                                                                             #
###############################################################################

E:\Work Codes\ZigBee\Network\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-01-04 12:16:55 -0800 (Mon, 04 Jan 2010) $
      4            Revision:       $Revision: 21428 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          /* HAL */
     69          #include "hal_led.h"
     70          #include "hal_lcd.h"
     71          #include "hal_key.h"
     72          
     73          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     74            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     75          #endif
     76          /*********************************************************************
     77           * MACROS
     78           */
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          #if !defined( NWK_START_DELAY )
     84            #define NWK_START_DELAY             100   // in milliseconds
     85          #endif
     86          
     87          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     88            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     89          #endif
     90          
     91          #if !defined( BEACON_REQUEST_DELAY )
     92            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     93          #endif
     94          
     95          #if !defined( BEACON_REQ_DELAY_MASK )
     96            #define BEACON_REQ_DELAY_MASK       0x007F
     97          #endif
     98          
     99          #define MAX_RESUME_RETRY            3
    100          
    101          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    102          
    103          // Beacon Order Settings (see NLMEDE.h)
    104          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS // 15
    105          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER    // 15
    106          
    107          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    108            // The number of times the frame counter can change before
    109            // saving to NV
    110            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    111          #endif
    112          
    113          // Leave control bits
    114          #define ZDAPP_LEAVE_CTRL_INIT 0
    115          #define ZDAPP_LEAVE_CTRL_SET  1
    116          #define ZDAPP_LEAVE_CTRL_RA   2
    117          
    118          // Standard time to update NWK NV data
    119          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    120          
    121          // Address Manager Stub Implementation
    122          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    123          
    124          // Size of the ZDO callback function table zdoCBFunc[]
    125          #define MAX_ZDO_CB_FUNC 1
    126          
    127          
    128          /*********************************************************************
    129           * GLOBAL VARIABLES
    130           */
    131          
    132          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    134          #endif
    135          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    136          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    137          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    138          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    139          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    147          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    150          
    151          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    155          
    156          /*********************************************************************
    157           * EXTERNAL VARIABLES
    158           */
    159          
    160          /*********************************************************************
    161           * EXTERNAL FUNCTIONS
    162           */
    163          
    164          /*********************************************************************
    165           * LOCAL FUNCTIONS
    166           */
    167          
    168          void ZDApp_NetworkStartEvt( void );
    169          void ZDApp_DeviceAuthEvt( void );
    170          void ZDApp_SaveNetworkStateEvt( void );
    171          
    172          uint8 ZDApp_ReadNetworkRestoreState( void );
    173          uint8 ZDApp_RestoreNetworkState( void );
    174          void ZDAppDetermineDeviceType( void );
    175          void ZDApp_InitUserDesc( void );
    176          void ZDAppCheckForHoldKey( void );
    177          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    178          void ZDApp_ProcessNetworkJoin( void );
    179          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    180          void ZDApp_SaveNwkKey( void );
    181          uint8 ZDApp_RestoreNwkKey( void );
    182            
    183          void ZDApp_SecInit( uint8 state );
    184          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    185          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    186          
    187          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    188          
    189          void ZDApp_ResetTimerStart( uint16 delay );
    190          void ZDApp_ResetTimerCancel( void );
    191          void ZDApp_LeaveCtrlInit( void );
    192          void ZDApp_LeaveCtrlSet( uint8 ra );
    193          uint8 ZDApp_LeaveCtrlBypass( void );
    194          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    195          void ZDApp_LeaveReset( uint8 ra );
    196          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    197                                  uint8 removeChildren );
    198          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    199          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    200          void ZDApp_RegisterCBs( void );
    201          
    202          /*********************************************************************
    203           * LOCAL VARIABLES
    204           */
    205          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    206          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    207          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    210          
    211          #if defined( HOLD_AUTO_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    212            devStates_t devState = DEV_HOLD;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    213          #else
    214            devStates_t devState = DEV_INIT;
    215          #endif
    216          
    217          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    218            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    219            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    220                                  // to parent. Set to make the device do an Orphan scan.
    221          #else
    222            // Set the default to coodinator
    223            devStartModes_t devStartMode = MODE_HARD; // 枚举量
    224          #endif
    225          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    226          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    227          
    228          // 端点0，每个 ZigBee 设备必须使用的端点，用于寻址所有活动端点

   \                                 In  segment XDATA_I, align 1, keep-with-next
    229          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    230          {
    231            ZDO_EP,   // endPoint, 0
    232            &ZDAppTaskID, // task_id, 是 osalInitTasks() 中分配的任务ID
    233            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    234            (afNetworkLatencyReq_t)0            // No Network Latency req
    235          };
    236          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    237          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    238          
    239          /*********************************************************************
    240           * @fn      ZDApp_Init
    241           *
    242           * @brief   ZDApp Initialization function.
    243           *
    244           * @param   task_id - ZDApp Task ID
    245           *
    246           * @return  None
    247           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    248          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    249          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    250            // Save the task ID
    251            ZDAppTaskID = task_id;
   \   000006   90....       MOV     DPTR,#ZDAppTaskID
   \   000009   F0           MOVX    @DPTR,A
    252          
    253            // Initialize the ZDO global device short address storage
    254            ZDAppNwkAddr.addrMode = Addr16Bit;    // 2, enum
   \   00000A   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    255            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;  // 0xFFFE
   \   000010   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000013   74FE         MOV     A,#-0x2
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   04           INC     A
   \   000018   F0           MOVX    @DPTR,A
    256            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    257          
    258            // Check for manual "Hold Auto Start"
    259            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    260          
    261            // Initialize ZDO items and setup the device - type of device to create.
    262            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    263          
    264            // Register the endpoint description with the AF
    265            // This task doesn't have a Simple description, but we still need
    266            // to register the endpoint.
    267            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000024   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000026   12....       LCALL   ??afRegister?relay
    268          
    269          #if defined( ZDO_USERDESC_RESPONSE )
    270            ZDApp_InitUserDesc();
    271          #endif // ZDO_USERDESC_RESPONSE
    272          
    273            // Start the device?
    274            if ( devState != DEV_HOLD )
   \   000029   90....       MOV     DPTR,#devState
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   6009         JZ      ??ZDApp_Init_0
    275            {
    276              ZDOInitDevice( 0 );
   \   00002F                ; Setup parameters for call to function ZDOInitDevice
   \   00002F   7A00         MOV     R2,#0x0
   \   000031   7B00         MOV     R3,#0x0
   \   000033   12....       LCALL   ??ZDOInitDevice?relay
   \   000036   800D         SJMP    ??ZDApp_Init_1
    277            }
    278            else
    279            {
    280              // Blink LED to indicate HOLD_START
    281              HalLedBlink ( HAL_LED_4, 5, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   000038                ; Setup parameters for call to function HalLedBlink
   \   000038   7CF4         MOV     R4,#-0xc
   \   00003A   7D01         MOV     R5,#0x1
   \   00003C   7B32         MOV     R3,#0x32
   \   00003E   7A05         MOV     R2,#0x5
   \   000040   7908         MOV     R1,#0x8
   \   000042   12....       LCALL   ??HalLedBlink?relay
    282            }
    283            
    284            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000045                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000045   12....       LCALL   ??ZDApp_RegisterCBs?relay
    285          } /* ZDApp_Init() */
   \   000048   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    286          
    287          /*********************************************************************
    288           * @fn          ZDApp_SecInit
    289           *
    290           * @brief       ZDApp initialize security.
    291           *
    292           * @param       state - device initialization state
    293           *
    294           * @return      none
    295           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    296          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    297          {  
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    298            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    299            {
    300              // Set the Trust Center bit
    301              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    302            }
    303          
    304            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    305            {
    306              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    307            }
    308              
    309            // Initialize ZigBee Device Security Manager
    310            ZDSecMgrInit(state);
   \   000005                ; Setup parameters for call to function ZDSecMgrInit
   \   000005   12....       LCALL   ??ZDSecMgrInit?relay
    311          
    312            if ( ZG_SECURE_ENABLED )
    313            {
    314              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    315              {
    316                nwkFrameCounter = 0;
    317            
    318                if( _NIB.nwkKeyLoaded == FALSE )
    319                {
    320                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    321                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    322                  {
    323                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    324                      SSP_SwitchNwkKey( 0 );
    325                  }
    326                }
    327              }
    328            }    
    329          }
   \   000008   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    330          
    331          /*********************************************************************
    332           * @fn      ZDApp_event_loop()
    333           *
    334           * @brief   Main event loop for Zigbee device objects task. This function
    335           *          should be called at periodic intervals.
    336           *
    337           * @param   task_id - Task ID
    338           * @param   events  - Bitmap of events
    339           *
    340           * @return  none
    341           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    342          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    343          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    344            uint8 *msg_ptr;
    345          
    346            if ( events & SYS_EVENT_MSG ) // 0x8000
   \   000009   5480         ANL     A,#0x80
   \   00000B   7030         JNZ     ??ZDApp_event_loop_0
    347            {
    348              //接收任务号为ZDAppTaskID的命令信息
    349              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    350              {
    351                //关于命令信息的事件处理函数
    352                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    353          
    354                // Release the memory
    355                osal_msg_deallocate( msg_ptr );
    356              }
    357          
    358              // Return unprocessed events
    359              return (events ^ SYS_EVENT_MSG);
    360            }
    361          
    362            if ( events & ZDO_NETWORK_INIT )  // 0x0001, 网络初始化事件处理
   \   00000D   EE           MOV     A,R6
   \   00000E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000010   5044         JNC     ??ZDApp_event_loop_1
    363            {
    364              // Initialize apps and start the network
    365              devState = DEV_INIT;
   \   000012   90....       MOV     DPTR,#devState
   \   000015   7401         MOV     A,#0x1
   \   000017   F0           MOVX    @DPTR,A
    366              
    367              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,   // ..., MODE_HARD
    368                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );  // 15, 15
   \   000018                ; Setup parameters for call to function ZDO_StartDevice
   \   000018   7C0F         MOV     R4,#0xf
   \   00001A   7B0F         MOV     R3,#0xf
   \   00001C   90....       MOV     DPTR,#devStartMode
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   FA           MOV     R2,A
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   5407         ANL     A,#0x7
   \   000027   F9           MOV     R1,A
   \   000028   12....       LCALL   ??ZDO_StartDevice?relay
    369          
    370              // Return unprocessed events
    371              return (events ^ ZDO_NETWORK_INIT);
   \   00002B   EE           MOV     A,R6
   \   00002C   6401         XRL     A,#0x1
   \                     ??ZDApp_event_loop_2:
   \   00002E   FA           MOV     R2,A
   \   00002F   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_3:
   \   000030   FB           MOV     R3,A
   \   000031   8072         SJMP    ??ZDApp_event_loop_4
    372            }
   \                     ??ZDApp_event_loop_5:
   \   000033                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000033   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   000036                ; Setup parameters for call to function osal_msg_deallocate
   \   000036   AA..         MOV     R2,?V0 + 0
   \   000038   AB..         MOV     R3,?V0 + 1
   \   00003A   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_0:
   \   00003D                ; Setup parameters for call to function osal_msg_receive
   \   00003D   90....       MOV     DPTR,#ZDAppTaskID
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   12....       LCALL   ??osal_msg_receive?relay
   \   000045   8A..         MOV     ?V0 + 0,R2
   \   000047   8B..         MOV     ?V0 + 1,R3
   \   000049   A9..         MOV     R1,?V0 + 1
   \   00004B   EA           MOV     A,R2
   \   00004C   49           ORL     A,R1
   \   00004D   70E4         JNZ     ??ZDApp_event_loop_5
   \   00004F   EE           MOV     A,R6
   \   000050   FA           MOV     R2,A
   \   000051   EF           MOV     A,R7
   \   000052   6480         XRL     A,#0x80
   \   000054   80DA         SJMP    ??ZDApp_event_loop_3
    373          
    374            if ( ZSTACK_ROUTER_BUILD )
    375            {
    376              if ( events & ZDO_NETWORK_START )   // 0x0002, 新网络开始事件
    377              {
    378                ZDApp_NetworkStartEvt();
    379            
    380                // Return unprocessed events
    381                return (events ^ ZDO_NETWORK_START);
    382              }
    383          
    384              if ( events & ZDO_ROUTER_START )
    385              {
    386                if ( nwkStatus == ZSuccess )
    387                {
    388                  if ( devState == DEV_END_DEVICE )
    389                    devState = DEV_ROUTER;
    390            
    391                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
    392                }
    393                else
    394                {
    395                  // remain as end device!!
    396                }
    397                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    398            
    399                // Return unprocessed events
    400                return (events ^ ZDO_ROUTER_START);
    401              }
    402            }
    403            
    404            // ZDApp_NetworkStartEvt() 或 ZDApp_ProcessNetworkJoin()，... 函数
    405            // 中设置的 ZDO_STATE_CHANGE_EVT ZDO 状态改变事件
    406            if ( events & ZDO_STATE_CHANGE_EVT ) // 0x0010
   \                     ??ZDApp_event_loop_1:
   \   000056   5410         ANL     A,#0x10
   \   000058   6023         JZ      ??ZDApp_event_loop_6
    407            {
    408              // 向 AF 层中已注册（在 aspi.c 中的 SPAI_Init()中使用 afRegister(&sapi_epDesc) 注册）
    409              // 的端点描述符中的 task_id（应该为 spai_TaskID）所标识的任务
    410              // 发送 ZDO_STATE_CHANGE 事件（此事件被附加在一个系统消息
    411              // 事件 SYS_EVENT_MSG 中）
    412              // 当设备加入网络时，devState 在 ZDApp_ProcessOSALMsg() 中改变状态值为 DEV_ZB_COORD
    413              // 当设备建立网络时，devState 在 ZDApp_NetworkStartEvt() 中改变状态为 DEV_END_DEVICE
    414              ZDO_UpdateNwkStatus( devState );
   \   00005A                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00005A   90....       MOV     DPTR,#devState
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F9           MOV     R1,A
   \   00005F   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    415              
    416              // At start up, do one MTO route discovery if the device is a concentrator
    417              if ( zgConcentratorEnable == TRUE ) // 默认设置为 false
   \   000062   90....       MOV     DPTR,#zgConcentratorEnable
   \   000065   E0           MOVX    A,@DPTR
   \   000066   6401         XRL     A,#0x1
   \   000068   700E         JNZ     ??CrossCallReturnLabel_35
    418              {
    419                // Start next event
    420                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   00006A                ; Setup parameters for call to function osal_start_timerEx
   \   00006A   7C64         MOV     R4,#0x64
   \   00006C   7D00         MOV     R5,#0x0
   \   00006E   7A00         MOV     R2,#0x0
   \   000070   7B08         MOV     R3,#0x8
   \   000072   90....       MOV     DPTR,#NWK_TaskID
   \   000075   12....       LCALL   ??Subroutine25_0 & 0xFFFF
    421              }
    422              
    423              // Return unprocessed events
    424              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_35:
   \   000078   EE           MOV     A,R6
   \   000079   6410         XRL     A,#0x10
   \   00007B   80B1         SJMP    ??ZDApp_event_loop_2
    425            }
    426          
    427            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_6:
   \   00007D   EE           MOV     A,R6
   \   00007E   5408         ANL     A,#0x8
   \   000080   6006         JZ      ??ZDApp_event_loop_7
    428            {
    429              // User defined logic
    430          
    431              // Return unprocessed events
    432              return (events ^ ZDO_COMMAND_CNF);
   \   000082   EE           MOV     A,R6
   \   000083   6408         XRL     A,#0x8
   \   000085   FA           MOV     R2,A
   \   000086   801D         SJMP    ??ZDApp_event_loop_4
    433            }
    434            
    435            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_7:
   \   000088   EF           MOV     A,R7
   \   000089   5402         ANL     A,#0x2
   \   00008B   6005         JZ      ??ZDApp_event_loop_8
    436            {
    437              ZDApp_SaveNetworkStateEvt();
    438          
    439              // Return unprocessed events
    440              return (events ^ ZDO_NWK_UPDATE_NV);
   \   00008D   EF           MOV     A,R7
   \   00008E   6402         XRL     A,#0x2
   \   000090   809E         SJMP    ??ZDApp_event_loop_3
    441            }
    442          
    443            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_8:
   \   000092   EE           MOV     A,R6
   \   000093   5404         ANL     A,#0x4
   \   000095   600A         JZ      ??ZDApp_event_loop_9
    444            {
    445              // The device has been in the UNAUTH state, so reset
    446              // Note: there will be no return from this call
    447              SystemReset();
   \   000097   C2AF         CLR     0xa8.7
   \   000099   75C9AB       MOV     0xc9,#-0x55
   \   00009C   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_10:
   \   00009F   80FE         SJMP    ??ZDApp_event_loop_10
    448            }
    449          
    450            if ( ZG_SECURE_ENABLED )
    451            {
    452              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    453            }
    454            else
    455            {
    456              // Discard or make more handlers
    457              return 0;
   \                     ??ZDApp_event_loop_9:
   \   0000A1   7A00         MOV     R2,#0x0
   \   0000A3   7B00         MOV     R3,#0x0
    458            }
   \                     ??ZDApp_event_loop_4:
   \   0000A5   02....       LJMP    ??Subroutine30_0 & 0xFFFF
   \   0000A8                REQUIRE _A_IEN0
   \   0000A8                REQUIRE WDCTL
    459          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine30_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    460          
    461          /*********************************************************************
    462           * @fn      ZDApp_ProcessSecEvent()
    463           *
    464           * @brief   Process incoming security events.
    465           *
    466           * @param   task_id - Task ID
    467           * @param   events  - Bitmap of events
    468           *
    469           * @return  none
    470           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    471          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    472          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    473            (void)task_id;  // Intentionally unreferenced parameter
    474            
    475            if ( ZSTACK_ROUTER_BUILD )
    476            {
    477              if ( events & ZDO_NEW_DEVICE )
    478              {
    479                // process the new device event
    480                if ( ZDSecMgrNewDeviceEvent() == TRUE )
    481                {
    482                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
    483                }
    484          
    485                // Return unprocessed events
    486                return (events ^ ZDO_NEW_DEVICE);
    487              }
    488            }
    489          
    490            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    491                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    492            {
    493              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    494              { 
    495                if ( events & ZDO_SECMGR_EVENT )
    496                {
    497                  ZDSecMgrEvent();
    498          
    499                  // Return unprocessed events
    500                  return (events ^ ZDO_SECMGR_EVENT);
    501                }
    502              }
    503            }
    504            
    505            if ( events & ZDO_DEVICE_AUTH )
   \   000009   EE           MOV     A,R6
   \   00000A   5480         ANL     A,#0x80
   \   00000C   600B         JZ      ??ZDApp_ProcessSecEvent_0
    506            {
    507              ZDApp_DeviceAuthEvt();
   \   00000E                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00000E   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    508          
    509              // Return unprocessed events
    510              return (events ^ ZDO_DEVICE_AUTH);
   \   000011   EE           MOV     A,R6
   \   000012   6480         XRL     A,#0x80
   \   000014   FA           MOV     R2,A
   \   000015   EF           MOV     A,R7
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000016   FB           MOV     R3,A
   \   000017   802F         SJMP    ??ZDApp_ProcessSecEvent_2
    511            }
    512          
    513            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000019   EF           MOV     A,R7
   \   00001A   5404         ANL     A,#0x4
   \   00001C   6026         JZ      ??ZDApp_ProcessSecEvent_3
    514            {
    515              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   00001E   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000024   2401         ADD     A,#0x1
   \   000026   FA           MOV     R2,A
   \   000027   E9           MOV     A,R1
   \   000028   3400         ADDC    A,#0x0
   \   00002A   FB           MOV     R3,A
   \   00002B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00002E   12....       LCALL   ??Subroutine31_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000031   C3           CLR     C
   \   000032   E8           MOV     A,R0
   \   000033   94E9         SUBB    A,#-0x17
   \   000035   E9           MOV     A,R1
   \   000036   9403         SUBB    A,#0x3
   \   000038   4003         JC      ??ZDApp_ProcessSecEvent_4
    516                ZDApp_SaveNwkKey();
   \   00003A                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00003A   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    517          
    518              // Return unprocessed events
    519              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00003D   EE           MOV     A,R6
   \   00003E   FA           MOV     R2,A
   \   00003F   EF           MOV     A,R7
   \   000040   6404         XRL     A,#0x4
   \   000042   80D2         SJMP    ??ZDApp_ProcessSecEvent_1
    520            }
    521            
    522            // Discard or make more handlers
    523            return 0;
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000044   7A00         MOV     R2,#0x0
   \   000046   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000048   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    524          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   E8           MOV     A,R0
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine31_0:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET
    525          
    526          /*********************************************************************
    527           * Application Functions
    528           */
    529          
    530          /*********************************************************************
    531           * @fn      ZDOInitDevice
    532           *
    533           * @brief   Start the device in the network.  This function will read
    534           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    535           *   restore the network state of the device.
    536           *
    537           * @param   startDelay - timeDelay to start device (in milliseconds).
    538           *      There is a jitter added to this delay:
    539           *              ((NWK_START_DELAY + startDelay)
    540           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    541           *
    542           * NOTE:    If the application would like to force a "new" join, the
    543           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    544           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    545           *          this function. "new" join means to not restore the network
    546           *          state of the device. Use zgWriteStartupOptions() to set these
    547           *          options.
    548           *
    549           * @return
    550           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    551           *          restored.
    552           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    553           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    554           *          it could mean that there was no network state to restore.
    555           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    556           *          with the rejoin option set to TRUE.  So, the device was not
    557           *          started in the network (one time only).  The next time this
    558           *          function is called it will start.
    559           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    560          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    561          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
    562            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    563            uint16 extendedDelay = 0;
    564          
    565            // 如果在 IAR中定义了宏 HOLD_AUTO_START，
    566            // 则 devState 初始化时为 DEV_HOLD，否则，初始化为 DEV_INIT
    567            if ( devState == DEV_HOLD ) 
   \                     ??CrossCallReturnLabel_54:
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   E0           MOVX    A,@DPTR
   \   000011   7005         JNZ     ??ZDOInitDevice_0
    568            {    
    569              // Initialize the RAM items table, in case an NV item has been updated.
    570              zgInitItems( FALSE );
   \   000013                ; Setup parameters for call to function zgInitItems
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??zgInitItems?relay
    571            }
    572          
    573            ZDConfig_InitDescriptors();   // 初始化 ZDO 描述符
   \                     ??ZDOInitDevice_0:
   \   000018                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000018   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    574            //devtag.071807.todo - fix this temporary solution
    575            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   90....       MOV     DPTR,#_NIB + 14
   \   000022   F0           MOVX    @DPTR,A
    576            
    577            devState = DEV_INIT;    // Remove the Hold state
   \   000023   90....       MOV     DPTR,#devState
   \   000026   7401         MOV     A,#0x1
   \   000028   F0           MOVX    @DPTR,A
    578          
    579            // Initialize leave control logic
    580            ZDApp_LeaveCtrlInit();
   \   000029                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000029   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    581          
    582            // Check leave control reset settings
    583            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00002C                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00002C   85..82       MOV     DPL,?XSP + 0
   \   00002F   85..83       MOV     DPH,?XSP + 1
   \   000032   AC82         MOV     R4,DPL
   \   000034   AD83         MOV     R5,DPH
   \   000036   7A..         MOV     R2,#devState & 0xff
   \   000038   7B..         MOV     R3,#(devState >> 8) & 0xff
   \   00003A   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    584          
    585            // Leave may make the hold state come back
    586            if ( devState == DEV_HOLD )
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   700E         JNZ     ??ZDOInitDevice_1
    587            {
    588              // Set the NV startup option to force a "new" join.
    589              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000043                ; Setup parameters for call to function zgWriteStartupOptions
   \   000043   7A02         MOV     R2,#0x2
   \   000045   79FF         MOV     R1,#-0x1
   \   000047   12....       LCALL   ??zgWriteStartupOptions?relay
    590          
    591              // Notify the applications 
    592              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00004A                ; Setup parameters for call to function osal_set_event
   \   00004A   12....       LCALL   ?Subroutine10 & 0xFFFF
    593              
    594              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_43:
   \   00004D   7902         MOV     R1,#0x2
   \   00004F   8036         SJMP    ??ZDOInitDevice_2
    595            }
    596          
    597          #if defined ( NV_RESTORE )
    598            // Get Keypad directly to see if a reset nv is needed.
    599            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    600            // while booting to skip past NV Restore.
    601            if ( HalKeyRead() == SW_BYPASS_NV )
    602              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    603            else
    604            {
    605              // Determine if NV should be restored
    606              networkStateNV = ZDApp_ReadNetworkRestoreState();
    607            }
    608          
    609            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    610            {
    611              networkStateNV = ZDApp_RestoreNetworkState();
    612            }
    613            else
    614            {
    615              // Wipe out the network state in NV
    616              NLME_InitNV();
    617              NLME_SetDefaultNV();
    618            }
    619          #endif
    620          
    621            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    622            {
    623              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000051                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000051   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    624          
    625              // Only delay if joining network - not restoring network state
    626              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    627                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000054                ; Setup parameters for call to function osal_rand
   \   000054   12....       LCALL   ??osal_rand?relay
   \   000057   85..82       MOV     DPL,?XSP + 0
   \   00005A   85..83       MOV     DPH,?XSP + 1
   \   00005D   EA           MOV     A,R2
   \   00005E   547F         ANL     A,#0x7f
   \   000060   F8           MOV     R0,A
   \   000061   E0           MOVX    A,@DPTR
   \   000062   28           ADD     A,R0
   \   000063   F8           MOV     R0,A
   \   000064   A3           INC     DPTR
   \   000065   E0           MOVX    A,@DPTR
   \   000066   3400         ADDC    A,#0x0
   \   000068   F9           MOV     R1,A
   \   000069   E8           MOV     A,R0
   \   00006A   2464         ADD     A,#0x64
   \   00006C   FE           MOV     R6,A
   \   00006D   E9           MOV     A,R1
   \   00006E   3400         ADDC    A,#0x0
   \   000070   FF           MOV     R7,A
    628            }
    629          
    630            // Initialize the security for type of device
    631            ZDApp_SecInit( networkStateNV );
   \   000071                ; Setup parameters for call to function ZDSecMgrInit
   \   000071   7901         MOV     R1,#0x1
   \   000073   12....       LCALL   ??ZDSecMgrInit?relay
    632            
    633            // Trigger the network start
    634            ZDApp_NetworkInit( extendedDelay );   // 开始形成网络
   \   000076                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000076   EE           MOV     A,R6
   \   000077   FA           MOV     R2,A
   \   000078   EF           MOV     A,R7
   \   000079   FB           MOV     R3,A
   \   00007A   12....       LCALL   ??ZDApp_NetworkInit?relay
    635          
    636            // set broadcast address mask to support broadcast filtering
    637            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   00007D                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   00007D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    638            
    639            return ( networkStateNV );
   \   000085   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   000087   02....       LJMP    ?Subroutine1 & 0xFFFF
    640          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ??Subroutine28_0
   \   000002                ; // Fall through to label ??Subroutine28_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine28_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine29_0
   \   000002                ; // Fall through to label ??Subroutine29_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine29_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine30_0
   \   000003                ; // Fall through to label ??Subroutine30_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine31_0
   \   000006                ; // Fall through to label ??Subroutine31_0
    641          
    642          /*********************************************************************
    643           * @fn      ZDApp_ReadNetworkRestoreState
    644           *
    645           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    646           *          or not to restore the network state.
    647           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    648           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    649           *
    650           * @param   none
    651           *
    652           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    653           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    654           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    655           *          ZCD_NV_STARTUP_OPTION
    656           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    657          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    658          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    659            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    660          
    661            // Look for the New Network State option.
    662            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    663            {
    664              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    665            }
    666          
    667            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    668          }
    669          
    670          /*********************************************************************
    671           * @fn      ZDAppDetermineDeviceType()
    672           *
    673           * @brief   Determines the type of device to start. 
    674           *
    675           *          Looks at zgDeviceLogicalType and determines what type of
    676           *          device to start.  The types are:
    677           *            ZG_DEVICETYPE_COORDINATOR
    678           *            ZG_DEVICETYPE_ROUTER
    679           *            ZG_DEVICETYPE_ENDDEVICE
    680           *
    681           * @param   none
    682           *
    683           * @return  none
    684           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    685          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    686          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    687            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    688            {
    689              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    690              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    691            }
    692            else
    693            {
    694              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    695                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    696              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    697                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    698              
    699              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    700              // The device shall do rejoin the network. Otherwise, do normal join
    701              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000036   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   90....       MOV     DPTR,#devStartMode
   \   00003F   7003         JNZ     ??ZDAppDetermineDeviceType_5
    702              {
    703                devStartMode = MODE_JOIN;     // Assume joining
   \   000041   E4           CLR     A
   \   000042   8002         SJMP    ??ZDAppDetermineDeviceType_1
    704              }
    705              else
    706              {
    707                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000044   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    708              }
    709            }
    710          }
   \   000047   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    711          
    712          /*********************************************************************
    713           * @fn      ZDApp_NetworkStartEvt()
    714           *
    715           * @brief   Process the Network Start Event
    716           *
    717           * @param   none
    718           *
    719           * @return  none
    720           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    721          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    722          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    723            // 若网络形成函数 NLME_NetworkFormationRequest() 建立网络成功，
    724            // 则返回 zSuccess，否则返回 zFailure 并将此返回值传递给
    725            // ZDO_NetworkFormationConfirmCB() 函数，再在其中将上面的 
    726            // zSuccess 或 zFailure 赋值给 nwkStatus
    727            if ( nwkStatus == ZSuccess )  // 网络建立成功?
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    728            {
    729              // Successfully started a ZigBee network
    730              // devState 在 ZDObject.c 中的 ZDO_StartDevice() 函数中
    731              // 改变状态
    732              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    733              {
    734                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    735              }
    736          
    737              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    738              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802B         SJMP    ??ZDApp_NetworkStartEvt_2
    739            }
    740            else
    741            {
    742              // Try again with a higher energy threshold !!
    743              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   2410         ADD     A,#0x10
   \   000022   F8           MOV     R0,A
   \   000023   E4           CLR     A
   \   000024   3400         ADDC    A,#0x0
   \   000026   F9           MOV     R1,A
   \   000027   E8           MOV     A,R0
   \   000028   94FF         SUBB    A,#-0x1
   \   00002A   E9           MOV     A,R1
   \   00002B   9400         SUBB    A,#0x0
   \   00002D   C3           CLR     C
   \   00002E   65D0         XRL     A,PSW
   \   000030   33           RLC     A
   \   000031   500E         JNC     ??ZDApp_NetworkStartEvt_3
    744              {
    745                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000033                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000033                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000033   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000036   E9           MOV     A,R1
   \   000037   2410         ADD     A,#0x10
   \   000039   F9           MOV     R1,A
   \   00003A   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    746                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003D                ; Setup parameters for call to function osal_set_event
   \   00003D   7A01         MOV     R2,#0x1
   \   00003F   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    747              }
    748              else
    749              {
    750                // Failed to start network. Enter a dormant state (until user intervenes)
    751                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000041   90....       MOV     DPTR,#devState
   \   000044   7401         MOV     A,#0x1
   \   000046   F0           MOVX    @DPTR,A
    752                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000047                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000047   7A10         MOV     R2,#0x10
    753              }
    754            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   000049   12....       LCALL   ??Subroutine28_0 & 0xFFFF
    755          }
   \                     ??CrossCallReturnLabel_46:
   \   00004C   02....       LJMP    ?Subroutine2 & 0xFFFF
    756          
    757          /*********************************************************************
    758           * @fn      ZDApp_DeviceAuthEvt()
    759           *
    760           * @brief   Process the Device Authentic Event
    761           *
    762           * @param   none
    763           *
    764           * @return  none
    765           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    766          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    767          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    768            // received authentication from trust center
    769            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   701F         JNZ     ??ZDApp_DeviceAuthEvt_0
    770            {
    771              // Stop the reset timer so it doesn't reset
    772              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    773          
    774              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine6 & 0xFFFF
    775              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    776          
    777              // Set the Power Manager Device
    778          #if defined ( POWER_SAVING )
    779              osal_pwrmgr_device( PWRMGR_BATTERY );
    780          #endif
    781          
    782              if ( ZSTACK_ROUTER_BUILD )
    783              {
    784                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
    785                {
    786                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    787                  NLME_StartRouterRequest( 0, 0, false );
    788                }
    789              }
    790          
    791              // Notify to save info into NV
    792              ZDApp_NVUpdate();
    793          
    794              // Save off the security
    795              ZDApp_SaveNwkKey();
   \                     ??CrossCallReturnLabel_0:
   \   000012                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000012   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    796          
    797              ZDApp_AnnounceNewAddress();
   \   000015                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000015   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    798              
    799              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000018   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   A2E3         MOV     C,0xE0 /* A   */.3
   \   00001E   400B         JC      ??ZDApp_DeviceAuthEvt_0
    800              {
    801                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000020                ; Setup parameters for call to function NLME_SetPollRate
   \   000020   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FB           MOV     R3,A
   \   000028   12....       LCALL   ??NLME_SetPollRate?relay
    802              }
    803            }
    804            else
    805            {
    806              ZDApp_NVUpdate();
    807            }
    808          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   00002B   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   90....       MOV     DPTR,#devState
   \   000003   7406         MOV     A,#0x6
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008   7B00         MOV     R3,#0x0
   \   00000A   90....       MOV     DPTR,#ZDAppTaskID
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   12....       LCALL   ??osal_set_event?relay
   \   000012                ; Setup parameters for call to function osal_pwrmgr_device
   \   000012                ; Setup parameters for call to function osal_pwrmgr_device
   \   000012   7901         MOV     R1,#0x1
   \   000014   12....       LCALL   ??osal_pwrmgr_device?relay
   \   000017   22           RET
    809          
    810          /*********************************************************************
    811           * @fn      ZDApp_SaveNetworkStateEvt()
    812           *
    813           * @brief   Process the Save the Network State Event
    814           *
    815           * @param   none
    816           *
    817           * @return  none
    818           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    819          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    820          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    821          #if defined ( NV_RESTORE )
    822           #if defined ( NV_TURN_OFF_RADIO )
    823            // Turn off the radio's receiver during an NV update
    824            uint8 RxOnIdle;
    825            uint8 x = false;
    826            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    827            ZMacSetReq( ZMacRxOnIdle, &x );
    828           #endif
    829          
    830            // Update the Network State in NV
    831            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    832                           NWK_NV_DEVICELIST_ENABLE |
    833                           NWK_NV_BINDING_ENABLE    |
    834                           NWK_NV_ADDRMGR_ENABLE );
    835          
    836            // Reset the NV startup option to resume from NV by
    837            // clearing the "New" join option.
    838            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    839          
    840           #if defined ( NV_TURN_OFF_RADIO )
    841            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    842           #endif
    843          #endif  // NV_RESTORE
    844          }
   \   000000   02....       LJMP    ?BRET
    845          
    846          /*********************************************************************
    847           * @fn      ZDApp_RestoreNetworkState()
    848           *
    849           * @brief   This function will restore the network state of the
    850           *          device if the network state is stored in NV.
    851           *
    852           * @param   none
    853           *
    854           * @return
    855           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    856           *          restored.
    857           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    858           *          This could mean that zgStartupOption said to not restore, or
    859           *          it could mean that there was no network state to restore.
    860           *
    861           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    862          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    863          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    864            uint8 nvStat;
    865            nwkActiveKeyItems keyItems;
    866          
    867            // Initialize NWK NV items
    868            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    869          
    870            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   602E         JZ      ??ZDApp_RestoreNetworkState_0
    871            {
    872              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6028         JZ      ??ZDApp_RestoreNetworkState_0
    873              {
    874                // Are we a coordinator
    875                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   12....       LCALL   ??Subroutine31_0 & 0xFFFF
    876                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \                     ??CrossCallReturnLabel_51:
   \   00001E   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000024   49           ORL     A,R1
   \   000025   7007         JNZ     ??ZDApp_RestoreNetworkState_1
    877                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   54F8         ANL     A,#0xf8
   \   00002D   F0           MOVX    @DPTR,A
    878                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   00002E   90....       MOV     DPTR,#devStartMode
   \   000031   7401         MOV     A,#0x1
   \   000033   12....       LCALL   ?Subroutine7 & 0xFFFF
    879                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
    880              }
    881              else
    882                nvStat = NV_ITEM_UNINIT;
    883          
    884              if ( ZG_SECURE_ENABLED )
    885              {
    886                nwkFrameCounterChanges = 0;
    887                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    888                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    889          
    890                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    891                {
    892                  ZDApp_RestoreNwkKey();
    893                }
    894              }
    895          
    896              // The default for RxOnWhenIdle is true for Routers and false for end devices
    897              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    898              // other than default.
    899            }
    900          
    901            if ( nvStat == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   000036   EE           MOV     A,R6
   \   000037   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    902              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000039   7900         MOV     R1,#0x0
   \   00003B   8002         SJMP    ??ZDApp_RestoreNetworkState_2
    903            else
    904              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   00003D   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00003F   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    905          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   000003   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   000005   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   000007   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000009   12....       LCALL   ??sAddrExtCpy?relay
   \   00000C   22           RET
    906          
    907          /*********************************************************************
    908           * @fn      ZDApp_InitUserDesc()
    909           *
    910           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    911           *          when needed.  If you want to initialize the User descriptor to
    912           *          something other than all zero, do it here.
    913           *
    914           * @param   none
    915           *
    916           * @return  none
    917           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    918          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    919          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    920            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    921          
    922            // Initialize the User Descriptor, the descriptor is read from NV
    923            // when needed.  If you want to initialize the User descriptor to something
    924            // other than all zero, do it here.
    925            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine20 & 0xFFFF
    926            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    927                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_20:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    928            {
    929              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    930                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    931              {
    932                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    933                {
    934                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    935                }
    936              }
    937            }
    938          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine29_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    939          
    940          /*********************************************************************
    941           * @fn      ZDAppCheckForHoldKey()
    942           *
    943           * @brief   Check for key to set the device into Hold Auto Start
    944           *
    945           * @param   none
    946           *
    947           * @return  none
    948           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    949          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    950          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    951          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    952            // Get Keypad directly to see if a HOLD_START is needed.
    953            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    954            // while booting to avoid starting up the device.
    955            if ( HalKeyRead () == SW_BYPASS_START)    // 0x01
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    956            {
    957              // Change the device state to HOLD on start up
    958              devState = DEV_HOLD;
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E4           CLR     A
   \   000010   F0           MOVX    @DPTR,A
    959            }
    960          #endif // HAL_KEY
    961          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ?Subroutine2 & 0xFFFF
    962          
    963          /*********************************************************************
    964           * @fn      ZDApp_ProcessOSALMsg()
    965           *
    966           * @brief   Process the incoming task message.
    967           *
    968           * @param   msgPtr - message to process
    969           *
    970           * @return  none
    971           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    972          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    973          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    974            // Data Confirmation message fields
    975            uint8 sentEP;       // This should always be 0
    976            uint8 sentStatus;
    977            afDataConfirm_t *afDataConfirm;
    978            uint8 tmp;
    979          
    980            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   14           DEC     A
   \   000014   6023         JZ      ??ZDApp_ProcessOSALMsg_0
   \   000016   14           DEC     A
   \   000017   7003         JNZ     $+5
   \   000019   02....       LJMP    ??ZDApp_ProcessOSALMsg_1 & 0xFFFF
   \   00001C   14           DEC     A
   \   00001D   7003         JNZ     $+5
   \   00001F   02....       LJMP    ??ZDApp_ProcessOSALMsg_2 & 0xFFFF
   \   000022   24E9         ADD     A,#-0x17
   \   000024   6007         JZ      ??ZDApp_ProcessOSALMsg_3
   \   000026   2447         ADD     A,#0x47
   \   000028   6009         JZ      ??ZDApp_ProcessOSALMsg_4
   \   00002A   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    981            {
    982              // Incoming ZDO Message
    983              case AF_INCOMING_MSG_CMD:   // 0x1A, AF 层信息输入事件
    984                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   00002D                ; Setup parameters for call to function ZDP_IncomingData
   \   00002D   12....       LCALL   ??ZDP_IncomingData?relay
    985                break;
   \   000030   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    986                
    987              case ZDO_CB_MSG:
    988                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   000033                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000033   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
    989                break;
   \   000036   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
    990          
    991              case AF_DATA_CONFIRM_CMD:
    992                // This message is received as a confirmation of a data packet sent.
    993                // The status is of ZStatus_t type [defined in NLMEDE.h]
    994                // The message fields are defined in AF.h
    995                afDataConfirm = (afDataConfirm_t *)msgPtr;
    996                sentEP = afDataConfirm->endpoint;
    997                sentStatus = afDataConfirm->hdr.status;
    998          
    999                // Action taken when confirmation is received.
   1000          #if defined ( ZIGBEE_FREQ_AGILITY )
   1001                if ( pZDNwkMgr_ProcessDataConfirm )
   1002                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   1003          #endif
   1004                (void)sentEP;
   1005                (void)sentStatus;
   1006                break;
   1007          
   1008              case ZDO_NWK_DISC_CNF:  // 网络发现确认事件
   1009                // devState 在 ZDObject.c 的 ZDO_StartDevice() 中改变状态
   1010                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000039   90....       MOV     DPTR,#devState
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   6402         XRL     A,#0x2
   \   00003F   6003         JZ      $+5
   \   000041   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
   1011                  break;
   1012                
   1013                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   000044   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000047   E0           MOVX    A,@DPTR
   \   000048   6401         XRL     A,#0x1
   \   00004A   6008         JZ      ??ZDApp_ProcessOSALMsg_6
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   6402         XRL     A,#0x2
   \   00004F   6003         JZ      $+5
   \   000051   02....       LJMP    ??ZDApp_ProcessOSALMsg_5 & 0xFFFF
   1014                {
   1015                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   000054   8E82         MOV     DPL,R6
   \   000056   8F83         MOV     DPH,R7
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   6003         JZ      $+5
   \   00005C   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   \   00005F   90....       MOV     DPTR,#zdoDiscCounter
   \   000062   E0           MOVX    A,@DPTR
   \   000063   C3           CLR     C
   \   000064   9403         SUBB    A,#0x3
   \   000066   5003         JNC     $+5
   \   000068   02....       LJMP    ??ZDApp_ProcessOSALMsg_7 & 0xFFFF
   1016                  {
   1017                    if ( devStartMode == MODE_JOIN )
   \   00006B   EE           MOV     A,R6
   \   00006C   2403         ADD     A,#0x3
   \   00006E   F8           MOV     R0,A
   \   00006F   EF           MOV     A,R7
   \   000070   3400         ADDC    A,#0x0
   \   000072   F9           MOV     R1,A
   \   000073   88..         MOV     ?V0 + 0,R0
   \   000075   89..         MOV     ?V0 + 1,R1
   \   000077   EE           MOV     A,R6
   \   000078   2402         ADD     A,#0x2
   \   00007A   18           DEC     R0
   \   00007B   EF           MOV     A,R7
   \   00007C   3400         ADDC    A,#0x0
   \   00007E   F9           MOV     R1,A
   \   00007F   88..         MOV     ?V0 + 2,R0
   \   000081   89..         MOV     ?V0 + 3,R1
   \   000083   EE           MOV     A,R6
   \   000084   2404         ADD     A,#0x4
   \   000086   08           INC     R0
   \   000087   08           INC     R0
   \   000088   EF           MOV     A,R7
   \   000089   3400         ADDC    A,#0x0
   \   00008B   F9           MOV     R1,A
   \   00008C   88..         MOV     ?V0 + 4,R0
   \   00008E   89..         MOV     ?V0 + 5,R1
   \   000090   90....       MOV     DPTR,#devStartMode
   \   000093   E0           MOVX    A,@DPTR
   \   000094   7044         JNZ     ??ZDApp_ProcessOSALMsg_8
   1018                    {
   1019                      devState = DEV_NWK_JOINING;
   \   000096   90....       MOV     DPTR,#devState
   \   000099   7403         MOV     A,#0x3
   \   00009B   F0           MOVX    @DPTR,A
   1020            
   1021                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   00009C                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00009C   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1022            
   1023                      // 此函数允许上层去请求设备将自己加入到一个网络中。
   1024                      // 这个行为的结果（状态）返回到 ZDO_JoinConfirmCB() 回调函数中。
   1025                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
   1026                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
   1027                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
   1028                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   00009F                ; Setup parameters for call to function NLME_JoinRequest
   \   00009F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   F5..         MOV     ?V0 + 6,A
   \   0000A5   78..         MOV     R0,#?V0 + 6
   \   0000A7   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000AA   85..82       MOV     DPL,?V0 + 4
   \   0000AD   85..83       MOV     DPH,?V0 + 5
   \   0000B0   E0           MOVX    A,@DPTR
   \   0000B1   F9           MOV     R1,A
   \   0000B2   85..82       MOV     DPL,?V0 + 2
   \   0000B5   85..83       MOV     DPH,?V0 + 3
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   FC           MOV     R4,A
   \   0000BA   85..82       MOV     DPL,?V0 + 0
   \   0000BD   85..83       MOV     DPH,?V0 + 1
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   FB           MOV     R3,A
   \   0000C2   EC           MOV     A,R4
   \   0000C3   2400         ADD     A,#0x0
   \   0000C5   E4           CLR     A
   \   0000C6   3B           ADDC    A,R3
   \   0000C7   FD           MOV     R5,A
   \   0000C8   EE           MOV     A,R6
   \   0000C9   2406         ADD     A,#0x6
   \   0000CB   FA           MOV     R2,A
   \   0000CC   EF           MOV     A,R7
   \   0000CD   3400         ADDC    A,#0x0
   \   0000CF   FB           MOV     R3,A
   \   0000D0   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000D3   7401         MOV     A,#0x1
   \   0000D5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D8   8078         SJMP    ??ZDApp_ProcessOSALMsg_9
   1029                      {
   1030                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1031                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1032                      }
   1033                    }
   1034                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   0000DA   6403         XRL     A,#0x3
   \   0000DC   707A         JNZ     ??CrossCallReturnLabel_14
   1035                    {
   1036                      devState = DEV_NWK_REJOIN;
   \   0000DE   90....       MOV     DPTR,#devState
   \   0000E1   7404         MOV     A,#0x4
   \   0000E3   F0           MOVX    @DPTR,A
   1037          
   1038                      // Before trying to do rejoin, check if the device has a valid short address
   1039                      // If not, generate a random short address for itself
   1040                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   0000E4   90....       MOV     DPTR,#_NIB + 20
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   64FE         XRL     A,#0xfe
   \   0000EA   7003         JNZ     ??ZDApp_ProcessOSALMsg_10
   \   0000EC   A3           INC     DPTR
   \   0000ED   E0           MOVX    A,@DPTR
   \   0000EE   F4           CPL     A
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0000EF   7012         JNZ     ??ZDApp_ProcessOSALMsg_11
   1041                      {
   1042                        _NIB.nwkDevAddress = osal_rand();
   \   0000F1                ; Setup parameters for call to function osal_rand
   \   0000F1   12....       LCALL   ??osal_rand?relay
   \   0000F4   90....       MOV     DPTR,#_NIB + 20
   \   0000F7   12....       LCALL   ??Subroutine31_0 & 0xFFFF
   1043                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \                     ??CrossCallReturnLabel_52:
   \   0000FA                ; Setup parameters for call to function ZMacSetReq
   \   0000FA   7A..         MOV     R2,#(_NIB + 20) & 0xff
   \   0000FC   7B..         MOV     R3,#((_NIB + 20) >> 8) & 0xff
   \   0000FE   7953         MOV     R1,#0x53
   \   000100   12....       LCALL   ??ZMacSetReq?relay
   1044                      }
   1045          
   1046                      if ( ZG_SECURE_ENABLED )
   1047                      {
   1048                        ZDApp_RestoreNwkKey();
   1049                      }
   1050                      
   1051                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1052                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   000103   90....       MOV     DPTR,#_NIB + 33
   \   000106   E0           MOVX    A,@DPTR
   \   000107   64FE         XRL     A,#0xfe
   \   000109   7003         JNZ     ??ZDApp_ProcessOSALMsg_12
   \   00010B   A3           INC     DPTR
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   F4           CPL     A
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   00010E   7021         JNZ     ??ZDApp_ProcessOSALMsg_13
   1053                      {
   1054                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   \   000110   85..82       MOV     DPL,?V0 + 2
   \   000113   85..83       MOV     DPH,?V0 + 3
   \   000116   E0           MOVX    A,@DPTR
   \   000117   FA           MOV     R2,A
   \   000118   85..82       MOV     DPL,?V0 + 0
   \   00011B   85..83       MOV     DPH,?V0 + 1
   \   00011E   E0           MOVX    A,@DPTR
   \   00011F   F9           MOV     R1,A
   \   000120   EA           MOV     A,R2
   \   000121   90....       MOV     DPTR,#_NIB + 33
   \   000124   F0           MOVX    @DPTR,A
   \   000125   A3           INC     DPTR
   \   000126   E9           MOV     A,R1
   \   000127   F0           MOVX    @DPTR,A
   1055                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   000128                ; Setup parameters for call to function ZMacSetReq
   \   000128   7A..         MOV     R2,#(_NIB + 33) & 0xff
   \   00012A   7B..         MOV     R3,#((_NIB + 33) >> 8) & 0xff
   \   00012C   7950         MOV     R1,#0x50
   \   00012E   12....       LCALL   ??ZMacSetReq?relay
   1056                      }
   1057          
   1058                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   000131   85..82       MOV     DPL,?XSP + 0
   \   000134   85..83       MOV     DPH,?XSP + 1
   \   000137   7401         MOV     A,#0x1
   \   000139   F0           MOVX    @DPTR,A
   1059                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
   \   00013A                ; Setup parameters for call to function ZMacSetReq
   \   00013A   AA82         MOV     R2,DPL
   \   00013C   AB83         MOV     R3,DPH
   \   00013E   7952         MOV     R1,#0x52
   \   000140   12....       LCALL   ??ZMacSetReq?relay
   1060                      
   1061                      // 此函数重新加入一个设备已经加入过的网络。
   1062                      // 此函数的结果（状态）返回到 ZDO_JoinConfirmCB() 回调函数中。
   1063                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   \   000143                ; Setup parameters for call to function NLME_ReJoinRequest
   \   000143   85..82       MOV     DPL,?V0 + 4
   \   000146   85..83       MOV     DPH,?V0 + 5
   \   000149   E0           MOVX    A,@DPTR
   \   00014A   F9           MOV     R1,A
   \   00014B   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00014D   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00014F   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000152   E9           MOV     A,R1
   \   000153   6003         JZ      ??CrossCallReturnLabel_14
   1064                      {
   1065                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1066                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000155                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000155                ; Setup parameters for call to function osal_rand
   \   000155   12....       LCALL   ?Subroutine16 & 0xFFFF
   1067                      }
   1068                    }
   1069            
   1070                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_14:
   \   000158   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00015B   E0           MOVX    A,@DPTR
   \   00015C   A2E3         MOV     C,0xE0 /* A   */.3
   \   00015E   505A         JNC     ??ZDApp_ProcessOSALMsg_5
   1071                    {
   1072                      // The receiver is on, turn network layer polling off.
   1073                      NLME_SetPollRate( 0 );
   \   000160                ; Setup parameters for call to function NLME_SetPollRate
   \   000160   12....       LCALL   ?Subroutine19 & 0xFFFF
   1074                      NLME_SetQueuedPollRate( 0 );
   1075                      NLME_SetResponseRate( 0 );
   1076                    }
   1077                    else
   1078                    {
   1079                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1080                      {
   1081                        ZDApp_SavedPollRate = zgPollRate;
   1082                        NLME_SetPollRate( zgRejoinPollRate );
   1083                      }
   1084                    }
   1085                  }
   \                     ??CrossCallReturnLabel_18:
   \   000163   8055         SJMP    ??ZDApp_ProcessOSALMsg_5
   1086                  else
   1087                  {
   1088                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   000165   90....       MOV     DPTR,#continueJoining
   \   000168   E0           MOVX    A,@DPTR
   \   000169   604F         JZ      ??ZDApp_ProcessOSALMsg_5
   1089                    {
   1090              #if defined ( MANAGED_SCAN )
   1091                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1092              #else
   1093                      zdoDiscCounter++;
   \   00016B   90....       MOV     DPTR,#zdoDiscCounter
   \   00016E   E0           MOVX    A,@DPTR
   \   00016F   04           INC     A
   \   000170   F0           MOVX    @DPTR,A
   1094                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1095                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   000171                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000171                ; Setup parameters for call to function osal_rand
   \   000171   12....       LCALL   ??osal_rand?relay
   \   000174   EA           MOV     A,R2
   \   000175   2464         ADD     A,#0x64
   \   000177   FA           MOV     R2,A
   \   000178   E4           CLR     A
   \   000179   3400         ADDC    A,#0x0
   \   00017B   FB           MOV     R3,A
   \   00017C   8039         SJMP    ??ZDApp_ProcessOSALMsg_14
   1096              #endif
   1097                    }
   1098                  }
   1099                }
   1100                break;
   1101          
   1102                // 来自 ZDO_JoinConfirmCB() 函数中发送的 ZDO_NWK_JOIN_IND 事件
   1103              case ZDO_NWK_JOIN_IND:  // 网络加入指示事件
   1104                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00017E   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000181   E0           MOVX    A,@DPTR
   \   000182   6401         XRL     A,#0x1
   \   000184   6005         JZ      ??ZDApp_ProcessOSALMsg_15
   \   000186   E0           MOVX    A,@DPTR
   \   000187   6402         XRL     A,#0x2
   \   000189   702F         JNZ     ??ZDApp_ProcessOSALMsg_5
   1105                {
   1106                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   00018B                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   00018B   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   00018E   802A         SJMP    ??ZDApp_ProcessOSALMsg_5
   1107                }
   1108                break;
   1109          
   1110              case ZDO_NWK_JOIN_REQ:
   1111                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000190   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000193   E0           MOVX    A,@DPTR
   \   000194   6401         XRL     A,#0x1
   \   000196   6005         JZ      ??ZDApp_ProcessOSALMsg_16
   \   000198   E0           MOVX    A,@DPTR
   \   000199   6402         XRL     A,#0x2
   \   00019B   701D         JNZ     ??ZDApp_ProcessOSALMsg_5
   1112                {
   1113                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   00019D   90....       MOV     DPTR,#retryCnt
   \   0001A0   E4           CLR     A
   \   0001A1   F0           MOVX    @DPTR,A
   1114                  devStartMode = MODE_RESUME;
   \   0001A2   90....       MOV     DPTR,#devStartMode
   \   0001A5   04           INC     A
   \   0001A6   F0           MOVX    @DPTR,A
   1115                  _tmpRejoinState = true;
   \   0001A7   90....       MOV     DPTR,#_tmpRejoinState
   \   0001AA   12....       LCALL   ?Subroutine7 & 0xFFFF
   1116                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1117                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \                     ??CrossCallReturnLabel_3:
   \   0001AD   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0001B0   7402         MOV     A,#0x2
   \   0001B2   F0           MOVX    @DPTR,A
   1118                  ZDApp_NetworkInit( 0 );
   \   0001B3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001B3   7A00         MOV     R2,#0x0
   \   0001B5   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   0001B7   12....       LCALL   ??ZDApp_NetworkInit?relay
   1119                }
   1120                break;
   1121          
   1122              default:
   1123                if ( ZG_SECURE_ENABLED )
   1124                  ZDApp_ProcessSecMsg( msgPtr );
   1125                break;
   1126            }
   1127          
   1128          }
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   0001BA   7401         MOV     A,#0x1
   \   0001BC   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001BF   7F07         MOV     R7,#0x7
   \   0001C1   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??NLME_SetPollRate?relay
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E   7A00         MOV     R2,#0x0
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003   EA           MOV     A,R2
   \   000004   547F         ANL     A,#0x7f
   \   000006   2464         ADD     A,#0x64
   \   000008   FA           MOV     R2,A
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   00000E   22           RET
   1129          
   1130          /*********************************************************************
   1131           * @fn      ZDApp_ProcessMsgCBs()
   1132           *
   1133           * @brief   Process response messages
   1134           *
   1135           * @param   none
   1136           *
   1137           * @return  none
   1138           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1139          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1140          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine18 & 0xFFFF
   1141            switch ( inMsg->clusterID )
   \                     ??CrossCallReturnLabel_36:
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000018   0200         DW        2
   \   00001A   2100         DW        33
   \   00001C   2200         DW        34
   \   00001E   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000020   0080         DW        32768
   \   000022   0180         DW        32769
   \   000024   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000026   0000         DW        0
   \   000028   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1142            {
   1143          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1144              case NWK_addr_rsp:
   1145              case IEEE_addr_rsp:
   1146                {
   1147                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1148                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   00002A                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   00002A   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00002D   8A..         MOV     ?V0 + 0,R2
   \   00002F   8B..         MOV     ?V0 + 1,R3
   \   000031   AE..         MOV     R6,?V0 + 0
   \   000033   AF..         MOV     R7,?V0 + 1
   1149                  if ( pAddrRsp )
   \   000035   EE           MOV     A,R6
   \   000036   4F           ORL     A,R7
   \   000037   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1150                  {
   1151                    if ( pAddrRsp->status == ZSuccess )
   \   000039   8E82         MOV     DPL,R6
   \   00003B   8F83         MOV     DPH,R7
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   7011         JNZ     ??ZDApp_ProcessMsgCBs_3
   1152                    {
   1153                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000040                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000040   EE           MOV     A,R6
   \   000041   2403         ADD     A,#0x3
   \   000043   FC           MOV     R4,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   FD           MOV     R5,A
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   FB           MOV     R3,A
   \   00004E   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1154                    }
   1155                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000051                ; Setup parameters for call to function osal_mem_free
   \   000051   EE           MOV     A,R6
   \   000052   FA           MOV     R2,A
   \   000053   EF           MOV     A,R7
   \   000054   FB           MOV     R3,A
   \   000055   12....       LCALL   ??osal_mem_free?relay
   \   000058   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1156                  }
   1157                }
   1158                break;
   1159          #endif
   1160                
   1161          #if defined ( REFLECTOR )
   1162              case Bind_req:
   1163              case Unbind_req:
   1164                {
   1165                  ZDO_BindUnbindReq_t bindReq;
   1166                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00005A                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00005A   85..82       MOV     DPL,?XSP + 0
   \   00005D   85..83       MOV     DPH,?XSP + 1
   \   000060   AC82         MOV     R4,DPL
   \   000062   AD83         MOV     R5,DPH
   \   000064   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1167                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000067                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000067   85..82       MOV     DPL,?XSP + 0
   \   00006A   85..83       MOV     DPH,?XSP + 1
   \   00006D   AC82         MOV     R4,DPL
   \   00006F   AD83         MOV     R5,DPH
   \   000071   EE           MOV     A,R6
   \   000072   FA           MOV     R2,A
   \   000073   EF           MOV     A,R7
   \   000074   FB           MOV     R3,A
   \   000075   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1168                }
   1169                break;
   1170          #endif      
   1171          
   1172          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1173              case Bind_rsp:
   1174              case Unbind_rsp:
   1175                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1176                {
   1177                  ZDMatchSendState(
   1178                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1179                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1180                }
   1181                break;
   1182                
   1183              case End_Device_Bind_req:
   1184                if (ZG_DEVICE_COORDINATOR_TYPE)
   1185                {
   1186                  ZDEndDeviceBind_t bindReq;
   1187                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1188                  ZDO_MatchEndDeviceBind( &bindReq );
   1189                  
   1190                  // Freeing the cluster lists - if allocated.
   1191                  if ( bindReq.numInClusters )
   1192                    osal_mem_free( bindReq.inClusters );
   1193                  if ( bindReq.numOutClusters )
   1194                    osal_mem_free( bindReq.outClusters );
   1195                }
   1196                break;
   1197          #endif
   1198            }
   1199          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000078                REQUIRE ?Subroutine5
   \   000078                ; // Fall through to label ?Subroutine5

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7415         MOV     A,#0x15
   \   000002   02....       LJMP    ??Subroutine29_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   EA           MOV     A,R2
   \   000001   FE           MOV     R6,A
   \   000002   EB           MOV     A,R3
   \   000003   FF           MOV     R7,A
   \   000004   EE           MOV     A,R6
   \   000005   240C         ADD     A,#0xc
   \   000007                REQUIRE ??Subroutine27_0
   \   000007                ; // Fall through to label ??Subroutine27_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1200          
   1201          /*********************************************************************
   1202           * @fn      ZDApp_RegisterCBs()
   1203           *
   1204           * @brief   Process response messages
   1205           *
   1206           * @param   none
   1207           *
   1208           * @return  none
   1209           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1210          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1211          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1212          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1213            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine11 & 0xFFFF
   1214          #endif
   1215          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1216            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_25:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine11 & 0xFFFF
   1217          #endif  
   1218          #if ZG_BUILD_COORDINATOR_TYPE
   1219            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1220            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1221            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1222          #endif
   1223          #if defined ( REFLECTOR )
   1224            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_26:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   1225            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_27:
   \   000015                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000015   7A22         MOV     R2,#0x22
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   1226          #endif  
   1227          }
   \                     ??CrossCallReturnLabel_28:
   \   00001C   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine23_0
   \   000002                ; // Fall through to label ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1228          
   1229          /*********************************************************************
   1230           * @fn      ZDApp_ProcessSecMsg()
   1231           *
   1232           * @brief   Process the incoming security message.
   1233           *
   1234           * @param   msgPtr - message to process
   1235           *
   1236           * @return  none
   1237           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1238          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1239          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1240            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   24FA         ADD     A,#-0x6
   \   00000B   6006         JZ      ??ZDApp_ProcessSecMsg_0
   \   00000D   24FC         ADD     A,#-0x4
   \   00000F   6014         JZ      ??ZDApp_ProcessSecMsg_1
   \   000011   8022         SJMP    ??ZDApp_ProcessSecMsg_2
   1241            {
   1242              case ZDO_ESTABLISH_KEY_CFM:
   1243                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1244                {
   1245                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1246                }
   1247                break;
   1248          
   1249              case ZDO_ESTABLISH_KEY_IND:
   1250                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1251                {
   1252                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1253                  {
   1254                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1255                  }
   1256                }
   1257                break;
   1258          
   1259              case ZDO_TRANSPORT_KEY_IND:
   1260                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000013   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000016   E0           MOVX    A,@DPTR
   \   000017   6401         XRL     A,#0x1
   \   000019   6005         JZ      ??ZDApp_ProcessSecMsg_3
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   6402         XRL     A,#0x2
   \   00001E   7015         JNZ     ??ZDApp_ProcessSecMsg_2
   1261                {
   1262                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000020                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   000020   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   \   000023   8010         SJMP    ??ZDApp_ProcessSecMsg_2
   1263                }
   1264                break;
   1265          
   1266              case ZDO_UPDATE_DEVICE_IND:
   1267                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1268                {
   1269                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1270                }
   1271                break;
   1272          
   1273              case ZDO_REMOVE_DEVICE_IND:
   1274                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1275                {
   1276                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1277                }
   1278                break;
   1279          
   1280              case ZDO_REQUEST_KEY_IND:
   1281                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1282                {
   1283                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1284                  {
   1285                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1286                  }
   1287                }
   1288                break;
   1289          
   1290              case ZDO_SWITCH_KEY_IND:
   1291                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   000025   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6401         XRL     A,#0x1
   \   00002B   6005         JZ      ??ZDApp_ProcessSecMsg_4
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6402         XRL     A,#0x2
   \   000030   7003         JNZ     ??ZDApp_ProcessSecMsg_2
   1292                {
   1293                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000032                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000032   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1294                }
   1295                break;
   1296              
   1297              case ZDO_AUTHENTICATE_IND:
   1298                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1299                {
   1300                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1301                }
   1302                break;
   1303          
   1304              case ZDO_AUTHENTICATE_CFM:
   1305                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1306                {
   1307                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1308                }
   1309                break;
   1310          
   1311              default:
   1312                // Unsupported messages
   1313                break;
   1314            }
   1315          }
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000035   02....       LJMP    ?Subroutine2 & 0xFFFF
   1316          
   1317          /*********************************************************************
   1318           * @fn      ZDApp_ProcessNetworkJoin()
   1319           *
   1320           * @brief
   1321           *
   1322           *   Save off the Network key information.
   1323           *
   1324           * @param   none
   1325           *
   1326           * @return  none
   1327           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1328          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1329          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1330            // devState 在 ZDO_StartDevice() 函数中改变状态值
   1331            if ( (devState == DEV_NWK_JOINING) ||
   1332                ((devState == DEV_NWK_ORPHAN)  &&
   1333                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1334            {
   1335              // Result of a Join attempt by this device.
   1336              // nwkStatus 在 ZDO_JoinConfirmCB() 函数中改变状态值，
   1337              // 实际来自于 NLME_JoinRequest() 函数的返回结果，此返回
   1338              // 结果被反馈给了 ZDO_JoinConfirmCB()
   1339              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   701C         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1340              {
   1341                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine10 & 0xFFFF
   1342          
   1343          #if defined ( POWER_SAVING )
   1344                osal_pwrmgr_device( PWRMGR_BATTERY );
   \                     ??CrossCallReturnLabel_44:
   \   000030                ; Setup parameters for call to function osal_pwrmgr_device
   \   000030   7901         MOV     R1,#0x1
   \   000032   12....       LCALL   ??osal_pwrmgr_device?relay
   1345          #endif
   1346          
   1347                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1348                {
   1349                  // wait for auth from trust center!!
   1350                  devState = DEV_END_DEVICE_UNAUTH;
   1351          
   1352                  // Start the reset timer for MAX UNAUTH time
   1353                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1354                }
   1355                else
   1356                {
   1357                  if ( ZSTACK_ROUTER_BUILD )
   1358                  {
   1359                    if ( devState == DEV_NWK_ORPHAN 
   1360                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1361                    {
   1362                      // Change NIB state to router for restore
   1363                      _NIB.nwkState = NWK_ROUTER;
   1364                    }
   1365                  }
   1366                          
   1367                  if ( devState == DEV_NWK_JOINING )
   \   000035   90....       MOV     DPTR,#devState
   \   000038   E0           MOVX    A,@DPTR
   \   000039   6403         XRL     A,#0x3
   \   00003B   7003         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1368                  {
   1369                    ZDApp_AnnounceNewAddress();
   \   00003D                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00003D   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1370                  }
   1371                  
   1372                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000040   90....       MOV     DPTR,#devState
   \   000043   7406         MOV     A,#0x6
   \   000045   F0           MOVX    @DPTR,A
   1373                  if ( ZSTACK_ROUTER_BUILD )
   \   000046   02....       LJMP    ??CrossCallReturnLabel_15 & 0xFFFF
   1374                  {
   1375                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1376                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1377                    {
   1378                      NLME_StartRouterRequest( 0, 0, false );
   1379                    }
   1380                  }
   1381                }
   1382              }
   1383              else
   1384              {
   1385                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000049   90....       MOV     DPTR,#devStartMode
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   6401         XRL     A,#0x1
   \   00004F   7031         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000051   90....       MOV     DPTR,#retryCnt
   \   000054   E0           MOVX    A,@DPTR
   \   000055   04           INC     A
   \   000056   F0           MOVX    @DPTR,A
   \   000057   C3           CLR     C
   \   000058   9403         SUBB    A,#0x3
   \   00005A   4026         JC      ??ZDApp_ProcessNetworkJoin_5
   1386                {
   1387                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00005C   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   00005F   7003         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   000061   74FF         MOV     A,#-0x1
   \   000063   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   000064   600A         JZ      ??ZDApp_ProcessNetworkJoin_7
   \   000066   74FE         MOV     A,#-0x2
   \   000068   68           XRL     A,R0
   \   000069   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00006B   74FF         MOV     A,#-0x1
   \   00006D   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   00006E   7006         JNZ     ??ZDApp_ProcessNetworkJoin_9
   1388                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000070   90....       MOV     DPTR,#devStartMode
   \   000073   E4           CLR     A
   \   000074   800B         SJMP    ??ZDApp_ProcessNetworkJoin_10
   1389                  else
   1390                  {
   1391                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   000076   90....       MOV     DPTR,#devStartMode
   \   000079   7403         MOV     A,#0x3
   \   00007B   F0           MOVX    @DPTR,A
   1392                    _tmpRejoinState = true;
   \   00007C   90....       MOV     DPTR,#_tmpRejoinState
   \   00007F   7401         MOV     A,#0x1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   000081   F0           MOVX    @DPTR,A
   1393                  }
   1394                }
   1395          
   1396                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1397                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000082                ; Setup parameters for call to function NLME_GetShortAddr
   \   000082   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000085   8A..         MOV     ?V0 + 0,R2
   \   000087   8B..         MOV     ?V0 + 1,R3
   \   000089   74FE         MOV     A,#-0x2
   \   00008B   65..         XRL     A,?V0 + 0
   \   00008D   7004         JNZ     ??ZDApp_ProcessNetworkJoin_11
   \   00008F   74FF         MOV     A,#-0x1
   \   000091   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   000093   700D         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   000095   90....       MOV     DPTR,#_NIB + 20
   \   000098   E0           MOVX    A,@DPTR
   \   000099   64FE         XRL     A,#0xfe
   \   00009B   7003         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   00009D   A3           INC     DPTR
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   F4           CPL     A
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000A0   6023         JZ      ??ZDApp_ProcessNetworkJoin_14
   1398                {
   1399                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000A2   85..82       MOV     DPL,?XSP + 0
   \   0000A5   85..83       MOV     DPH,?XSP + 1
   \   0000A8   74FE         MOV     A,#-0x2
   \   0000AA   F0           MOVX    @DPTR,A
   \   0000AB   A3           INC     DPTR
   \   0000AC   04           INC     A
   \   0000AD   F0           MOVX    @DPTR,A
   1400                  // Invalidate nwk addr so end device does not use in its data reqs.
   1401                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000AE   90....       MOV     DPTR,#_NIB + 20
   \   0000B1   14           DEC     A
   \   0000B2   F0           MOVX    @DPTR,A
   \   0000B3   A3           INC     DPTR
   \   0000B4   04           INC     A
   \   0000B5   F0           MOVX    @DPTR,A
   1402                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000B6                ; Setup parameters for call to function ZMacSetReq
   \   0000B6   85..82       MOV     DPL,?XSP + 0
   \   0000B9   85..83       MOV     DPH,?XSP + 1
   \   0000BC   AA82         MOV     R2,DPL
   \   0000BE   AB83         MOV     R3,DPH
   \   0000C0   7953         MOV     R1,#0x53
   \   0000C2   12....       LCALL   ??ZMacSetReq?relay
   1403                }
   1404          
   1405                // Clear the neighbor Table and network discovery tables.
   1406                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000C5                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000C5   12....       LCALL   ??nwkNeighborInitTable?relay
   1407                NLME_NwkDiscTerm();
   \   0000C8                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000C8   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1408          
   1409                zdoDiscCounter = 1;
   \   0000CB   90....       MOV     DPTR,#zdoDiscCounter
   \   0000CE   7401         MOV     A,#0x1
   \   0000D0   F0           MOVX    @DPTR,A
   1410          
   1411          //      ZDApp_NetworkInit( (uint16)
   1412          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1413          //                          (NWK_START_DELAY * 5)) );
   1414                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1415                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000D1                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000D1                ; Setup parameters for call to function osal_rand
   \   0000D1   8067         SJMP    ??ZDApp_ProcessNetworkJoin_15
   1416              }
   1417            }
   1418            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   6404         XRL     A,#0x4
   \   0000D6   7065         JNZ     ??CrossCallReturnLabel_15
   1419            {
   1420              // results of an orphaning attempt by this device
   1421              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000D8   90....       MOV     DPTR,#nwkStatus
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   7013         JNZ     ??ZDApp_ProcessNetworkJoin_16
   1422              {
   1423                if ( ZG_SECURE_ENABLED )
   1424                {
   1425                  ZDApp_RestoreNwkKey();
   1426                }
   1427                
   1428                devState = DEV_END_DEVICE;
   \   0000DE   12....       LCALL   ?Subroutine6 & 0xFFFF
   1429                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1430                // setup Power Manager Device
   1431          #if defined ( POWER_SAVING )
   1432                osal_pwrmgr_device( PWRMGR_BATTERY );
   1433          #endif
   1434          
   1435                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_1:
   \   0000E1   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000E4   E0           MOVX    A,@DPTR
   \   0000E5   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000E7   5003         JNC     ??CrossCallReturnLabel_19
   1436                {
   1437                  // The receiver is on, turn network layer polling off.
   1438                  NLME_SetPollRate( 0 );
   \   0000E9                ; Setup parameters for call to function NLME_SetPollRate
   \   0000E9   12....       LCALL   ?Subroutine19 & 0xFFFF
   1439                  NLME_SetQueuedPollRate( 0 );
   1440                  NLME_SetResponseRate( 0 );
   1441                }
   1442          
   1443                if ( ZSTACK_ROUTER_BUILD )
   1444                {
   1445                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1446                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   1447                  {
   1448                    NLME_StartRouterRequest( 0, 0, false );
   1449                  }
   1450                }
   1451                
   1452                ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_19:
   \   0000EC                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   0000EC   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   0000EF   804C         SJMP    ??CrossCallReturnLabel_15
   1453              }
   1454              else
   1455              {
   1456                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000F1   90....       MOV     DPTR,#devStartMode
   \   0000F4   E0           MOVX    A,@DPTR
   \   0000F5   6401         XRL     A,#0x1
   \   0000F7   703B         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1457                {
   1458                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   0000F9   90....       MOV     DPTR,#retryCnt
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   04           INC     A
   \   0000FE   F0           MOVX    @DPTR,A
   \   0000FF   C3           CLR     C
   \   000100   9404         SUBB    A,#0x4
   \   000102   5028         JNC     ??ZDApp_ProcessNetworkJoin_18
   1459                  {
   1460                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000104   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000107   7003         JNZ     ??ZDApp_ProcessNetworkJoin_19
   \   000109   74FF         MOV     A,#-0x1
   \   00010B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   00010C   600A         JZ      ??ZDApp_ProcessNetworkJoin_20
   \   00010E   74FE         MOV     A,#-0x2
   \   000110   68           XRL     A,R0
   \   000111   7003         JNZ     ??ZDApp_ProcessNetworkJoin_21
   \   000113   74FF         MOV     A,#-0x1
   \   000115   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   000116   7007         JNZ     ??ZDApp_ProcessNetworkJoin_22
   1461                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000118   90....       MOV     DPTR,#devStartMode
   \   00011B   E4           CLR     A
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00011C   F0           MOVX    @DPTR,A
   \   00011D   8015         SJMP    ??ZDApp_ProcessNetworkJoin_17
   1462                    else
   1463                    {
   1464                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00011F   90....       MOV     DPTR,#devStartMode
   \   000122   7403         MOV     A,#0x3
   \   000124   F0           MOVX    @DPTR,A
   1465                      _tmpRejoinState = true;
   \   000125   90....       MOV     DPTR,#_tmpRejoinState
   \   000128   7401         MOV     A,#0x1
   \   00012A   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_23
   1466                    }
   1467                  }
   1468                  // Do a normal join to the network after certain times of rejoin retries
   1469                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   00012C   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00012F   E0           MOVX    A,@DPTR
   \   000130   6401         XRL     A,#0x1
   \   000132   60E4         JZ      ??ZDApp_ProcessNetworkJoin_20
   1470                  {
   1471                    devStartMode = MODE_JOIN;
   1472                  }
   1473                }
   1474          
   1475                // Clear the neighbor Table and network discovery tables.
   1476                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000134                ; Setup parameters for call to function nwkNeighborInitTable
   \   000134   12....       LCALL   ??nwkNeighborInitTable?relay
   1477                NLME_NwkDiscTerm();
   \   000137                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   000137   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1478          
   1479                // setup a retry for later...
   1480                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1481                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   00013A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00013A                ; Setup parameters for call to function osal_rand
   1482              }
   1483            }
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   00013A   12....       LCALL   ?Subroutine16 & 0xFFFF
   1484          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1485            else
   1486            {
   1487              // Assume from address conflict
   1488              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1489              {
   1490                // Notify the network
   1491                ZDApp_AnnounceNewAddress();
   1492                
   1493                // Notify apps
   1494                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1495              }
   1496            }
   1497          #endif
   1498          }
   \                     ??CrossCallReturnLabel_15:
   \   00013D   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   90....       MOV     DPTR,#_NIB + 33
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1499          
   1500          /*********************************************************************
   1501           * @fn      ZDApp_SaveNwkKey()
   1502           *
   1503           * @brief   Save off the Network key information.
   1504           *
   1505           * @param   none
   1506           *
   1507           * @return  none
   1508           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1509          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1510          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1511            nwkActiveKeyItems keyItems;
   1512          
   1513            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1514            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1515          
   1516            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1517                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1518          
   1519            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1520          }
   \   000052                REQUIRE ?Subroutine4
   \   000052                ; // Fall through to label ?Subroutine4

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine24_0
   \   000006                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1521          
   1522          /*********************************************************************
   1523           * @fn      ZDApp_ResetNwkKey()
   1524           *
   1525           * @brief   Reset the Network key information in NV.
   1526           *
   1527           * @param   none
   1528           *
   1529           * @return  none
   1530           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1531          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1532          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1533            nwkActiveKeyItems keyItems;
   1534          
   1535            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine20 & 0xFFFF
   1536            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1537                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_21:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1538          }
   \   000023   02....       LJMP    ?Subroutine5 & 0xFFFF
   1539          
   1540          /*********************************************************************
   1541           * @fn      ZDApp_RestoreNwkKey()
   1542           *
   1543           * @brief
   1544           *
   1545           *   Save off the Network key information.
   1546           *
   1547           * @param   none
   1548           *
   1549           * @return  true if restored from NV, false if not
   1550           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1551          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1552          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1553            nwkActiveKeyItems keyItems;
   1554            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1555          
   1556            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1557                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1558            {
   1559              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   E5..         MOV     A,?V0 + 0
   \   000046   45..         ORL     A,?V0 + 1
   \   000048   45..         ORL     A,?V0 + 2
   \   00004A   45..         ORL     A,?V0 + 3
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1560              {
   1561                // Restore the key information
   1562                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1563                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1564                ret = true;
   \   00005E   0E           INC     R6
   1565              }
   1566          
   1567              // Force a save for the first frame counter increment
   1568              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1569            }
   1570            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine4 & 0xFFFF
   1571          }
   1572          
   1573          /*********************************************************************
   1574           * @fn      ZDApp_ResetTimerStart
   1575           *
   1576           * @brief   Start the reset timer.
   1577           *
   1578           * @param   delay - delay time(ms) before reset
   1579           *
   1580           * @return  none
   1581           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1582          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1583          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1584            // Start the rest timer
   1585            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine13 & 0xFFFF
   1586          }
   \                     ??CrossCallReturnLabel_33:
   \   00000D   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine25_0
   \   000005                ; // Fall through to label ??Subroutine25_0
   1587          
   1588          /*********************************************************************
   1589           * @fn      ZDApp_ResetTimerCancel
   1590           *
   1591           * @brief   Cancel the reset timer.
   1592           *
   1593           * @param   none
   1594           *
   1595           * @return  none
   1596           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1597          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1598          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1599            // Cancel the reset timer
   1600            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1601          }
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   1602          
   1603          /*********************************************************************
   1604           * @fn      ZDApp_LeaveCtrlInit
   1605           *
   1606           * @brief   Initialize the leave control logic.
   1607           *
   1608           * @param   none
   1609           *
   1610           * @return  none
   1611           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1612          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1613          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1614            uint8 status;
   1615          
   1616          
   1617            // Initialize control state
   1618            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine8 & 0xFFFF
   1619          
   1620            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1621                                        sizeof(ZDApp_LeaveCtrl),
   1622                                        &ZDApp_LeaveCtrl );
   1623          
   1624            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_4:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1625            {
   1626              // Read saved control
   1627              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1628                            0,
   1629                            sizeof( uint8 ),
   1630                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1631            }
   1632          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine30_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   000008   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1633          
   1634          /*********************************************************************
   1635           * @fn      ZDApp_LeaveCtrlSet
   1636           *
   1637           * @brief   Set the leave control logic.
   1638           *
   1639           * @param   ra - reassociate flag
   1640           *
   1641           * @return  none
   1642           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1643          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1644          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1645            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1646          
   1647            if ( ra == TRUE )
   \   00000D   6E           XRL     A,R6
   \   00000E   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1648            {
   1649              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   1650            }
   1651          
   1652            // Write the leave control
   1653            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1654                           0,
   1655                           sizeof( uint8 ),
   1656                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000013                ; Setup parameters for call to function osal_nv_write
   \   000013   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   000016   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000019   78..         MOV     R0,#?V0 + 0
   \   00001B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001E   75..01       MOV     ?V0 + 0,#0x1
   \   000021   75..00       MOV     ?V0 + 1,#0x0
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000029   7C00         MOV     R4,#0x0
   \   00002B   7D00         MOV     R5,#0x0
   \   00002D   7A85         MOV     R2,#-0x7b
   \   00002F   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000032   02....       LJMP    ??Subroutine29_0 & 0xFFFF
   1657          }
   1658          
   1659          /*********************************************************************
   1660           * @fn      ZDApp_LeaveCtrlBypass
   1661           *
   1662           * @brief   Check if NV restore should be skipped during a leave reset.
   1663           *
   1664           * @param   none
   1665           *
   1666           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1667           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1668          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1669          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1670            uint8 bypass;
   1671          
   1672            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1673            {
   1674              bypass = TRUE;
   1675            }
   1676            else
   1677            {
   1678              bypass = FALSE;
   1679            }
   1680          
   1681            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   33           RLC     A
   \   00000C   F9           MOV     R1,A
   \   00000D                REQUIRE ?Subroutine2
   \   00000D                ; // Fall through to label ?Subroutine2
   1682          }
   1683          
   1684          /*********************************************************************
   1685           * @fn      ZDApp_LeaveCtrlStartup
   1686           *
   1687           * @brief   Check for startup conditions during a leave reset.
   1688           *
   1689           * @param   state      - devState_t determined by leave control logic
   1690           * @param   startDelay - startup delay
   1691           *
   1692           * @return  none
   1693           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1694          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1695          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1696            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1697          
   1698            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1699            {
   1700              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1701              {
   1702                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1703              }
   1704              else
   1705              {
   1706                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   8A82         MOV     DPL,R2
   \   000027   8B83         MOV     DPH,R3
   \   000029   E4           CLR     A
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1707              }
   1708          
   1709              // Set leave control to initialized state
   1710              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine8 & 0xFFFF
   1711          
   1712              // Write initialized control
   1713              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1714                            0,
   1715                            sizeof( uint8 ),
   1716                            &ZDApp_LeaveCtrl);
   1717            }
   \                     ??CrossCallReturnLabel_5:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1718          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine30_0 & 0xFFFF
   1719          
   1720          /*********************************************************************
   1721           * @fn      ZDApp_LeaveReset
   1722           *
   1723           * @brief   Setup a device reset due to a leave indication/confirm.
   1724           *
   1725           * @param   ra - reassociate flag
   1726           *
   1727           * @return  none
   1728           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1729          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1730          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1731            ZDApp_LeaveCtrlSet( ra );
   \   000005                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000005   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1732          
   1733            ZDApp_ResetTimerStart( 5000 );
   \   000008                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000008   7A88         MOV     R2,#-0x78
   \   00000A   7B13         MOV     R3,#0x13
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1734          }
   \   00000F   80..         SJMP    ??Subroutine26_0
   1735          
   1736          /*********************************************************************
   1737           * @fn      ZDApp_LeaveUpdate
   1738           *
   1739           * @brief   Update local device data related to leaving device.
   1740           *
   1741           * @param   nwkAddr        - NWK address of leaving device
   1742           * @param   extAddr        - EXT address of leaving device
   1743           * @param   removeChildren - remove children of leaving device
   1744           *
   1745           * @return  none
   1746           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1747          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1748                                  uint8 removeChildren )
   1749          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   1750            /*
   1751            AddrMgrEntry_t entry;
   1752            */
   1753            (void)nwkAddr;  // Intentionally unreferenced parameter
   1754          
   1755            // Remove if child
   1756            if ( ZSTACK_ROUTER_BUILD )
   1757            {
   1758              NLME_RemoveChild( extAddr, removeChildren );
   1759            }
   1760          
   1761            /*
   1762            // Set NWK address to invalid
   1763            entry.user    = ADDRMGR_USER_DEFAULT;
   1764            entry.nwkAddr = INVALID_NODE_ADDR;
   1765            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1766            AddrMgrEntryUpdate( &entry );
   1767          
   1768            // Check
   1769            if ( removeChildren == TRUE )
   1770            {
   1771              // Set index to INVALID_NODE_ADDR to start search
   1772              entry.index = INVALID_NODE_ADDR;
   1773          
   1774              // Get first entry
   1775              AddrMgrEntryGetNext( &entry );
   1776          
   1777              // Remove all descendents
   1778              while ( entry.index != INVALID_NODE_ADDR )
   1779              {
   1780                // Check NWK address allocation algorithm
   1781                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1782                {
   1783                  // Set NWK address to invalid
   1784                  entry.nwkAddr = INVALID_NODE_ADDR;
   1785                  AddrMgrEntryUpdate( &entry );
   1786                }
   1787          
   1788                // Get next entry
   1789                AddrMgrEntryGetNext( &entry );
   1790              }
   1791            }
   1792            */
   1793          }
   \   000000   02....       LJMP    ?BRET
   1794          
   1795          /*********************************************************************
   1796           * CALLBACK FUNCTIONS
   1797           */
   1798          
   1799          
   1800          /*********************************************************************
   1801           * @fn      ZDApp_SendEventMsg()
   1802           *
   1803           * @brief
   1804           *
   1805           *   Sends a Network Join message
   1806           *
   1807           * @param  cmd - command ID
   1808           * @param  len - length (in bytes) of the buf field
   1809           * @param  buf - buffer for the rest of the message.
   1810           *
   1811           * @return  none
   1812           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000003                REQUIRE ??Subroutine26_0
   \   000003                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1813          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1814          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   1815            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000008                ; Setup parameters for call to function ZDApp_SendMsg
   \   000008   FB           MOV     R3,A
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B   80..         SJMP    ?Subroutine0
   1816          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1817          
   1818          /*********************************************************************
   1819           * @fn      ZDApp_SendMsg()
   1820           *
   1821           * @brief   Sends a OSAL message
   1822           *
   1823           * @param  taskID - Where to send the message
   1824           * @param  cmd - command ID
   1825           * @param  len - length (in bytes) of the buf field
   1826           * @param  buf - buffer for the rest of the message.
   1827           *
   1828           * @return  none
   1829           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1830          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1831          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 6,R2
   \   000009   8B..         MOV     ?V0 + 5,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1832            osal_event_hdr_t *msgPtr;
   1833          
   1834            // Send the address to the task
   1835            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014   75..00       MOV     ?V0 + 1,#0x0
   \   000017                ; Setup parameters for call to function osal_msg_allocate
   \   000017   AA..         MOV     R2,?V0 + 0
   \   000019   AB..         MOV     R3,?V0 + 1
   \   00001B   12....       LCALL   ??osal_msg_allocate?relay
   \   00001E   8A..         MOV     ?V0 + 8,R2
   \   000020   8B..         MOV     ?V0 + 9,R3
   \   000022   AE..         MOV     R6,?V0 + 8
   \   000024   AF..         MOV     R7,?V0 + 9
   1836            if ( msgPtr )
   \   000026   EE           MOV     A,R6
   \   000027   4F           ORL     A,R7
   \   000028   6034         JZ      ??ZDApp_SendMsg_0
   1837            {
   1838              if ( (len > 0) && (buf != NULL) )
   \   00002A   E5..         MOV     A,?V0 + 5
   \   00002C   6020         JZ      ??ZDApp_SendMsg_1
   \   00002E   E5..         MOV     A,?V0 + 2
   \   000030   45..         ORL     A,?V0 + 3
   \   000032   601A         JZ      ??ZDApp_SendMsg_1
   1839                osal_memcpy( msgPtr, buf, len );
   \   000034                ; Setup parameters for call to function osal_memcpy
   \   000034   85....       MOV     ?V0 + 8,?V0 + 2
   \   000037   85....       MOV     ?V0 + 9,?V0 + 3
   \   00003A   75..00       MOV     ?V0 + 10,#0x0
   \   00003D   78..         MOV     R0,#?V0 + 8
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000042   AC..         MOV     R4,?V0 + 0
   \   000044   AD..         MOV     R5,?V0 + 1
   \   000046   12....       LCALL   ??osal_memcpy?relay
   \   000049   7403         MOV     A,#0x3
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
   1840          
   1841              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   E5..         MOV     A,?V0 + 6
   \   000054   F0           MOVX    @DPTR,A
   1842              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000055                ; Setup parameters for call to function osal_msg_send
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   A9..         MOV     R1,?V0 + 4
   \   00005B   12....       LCALL   ??osal_msg_send?relay
   1843            }
   1844          }
   \                     ??ZDApp_SendMsg_0:
   \   00005E   7F0B         MOV     R7,#0xb
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   1845          
   1846          /*********************************************************************
   1847           * Call Back Functions from NWK  - API
   1848           */
   1849          
   1850          /*********************************************************************
   1851           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1852           *
   1853           * @brief       This function returns a choice of PAN to join.
   1854           *
   1855           * @param       ResultCount - Number of routers discovered
   1856           * @param               NetworkList - Pointer to list of network descriptors
   1857           *
   1858           * @return      ZStatus_t
   1859           */
   1860          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1861          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1862                                                   networkDesc_t *NetworkList )
   1863          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 4,R1
   \   00000C   8A..         MOV     ?V0 + 6,R2
   \   00000E   8B..         MOV     ?V0 + 7,R3
   1864            networkDesc_t *pNwkDesc = NetworkList;
   1865            ZDO_NetworkDiscoveryCfm_t msg;
   1866            uint8 i = ResultCount;
   1867            uint8 stackProfile;
   1868            uint8 stackProfilePro;
   1869            uint8 selected;
   1870          
   1871          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1872            if ( zdappMgmtNwkDiscReqInProgress )
   1873            {
   1874              zdappMgmtNwkDiscReqInProgress = false;
   1875              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1876              return ( ZSuccess );
   1877            }
   1878          #endif
   1879          
   1880            // process discovery results
   1881            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1882            selected = FALSE;
   1883          
   1884            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 5,#0x0
   1885            {
   1886              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 6
   \   000018   AF..         MOV     R7,?V0 + 7
   1887              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1888              {
   1889                if ( zgConfigPANID != 0xFFFF )
   1890                {
   1891                  // PAN Id is preconfigured. check if it matches
   1892                  if ( pNwkDesc->panId != zgConfigPANID )
   1893                    continue;
   1894                }
   1895                
   1896          
   1897                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1898                {
   1899                  // If the extended Pan ID is commissioned to a non zero value
   1900                  // Only join the Pan that has match EPID
   1901                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1902                    continue;
   1903                  
   1904                }
   1905          
   1906          
   1907                  // check that network is allowing joining
   1908                  if ( ZSTACK_ROUTER_BUILD )
   1909                  {
   1910                    if ( stackProfilePro == FALSE )
   1911                    {
   1912                      if ( !pNwkDesc->routerCapacity )
   1913                      {
   1914                        continue;
   1915                      }
   1916                    }
   1917                    else
   1918                    {
   1919                      if ( !pNwkDesc->deviceCapacity )
   1920                      {
   1921                        continue;
   1922                      }
   1923                    }
   1924                  }
   1925                  else if ( ZSTACK_END_DEVICE_BUILD )
   1926                  {
   1927                    if ( !pNwkDesc->deviceCapacity )
   1928                    {
   1929                      continue;
   1930                    }
   1931                  }
   1932          
   1933                  // check version of zigbee protocol
   1934                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1935                    continue;
   1936          
   1937                  // check version of stack profile
   1938                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1939                  {
   1940                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1941                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   68           XRL     A,R0
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1942                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   1943                    
   1944                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 5
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 4
   \   000058   507F         JNC     ??ZDO_NetworkDiscoveryConfirmCB_7
   \   00005A   90....       MOV     DPTR,#zgConfigPANID
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F4           CPL     A
   \   00005F   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   F4           CPL     A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000064   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   000066   8E82         MOV     DPL,R6
   \   000068   8F83         MOV     DPH,R7
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   F8           MOV     R0,A
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   F9           MOV     R1,A
   \   00006F   90....       MOV     DPTR,#zgConfigPANID
   \   000072   E0           MOVX    A,@DPTR
   \   000073   68           XRL     A,R0
   \   000074   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   000076   A3           INC     DPTR
   \   000077   E0           MOVX    A,@DPTR
   \   000078   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   000079   70B8         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   00007B                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00007B   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00007D   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00007F   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000082   E9           MOV     A,R1
   \   000083   6401         XRL     A,#0x1
   \   000085   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   000087                ; Setup parameters for call to function sAddrExtCmp
   \   000087   AC..         MOV     R4,?V0 + 2
   \   000089   AD..         MOV     R5,?V0 + 3
   \   00008B   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00008D   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00008F   12....       LCALL   ??sAddrExtCmp?relay
   \   000092   E9           MOV     A,R1
   \   000093   609E         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   A3           INC     DPTR
   \   00009A   A3           INC     DPTR
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   6091         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \   0000A2   85..82       MOV     DPL,?V0 + 0
   \   0000A5   85..83       MOV     DPH,?V0 + 1
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   F8           MOV     R0,A
   \   0000AA   90....       MOV     DPTR,#_NIB + 17
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   68           XRL     A,R0
   \   0000AF   7082         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \   0000B1   8E82         MOV     DPL,R6
   \   0000B3   8F83         MOV     DPH,R7
   \   0000B5   A3           INC     DPTR
   \   0000B6   A3           INC     DPTR
   \   0000B7   A3           INC     DPTR
   \   0000B8   A3           INC     DPTR
   \   0000B9   A3           INC     DPTR
   \   0000BA   A3           INC     DPTR
   \   0000BB   A3           INC     DPTR
   \   0000BC   A3           INC     DPTR
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   F8           MOV     R0,A
   \   0000BF   90....       MOV     DPTR,#zgStackProfile
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   68           XRL     A,R0
   \   0000C4   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   6401         XRL     A,#0x1
   \   0000C9   6003         JZ      $+5
   \   0000CB   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000CE   7402         MOV     A,#0x2
   \   0000D0   68           XRL     A,R0
   \   0000D1   6003         JZ      $+5
   \   0000D3   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000D6   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1945                    {
   1946                      continue;
   1947                    }
   1948                  }
   1949          
   1950                // check if beacon order is the right value..
   1951                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1952                //    continue;
   1953          
   1954                // choose this pan for joining
   1955                break;
   1956              } 
   1957              if (i < ResultCount)
   1958              {
   1959               selected = TRUE;
   1960                break;
   1961              }
   1962             
   1963              // break if selected or stack profile pro wasn't found
   1964              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000D9   E5..         MOV     A,?V0 + 8
   \   0000DB   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_12
   1965              {
   1966                break;
   1967              }
   1968            }
   \   0000DD   05..         INC     ?V0 + 5
   \   0000DF   E5..         MOV     A,?V0 + 5
   \   0000E1   C3           CLR     C
   \   0000E2   9402         SUBB    A,#0x2
   \   0000E4   5003         JNC     $+5
   \   0000E6   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1969          
   1970            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000E9   E5..         MOV     A,?V0 + 4
   \   0000EB   65..         XRL     A,?V0 + 9
   \   0000ED   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1971            {
   1972              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000EF   7401         MOV     A,#0x1
   \   0000F1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F4   7401         MOV     A,#0x1
   \   0000F6   F0           MOVX    @DPTR,A
   \   0000F7   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_13
   1973            }
   1974            else
   1975            {
   1976              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   0000F9   7401         MOV     A,#0x1
   \   0000FB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FE   E4           CLR     A
   \   0000FF   F0           MOVX    @DPTR,A
   1977              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   000100   8E82         MOV     DPL,R6
   \   000102   8F83         MOV     DPH,R7
   \   000104   E0           MOVX    A,@DPTR
   \   000105   C0E0         PUSH    A
   \   000107   7402         MOV     A,#0x2
   \   000109   12....       LCALL   ?XSTACK_DISP0_8
   \   00010C   D0E0         POP     A
   \   00010E   F0           MOVX    @DPTR,A
   1978              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   00010F   8E82         MOV     DPL,R6
   \   000111   8F83         MOV     DPH,R7
   \   000113   A3           INC     DPTR
   \   000114   E0           MOVX    A,@DPTR
   \   000115   C0E0         PUSH    A
   \   000117   7403         MOV     A,#0x3
   \   000119   12....       LCALL   ?XSTACK_DISP0_8
   \   00011C   D0E0         POP     A
   \   00011E   F0           MOVX    @DPTR,A
   1979              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   00011F   8E82         MOV     DPL,R6
   \   000121   8F83         MOV     DPH,R7
   \   000123   A3           INC     DPTR
   \   000124   A3           INC     DPTR
   \   000125   E0           MOVX    A,@DPTR
   \   000126   C0E0         PUSH    A
   \   000128   7404         MOV     A,#0x4
   \   00012A   12....       LCALL   ?XSTACK_DISP0_8
   \   00012D   D0E0         POP     A
   \   00012F   F0           MOVX    @DPTR,A
   1980              msg.version = pNwkDesc->version;
   \   000130   85..82       MOV     DPL,?V0 + 0
   \   000133   85..83       MOV     DPH,?V0 + 1
   \   000136   E0           MOVX    A,@DPTR
   \   000137   C0E0         PUSH    A
   \   000139   7405         MOV     A,#0x5
   \   00013B   12....       LCALL   ?XSTACK_DISP0_8
   \   00013E   D0E0         POP     A
   \   000140   F0           MOVX    @DPTR,A
   1981              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000141                ; Setup parameters for call to function sAddrExtCpy
   \   000141   AC..         MOV     R4,?V0 + 2
   \   000143   AD..         MOV     R5,?V0 + 3
   \   000145   7406         MOV     A,#0x6
   \   000147   12....       LCALL   ?XSTACK_DISP0_8
   \   00014A   AA82         MOV     R2,DPL
   \   00014C   AB83         MOV     R3,DPH
   \   00014E   12....       LCALL   ??sAddrExtCpy?relay
   1982            }
   1983          
   1984            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   000151                ; Setup parameters for call to function ZDApp_SendMsg
   \   000151   85..82       MOV     DPL,?XSP + 0
   \   000154   85..83       MOV     DPH,?XSP + 1
   \   000157   AC82         MOV     R4,DPL
   \   000159   AD83         MOV     R5,DPH
   \   00015B   7B0E         MOV     R3,#0xe
   \   00015D   7A01         MOV     R2,#0x1
   \   00015F   12....       LCALL   ?Subroutine14 & 0xFFFF
   1985          
   1986            return (ZSuccess);
   \                     ??CrossCallReturnLabel_10:
   \   000162   7900         MOV     R1,#0x0
   \   000164   740E         MOV     A,#0xe
   \   000166   12....       LCALL   ?DEALLOC_XSTACK8
   \   000169   7F0A         MOV     R7,#0xa
   \   00016B   02....       LJMP    ?BANKED_LEAVE_XDATA
   1987          }  // ZDO_NetworkDiscoveryConfirmCB
   1988          
   1989          /*********************************************************************
   1990           * @fn          ZDO_NetworkFormationConfirmCB
   1991           *
   1992           * @brief       This function reports the results of the request to
   1993           *              initialize a coordinator in a network.
   1994           *
   1995           * @param       Status - Result of NLME_NetworkFormationRequest()
   1996           *
   1997           * @return      none
   1998           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1999          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2000          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2001            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2002          
   2003            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2004            {
   2005              // LED on shows Coordinator started
   2006              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2007          
   2008              // LED off forgets HOLD_AUTO_START
   2009              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   2010          
   2011          #if defined ( ZBIT )
   2012              SIM_SetColor(0xd0ffd0);
   2013          #endif
   2014          
   2015              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_22:
   \   00000F   700A         JNZ     ??CrossCallReturnLabel_47
   2016              {
   2017                // Began with HOLD_AUTO_START
   2018                devState = DEV_COORD_STARTING;
   \   000011   7408         MOV     A,#0x8
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8005         SJMP    ??CrossCallReturnLabel_47
   2019              }
   2020            }
   2021          #if defined(BLINK_LEDS)
   2022            else
   2023              //HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2024          #endif
   2025          
   2026            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000016                ; Setup parameters for call to function osal_set_event
   \   000016   7A02         MOV     R2,#0x2
   \   000018   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   2027          }
   \                     ??CrossCallReturnLabel_47:
   \   00001B   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7904         MOV     R1,#0x4
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7908         MOV     R1,#0x8
   \   00000B   12....       LCALL   ??HalLedSet?relay
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
   2028          
   2029          /*********************************************************************
   2030           * @fn          ZDO_StartRouterConfirmCB
   2031           *
   2032           * @brief       This function reports the results of the request to
   2033           *              start functioning as a router in a network.
   2034           *
   2035           * @param       Status - Result of NLME_StartRouterRequest()
   2036           *
   2037           * @return      none
   2038           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2039          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2040          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2041            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2042          
   2043            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   2044            {
   2045              // LED on shows Router started
   2046              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2047              // LED off forgets HOLD_AUTO_START
   2048              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2049              
   2050              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_23:
   \   00000F   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2051              {
   2052                // Began with HOLD_AUTO_START
   2053                devState = DEV_END_DEVICE;
   \   000011   7406         MOV     A,#0x6
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2054              }
   2055            }
   2056          #if defined(BLINK_LEDS)
   2057            else
   2058              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2059          #endif
   2060          
   2061            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A20         MOV     R2,#0x20
   \   00001F   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   2062          }
   \                     ??CrossCallReturnLabel_48:
   \   000022   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2063          
   2064          /*********************************************************************
   2065           * @fn          ZDO_JoinConfirmCB
   2066           *
   2067           * @brief       This function allows the next hight layer to be notified
   2068           *              of the results of its request to join itself or another
   2069           *              device to a network.
   2070           *
   2071           * @param       Status - Result of NLME_JoinRequest()
   2072           *
   2073           * @return      none
   2074           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2075          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2076          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2077            (void)PanId;  // remove if this parameter is used.
   2078            
   2079            // Status 为 NLME_JoinReques() 函数返回的结果；
   2080            // 若加入网络成功，则为 zSuccess，否则，为 zFailure
   2081            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2082          
   2083            if ( Status == ZSUCCESS ) // 加入网络成功？
   \   00000A   700A         JNZ     ??ZDO_JoinConfirmCB_0
   2084            {
   2085              // LED on shows device joined
   2086              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2087              // LED off forgets HOLD_AUTO_START
   2088              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2089              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_24:
   \   00000F   700C         JNZ     ??ZDO_JoinConfirmCB_1
   2090              {
   2091                // Began with HOLD_AUTO_START
   2092                devState = DEV_NWK_JOINING;
   \   000011   7403         MOV     A,#0x3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_JoinConfirmCB_1
   2093              }
   2094          
   2095              if ( !ZG_SECURE_ENABLED )
   2096              {
   2097                // Notify to save info into NV
   2098                // 需要在 IAR 中定义 NV_RESTORE 预处理命令
   2099                ZDApp_NVUpdate();
   2100              }
   2101            }
   2102            else
   2103            {
   2104          #if defined(BLINK_LEDS)
   2105              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2106          #endif
   2107            }
   2108          
   2109            // Notify ZDApp
   2110            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001D   7C00         MOV     R4,#0x0
   \   00001F   7D00         MOV     R5,#0x0
   \   000021   7B02         MOV     R3,#0x2
   \   000023   7A02         MOV     R2,#0x2
   \   000025   02....       LJMP    ?Subroutine0 & 0xFFFF
   2111          }
   2112          
   2113          /*********************************************************************
   2114           * @fn          ZDO_AddrChangeIndicationCB
   2115           *
   2116           * @brief       This function notifies the application that this
   2117           *              device's address has changed.  Could happen in 
   2118           *              a network with stochastic addressing (PRO).
   2119           *
   2120           * @param       newAddr - the new address
   2121           *
   2122           * @return      none
   2123           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2124          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2125          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2126            (void)newAddr;  // remove if this parameter is used
   2127            
   2128            // Notify to save info into NV
   2129            ZDApp_NVUpdate();
   2130          
   2131            // Notify the applications   
   2132            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine10 & 0xFFFF
   2133          
   2134            // Send out a device announce
   2135            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_45:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2136          }
   \   00000A   02....       LJMP    ?Subroutine2 & 0xFFFF
   2137          
   2138          /*********************************************************************
   2139           * @fn          ZDO_JoinIndicationCB
   2140           *
   2141           * @brief       This function allows the next higher layer of a
   2142           *              coordinator to be notified of a remote join request.
   2143           *
   2144           * @param       ShortAddress - 16-bit address
   2145           * @param       ExtendedAddress - IEEE (64-bit) address
   2146           * @param       CapabilityInformation - Association Capability Information
   2147           * @param       type - of joining - 
   2148           *                          NWK_ASSOC_JOIN
   2149           *                          NWK_ASSOC_REJOIN_UNSECURE
   2150           *                          NWK_ASSOC_REJOIN_SECURE
   2151           *
   2152           * @return      ZStatus_t
   2153           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2154          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2155                                          uint8 CapabilityInformation, uint8 type )
   2156          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2157            (void)ShortAddress;
   2158            (void)ExtendedAddress;
   2159            (void)CapabilityInformation;
   2160            
   2161              // Notify to save info into NV
   2162              ZDApp_NVUpdate();
   2163            
   2164              // send notification to TC of new device..
   2165              if ( ZG_SECURE_ENABLED )
   2166              {
   2167                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2168                {
   2169                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2170                }
   2171              }
   2172            
   2173              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine3
   \   000000                ; // Fall through to label ?Subroutine3

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2174          }
   2175          
   2176          /*********************************************************************
   2177           * @fn          ZDO_ConcentratorIndicationCB
   2178           *
   2179           * @brief       This function allows the next higher layer of a
   2180           *              device to be notified of existence of the concentrator.
   2181           *
   2182           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2183           *
   2184           * @return      void 
   2185           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2186          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2187          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2188            // Write your code here to do something with the concentrator's
   2189            // address.
   2190            (void)nwkAddr;
   2191          }
   \   000000   02....       LJMP    ?BRET
   2192          
   2193          /*********************************************************************
   2194           * @fn          ZDO_LeaveCnf
   2195           *
   2196           * @brief       This function allows the next higher layer to be
   2197           *              notified of the results of its request for this or
   2198           *              a child device to leave the network.
   2199           *
   2200           * @param       cnf - NLME_LeaveCnf_t
   2201           *
   2202           * @return      none
   2203           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2204          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2205          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2206            // Check for this device
   2207            if ( osal_ExtAddrEqual( cnf->extAddr,
   2208                                    NLME_GetExtAddr() ) == TRUE )
   \   000009                ; Setup parameters for call to function sAddrExtCmp
   \   000009                ; Setup parameters for call to function NLME_GetExtAddr
   \   000009   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000C   EA           MOV     A,R2
   \   00000D   FC           MOV     R4,A
   \   00000E   EB           MOV     A,R3
   \   00000F   FD           MOV     R5,A
   \   000010   EE           MOV     A,R6
   \   000011   2402         ADD     A,#0x2
   \   000013   FA           MOV     R2,A
   \   000014   EF           MOV     A,R7
   \   000015   3400         ADDC    A,#0x0
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??sAddrExtCmp?relay
   \   00001B   E9           MOV     A,R1
   \   00001C   6401         XRL     A,#0x1
   \   00001E   7006         JNZ     ??CrossCallReturnLabel_16
   2209            {
   2210              // Prepare to leave with reset
   2211              ZDApp_LeaveReset( cnf->rejoin );
   \   000020                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   12....       LCALL   ?Subroutine17 & 0xFFFF
   2212            }
   2213            else if ( ZSTACK_ROUTER_BUILD )
   2214            {
   2215              // Remove device address(optionally descendents) from data
   2216              ZDApp_LeaveUpdate( cnf->dstAddr,
   2217                                 cnf->extAddr,
   2218                                 cnf->removeChildren );
   2219            }
   2220          }
   \                     ??CrossCallReturnLabel_16:
   \   000026   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F9           MOV     R1,A
   \   000009   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00000C   22           RET
   2221          
   2222          /*********************************************************************
   2223           * @fn          ZDO_LeaveInd
   2224           *
   2225           * @brief       This function allows the next higher layer of a
   2226           *              device to be notified of a remote leave request or
   2227           *              indication.
   2228           *
   2229           * @param       ind - NLME_LeaveInd_t
   2230           *
   2231           * @return      none
   2232           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2233          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2234          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2235            uint8 leave;
   2236          
   2237          
   2238            // Parent is requesting the leave - NWK layer filters out illegal
   2239            // requests
   2240            if ( ind->request == TRUE )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6401         XRL     A,#0x1
   \   00001A   7008         JNZ     ??ZDO_LeaveInd_0
   2241            {
   2242              // Notify network of leave
   2243              if ( ZSTACK_ROUTER_BUILD )
   2244              {
   2245                NLME_LeaveRsp_t rsp;
   2246                rsp.rejoin         = ind->rejoin;
   2247                rsp.removeChildren = ind->removeChildren;
   2248                NLME_LeaveRsp( &rsp );
   2249              }
   2250          
   2251              // Prepare to leave with reset
   2252              ZDApp_LeaveReset( ind->rejoin );
   \                     ??ZDO_LeaveInd_1:
   \   00001C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00001C   EE           MOV     A,R6
   \   00001D   240C         ADD     A,#0xc
   \   00001F   12....       LCALL   ?Subroutine17 & 0xFFFF
   2253            }
   \                     ??CrossCallReturnLabel_17:
   \   000022   802C         SJMP    ??ZDO_LeaveInd_2
   2254            else
   2255            {
   2256              leave = FALSE;
   2257          
   2258              // Check if this device needs to leave as a child or descendent
   2259              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000024                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000024   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000027   8A..         MOV     ?V0 + 0,R2
   \   000029   8B..         MOV     ?V0 + 1,R3
   \   00002B   A8..         MOV     R0,?V0 + 0
   \   00002D   A9..         MOV     R1,?V0 + 1
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   E0           MOVX    A,@DPTR
   \   000034   68           XRL     A,R0
   \   000035   7003         JNZ     ??ZDO_LeaveInd_3
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   69           XRL     A,R1
   \                     ??ZDO_LeaveInd_3:
   \   00003A   7014         JNZ     ??ZDO_LeaveInd_2
   2260              {
   2261                if ( ( ind->removeChildren == TRUE               ) ||
   2262                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2263                       NODETYPE_DEVICE                           )    )
   \   00003C   EE           MOV     A,R6
   \   00003D   240B         ADD     A,#0xb
   \   00003F   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   2264                {
   2265                  leave = TRUE;
   2266                }
   2267              }
   2268              else if ( ind->removeChildren == TRUE )
   2269              {
   2270                // Check NWK address allocation algorithm
   2271                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2272              }
   2273          
   2274              if ( leave == TRUE )
   2275              {
   2276                // Prepare to leave with reset
   2277                ZDApp_LeaveReset( ind->rejoin );
   2278              }
   2279              else
   2280              {
   2281                // Remove device address(optionally descendents) from data
   2282                ZDApp_LeaveUpdate( ind->srcAddr,
   2283                                   ind->extAddr,
   2284                                   ind->removeChildren );
   2285              }
   2286            }
   \                     ??CrossCallReturnLabel_39:
   \   000042   6401         XRL     A,#0x1
   \   000044   60D6         JZ      ??ZDO_LeaveInd_1
   \   000046   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   5407         ANL     A,#0x7
   \   00004C   6402         XRL     A,#0x2
   \   00004E   60CC         JZ      ??ZDO_LeaveInd_1
   2287          }
   \                     ??ZDO_LeaveInd_2:
   \   000050   02....       LJMP    ??Subroutine30_0 & 0xFFFF
   2288          
   2289          /*********************************************************************
   2290           * @fn          ZDO_SyncIndicationCB
   2291           *
   2292           * @brief       This function allows the next higher layer of a
   2293           *              coordinator to be notified of a loss of synchronization
   2294           *                          with the parent/child device.
   2295           *
   2296           * @param       type: 0 - child; 1 - parent
   2297           *
   2298           *
   2299           * @return      none
   2300           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2301          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2302          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2303            (void)shortAddr;  // Remove this line if this parameter is used.
   2304            
   2305            if ( ZSTACK_END_DEVICE_BUILD
   2306              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   2307            {
   2308              if ( type == 1 )
   \   000007   7401         MOV     A,#0x1
   \   000009   6E           XRL     A,R6
   \   00000A   700E         JNZ     ??CrossCallReturnLabel_11
   2309              {
   2310                // We lost contact with our parent.  Clear the neighbor Table.
   2311                nwkNeighborInitTable();
   \   00000C                ; Setup parameters for call to function nwkNeighborInitTable
   \   00000C   12....       LCALL   ??nwkNeighborInitTable?relay
   2312                
   2313                // Start the rejoin process.
   2314                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   00000F                ; Setup parameters for call to function ZDApp_SendMsg
   \   00000F   7C00         MOV     R4,#0x0
   \   000011   7D00         MOV     R5,#0x0
   \   000013   7B02         MOV     R3,#0x2
   \   000015   7A03         MOV     R2,#0x3
   \   000017   12....       LCALL   ?Subroutine14 & 0xFFFF
   2315              }
   2316            }
   2317          }
   \                     ??CrossCallReturnLabel_11:
   \   00001A   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2318          
   2319          /*********************************************************************
   2320           * @fn          ZDO_ManytoOneFailureIndicationCB
   2321           *
   2322           * @brief       This function allows the next higher layer of a
   2323           *              concentrator to be notified of a many-to-one route 
   2324           *              failure. 
   2325           *
   2326           * @param       none
   2327           *
   2328           *
   2329           * @return      none
   2330           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2331          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2332          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2333            // By default, the concentrator automatically redo many-to-one route 
   2334            // discovery to update all many-to-one routes in the network
   2335            // If you want anything processing other than the default,
   2336            // please replace the following code.
   2337            
   2338            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2339          }
   \   000007   02....       LJMP    ?Subroutine2 & 0xFFFF
   2340          
   2341          
   2342          /*********************************************************************
   2343           * @fn          ZDO_PollConfirmCB
   2344           *
   2345           * @brief       This function allows the next higher layer to be
   2346           *              notified of a Poll Confirm.
   2347           *
   2348           * @param       none
   2349           *
   2350           * @return      none
   2351           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2352          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2353          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2354            (void)status;  // Remove this line if this parameter is used.
   2355            return;
   \   000000   02....       LJMP    ?BRET
   2356          }
   2357          
   2358          /******************************************************************************
   2359           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2360           *
   2361           * @brief       Stub routine implemented by NHLE. NHLE should call
   2362           *              <AddrMgrWriteNV> when appropriate.
   2363           *
   2364           * @param       none
   2365           *
   2366           * @return      none
   2367           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2368          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2369          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2370          #if defined ( NV_RESTORE )  
   2371            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2372            {
   2373              // Trigger to save info into NV
   2374              ZDApp_NVUpdate();
   2375            }
   2376          #endif
   2377          }
   \   000000   02....       LJMP    ?BRET
   2378          
   2379          /*********************************************************************
   2380           * Call Back Functions from Security  - API
   2381           */
   2382          
   2383           /*********************************************************************
   2384           * @fn          ZDO_UpdateDeviceIndication
   2385           *
   2386           * @brief       This function notifies the "Trust Center" of a
   2387           *              network when a device joins or leaves the network.
   2388           *
   2389           * @param       extAddr - pointer to 64 bit address of new device
   2390           * @param       status  - 0 if a new device joined securely
   2391           *                      - 1 if a new device joined un-securely
   2392           *                      - 2 if a device left the network
   2393           *
   2394           * @return      true if newly joined device should be allowed to
   2395           *                                              remain on network
   2396           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2397          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2398          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2399            // can implement a network access policy based on the
   2400            // IEEE address of newly joining devices...
   2401            (void)extAddr;
   2402            (void)status;
   2403            
   2404            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine3 & 0xFFFF
   2405          }
   2406          
   2407          /*********************************************************************
   2408           * @fn          ZDApp_InMsgCB
   2409           *
   2410           * @brief       This function is called to pass up any message that is
   2411           *              not yet supported.  This allows for the developer to
   2412           *              support features themselves..
   2413           *
   2414           * @return      none
   2415           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2416          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2417          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   12....       LCALL   ?Subroutine18 & 0xFFFF
   2418            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \                     ??CrossCallReturnLabel_37:
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F9           MOV     R1,A
   \   00000C   5480         ANL     A,#0x80
   \   00000E   7048         JNZ     ??ZDApp_InMsgCB_0
   2419            {
   2420              // Handle the response message
   2421            }
   2422            else
   2423            {
   2424              // Handle the request message by sending a generic "not supported".
   2425              // Device Announce doesn't have a response.
   2426              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000010   EE           MOV     A,R6
   \   000011   240B         ADD     A,#0xb
   \   000013   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000016   7040         JNZ     ??ZDApp_InMsgCB_0
   \   000018   7413         MOV     A,#0x13
   \   00001A   68           XRL     A,R0
   \   00001B   7001         JNZ     ??ZDApp_InMsgCB_1
   \   00001D   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_1:
   \   00001E   6038         JZ      ??ZDApp_InMsgCB_0
   2427              {
   2428                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2429                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000020                ; Setup parameters for call to function ZDP_GenericRsp
   \   000020   E8           MOV     A,R0
   \   000021   F5..         MOV     ?V0 + 0,A
   \   000023   E9           MOV     A,R1
   \   000024   4480         ORL     A,#0x80
   \   000026   F5..         MOV     ?V0 + 1,A
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002D   E4           CLR     A
   \   00002E   F5..         MOV     ?V0 + 0,A
   \   000030   F5..         MOV     ?V0 + 1,A
   \   000032   78..         MOV     R0,#?V0 + 0
   \   000034   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000037   EE           MOV     A,R6
   \   000038   240E         ADD     A,#0xe
   \   00003A   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   2430              }
   2431            }
   \                     ??CrossCallReturnLabel_41:
   \   00003D   FD           MOV     R5,A
   \   00003E   7C84         MOV     R4,#-0x7c
   \   000040   EE           MOV     A,R6
   \   000041   2402         ADD     A,#0x2
   \   000043   0A           INC     R2
   \   000044   0A           INC     R2
   \   000045   EF           MOV     A,R7
   \   000046   3400         ADDC    A,#0x0
   \   000048   FB           MOV     R3,A
   \   000049   EE           MOV     A,R6
   \   00004A   240F         ADD     A,#0xf
   \   00004C   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   00004F   F9           MOV     R1,A
   \   000050   12....       LCALL   ??ZDP_GenericRsp?relay
   \   000053   7404         MOV     A,#0x4
   \   000055   12....       LCALL   ?DEALLOC_XSTACK8
   2432          }
   \                     ??ZDApp_InMsgCB_0:
   \   000058   02....       LJMP    ??Subroutine30_0 & 0xFFFF
   2433          
   2434          
   2435          /*********************************************************************
   2436           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2437           *
   2438           * @brief   Changes the Match Descriptor Response permission.
   2439           *
   2440           * @param   endpoint - endpoint to allow responses
   2441           * @param   action - true to allow responses, false to not
   2442           *
   2443           * @return  none
   2444           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2445          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2446          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   2447            // Store the action
   2448            afSetMatch( endpoint, action );
   \   000005                ; Setup parameters for call to function afSetMatch
   \   000005   12....       LCALL   ??afSetMatch?relay
   2449          }
   \   000008   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2450          
   2451          /*********************************************************************
   2452           * @fn      ZDApp_NetworkInit()
   2453           *
   2454           * @brief   Used to start the network joining process
   2455           *
   2456           * @param   delay - mSec delay to wait before starting
   2457           *
   2458           * @return  none
   2459           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2460          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2461          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2462            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   4B           ORL     A,R3
   \   000006   600B         JZ      ??ZDApp_NetworkInit_0
   2463            {
   2464              // Wait awhile before starting the device
   2465              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   000008                ; Setup parameters for call to function osal_start_timerEx
   \   000008   EA           MOV     A,R2
   \   000009   FC           MOV     R4,A
   \   00000A   EB           MOV     A,R3
   \   00000B   FD           MOV     R5,A
   \   00000C   7A01         MOV     R2,#0x1
   \   00000E   12....       LCALL   ?Subroutine13 & 0xFFFF
   2466            }
   \                     ??CrossCallReturnLabel_34:
   \   000011   8005         SJMP    ??CrossCallReturnLabel_49
   2467            else
   2468            {
   2469              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000013                ; Setup parameters for call to function osal_set_event
   \   000013   7A01         MOV     R2,#0x1
   \   000015   12....       LCALL   ??Subroutine28_0 & 0xFFFF
   2470            }
   2471          }
   \                     ??CrossCallReturnLabel_49:
   \   000018   02....       LJMP    ?Subroutine2 & 0xFFFF
   2472          
   2473          /*********************************************************************
   2474           * @fn      ZDApp_NwkStateUpdateCB()
   2475           *
   2476           * @brief   This function notifies that this device's network 
   2477           *          state info has been changed.
   2478           *
   2479           * @param   none
   2480           *
   2481           * @return  none
   2482           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2483          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2484          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2485            // Notify to save info into NV
   2486            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2487            {
   2488              // Trigger to save info into NV
   2489              ZDApp_NVUpdate();
   2490            }
   2491          }
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   2492          
   2493          /*********************************************************************
   2494           * @fn      ZDApp_NodeProfileSync()
   2495           *
   2496           * @brief   Sync node with stack profile.
   2497           *
   2498           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2499           *
   2500           * @return  none
   2501           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2502          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2503          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2504            networkDesc_t* desc;
   2505            uint16         panID;
   2506          
   2507            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5056         JNC     ??ZDApp_NodeProfileSync_0
   2508            {
   2509              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2510          
   2511              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2512          
   2513              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   4583         ORL     A,DPH
   \   00003D   6024         JZ      ??ZDApp_NodeProfileSync_0
   2514              {
   2515                if ( desc->stackProfile != zgStackProfile )
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F8           MOV     R0,A
   \   000049   90....       MOV     DPTR,#zgStackProfile
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   68           XRL     A,R0
   \   00004E   6013         JZ      ??ZDApp_NodeProfileSync_0
   2516                {
   2517                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000050   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000053   E0           MOVX    A,@DPTR
   \   000054   54F8         ANL     A,#0xf8
   \   000056   4402         ORL     A,#0x2
   \   000058   F0           MOVX    @DPTR,A
   2518                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   000059   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00005C   740C         MOV     A,#0xc
   \   00005E   F0           MOVX    @DPTR,A
   2519                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   00005F                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   00005F   F9           MOV     R1,A
   \   000060   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2520                }
   2521              }
   2522            }
   2523          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000063   80..         SJMP    ??Subroutine30_0
   2524          
   2525          /*********************************************************************
   2526           * @fn      ZDApp_StartJoiningCycle()
   2527           *
   2528           * @brief   Starts the joining cycle of a device.  This will only 
   2529           *          continue an already started (or stopped) joining cycle.
   2530           *
   2531           * @param   none
   2532           *
   2533           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2534           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2535          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2536          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2537            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2538            {
   2539              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   7401         MOV     A,#0x1
   \   000016   F0           MOVX    @DPTR,A
   2540              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2541          
   2542              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2543            }
   2544            else
   2545              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ?Subroutine2 & 0xFFFF
   2546          }
   2547          
   2548          /*********************************************************************
   2549           * @fn      ZDApp_StopJoiningCycle()
   2550           *
   2551           * @brief   Stops the joining or rejoining process of a device.
   2552           *
   2553           * @param   none
   2554           *
   2555           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2556           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2557          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2558          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2559            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2560            {
   2561              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
   2562              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2563            }
   2564            else
   2565              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ?Subroutine2 & 0xFFFF
   2566          }
   2567          
   2568          /*********************************************************************
   2569           * @fn      ZDApp_AnnounceNewAddress()
   2570           *
   2571           * @brief   Send Device Announce and hold all transmissions for 
   2572           *          new address timeout.
   2573           *
   2574           * @param   none
   2575           *
   2576           * @return  none
   2577           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2578          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2579          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2580          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2581            // Turn off data request hold
   2582            APSME_HoldDataRequests( 0 );
   2583          #endif
   2584            
   2585            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2586                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine29_0
   2587            
   2588          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2589            // Setup the timeout
   2590            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2591          #endif  
   2592          }
   2593          
   2594          /*********************************************************************
   2595           * @fn          ZDApp_NVUpdate
   2596           *
   2597           * @brief       Set the NV Update Timer.
   2598           *
   2599           * @param       none
   2600           *
   2601           * @return      none
   2602           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2603          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2604          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2605          #if defined ( NV_RESTORE )
   2606            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2607          #endif
   2608          }
   \   000000   02....       LJMP    ?BRET
   2609          
   2610          /*********************************************************************
   2611           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2612           *
   2613           * @brief   Returns a PAN ID for the network layer to use during
   2614           *          a coordinator start and there is another network with 
   2615           *          the intended PANID.
   2616           *
   2617           * @param   panid - the intended PAN ID
   2618           *
   2619           * @return  PANID to try
   2620           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2621          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2622          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2623            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   0A           INC     R2
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   2624          }
   2625          
   2626          /*********************************************************************
   2627           * @fn          ZDO_SrcRtgIndCB
   2628           *
   2629           * @brief       This function notifies the ZDO available src route record received.
   2630           *
   2631           * @param       srcAddr - source address of the source route
   2632           * @param       relayCnt - number of devices in the relay list
   2633           * @param       relayList - relay list of the source route
   2634           *
   2635           * @return      none
   2636           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2637          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2638          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2639            zdoSrcRtg_t srcRtg;
   2640            
   2641            srcRtg.srcAddr = srcAddr;
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
   2642            srcRtg.relayCnt = relayCnt;
   \                     ??CrossCallReturnLabel_55:
   \   00000D   7402         MOV     A,#0x2
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   E9           MOV     A,R1
   \   000013   F0           MOVX    @DPTR,A
   2643            srcRtg.pRelayList = pRelayList;
   \   000014   7403         MOV     A,#0x3
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   2644            
   2645            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   00001E   90....       MOV     DPTR,#zdoCBFunc
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000024   49           ORL     A,R1
   \   000025   6015         JZ      ??ZDO_SrcRtgIndCB_0
   2646            {
   2647              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000027                ; Setup parameters for indirect call
   \   000027   85..82       MOV     DPL,?XSP + 0
   \   00002A   85..83       MOV     DPH,?XSP + 1
   \   00002D   AA82         MOV     R2,DPL
   \   00002F   AB83         MOV     R3,DPH
   \   000031   90....       MOV     DPTR,#zdoCBFunc + 1
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F583         MOV     DPH,A
   \   000037   8882         MOV     DPL,R0
   \   000039   12....       LCALL   ?CALL_IND
   2648            }
   2649          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   00003C   7405         MOV     A,#0x5
   \   00003E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000041   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2650          
   2651          
   2652          /*********************************************************************
   2653           * @fn          ZDO_RegisterForZdoCB
   2654           *
   2655           * @brief       Call this function to register the higher layer (for 
   2656           *              example, the Application layer or MT layer) with ZDO 
   2657           *              callbacks to get notified of some ZDO indication like
   2658           *              existence of a concentrator or receipt of a source 
   2659           *              route record.
   2660           *
   2661           * @param       indID - ZDO Indication ID
   2662           * @param       pFn   - Callback function pointer
   2663           *
   2664           * @return      ZSuccess - successful, ZInvalidParameter if not
   2665           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2666          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2667          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   2668            // Check the range of the indication ID
   2669            if ( indID < MAX_ZDO_CB_FUNC )
   \   000005   700A         JNZ     ??ZDO_RegisterForZdoCB_0
   2670            {
   2671              zdoCBFunc[indID] = pFn;
   \   000007   90....       MOV     DPTR,#zdoCBFunc
   \   00000A   12....       LCALL   ??Subroutine31_0 & 0xFFFF
   2672              return ZSuccess;
   \                     ??CrossCallReturnLabel_53:
   \   00000D   7900         MOV     R1,#0x0
   \   00000F   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2673            }
   2674            
   2675            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000011   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000013   02....       LJMP    ?Subroutine2 & 0xFFFF
   2676          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2677          
   2678          /*********************************************************************
   2679          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      9
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> osal_pwrmgr_device            4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> ZDAppCheckForHoldKey          0      0     18
       -> ZDO_Init                      0      0     18
       -> afRegister                    0      0     18
       -> ZDOInitDevice                 0      0     18
       -> HalLedBlink                   0      0     18
       -> ZDApp_RegisterCBs             0      0     18
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             0      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   0      0     19
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0      0
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     16
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0      0
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     47
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     28
       -> osal_set_event                0      0     24
       -> osal_pwrmgr_device            0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> osal_pwrmgr_device            0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               0      0     27
       -> ZDP_IncomingData              0      0     32
       -> ZDApp_ProcessMsgCBs           0      0     32
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     34
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> osal_rand                     0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> NLME_ReJoinRequest            0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> NLME_SetPollRate              0      0     32
       -> NLME_SetQueuedPollRate        0      0     32
       -> NLME_SetResponseRate          0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> ZDApp_ProcessNetworkJoin      0      0     32
       -> sAddrExtCpy                   0      0     32
       -> ZDApp_NetworkInit             0      0     32
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrTransportKeyInd       4      0      0
       -> ZDSecMgrSwitchKeyInd          4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      9
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      9
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      0      0      9
       -> ZDSecMgrInit                  0      0     18
     ZDApp_SendEventMsg                 0      0      9
       -> ZDApp_SendMsg                 0      0     18
     ZDApp_SendMsg                      1      0     54
       -> osal_msg_allocate             0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_msg_send                 0      0     38
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> osal_start_timerEx            0      0     20
     ZDOInitDevice                      0      0     21
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> sAddrExtCmp                   0      0     18
       -> ZDApp_LeaveReset              0      0     18
     ZDO_LeaveInd                       0      0     10
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_GetCoordShortAddr        0      0     20
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     14
     ZDO_StartRouterConfirmCB           0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      2
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    75
     ??Subroutine26_0                               5
     ZDApp_SecInit                                 11
     ZDApp_event_loop                             168
     ??Subroutine25_0                               6
     ??Subroutine30_0                               5
     ZDApp_ProcessSecEvent                         75
     ?Subroutine12                                  7
     ??Subroutine31_0                               6
     ZDOInitDevice                                138
     ?Subroutine10                                  2
     ??Subroutine28_0                              11
     ?Subroutine1                                   2
     ??Subroutine29_0                               3
     ?Subroutine9                                   6
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ?Subroutine2                                   7
     ZDApp_NetworkStartEvt                         79
     ZDApp_DeviceAuthEvt                           46
     ?Subroutine6                                  24
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     66
     ?Subroutine7                                  13
     ZDApp_InitUserDesc                            93
     ?Subroutine20                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                         452
     ?Subroutine19                                 22
     ?Subroutine16                                 15
     ZDApp_ProcessMsgCBs                          120
     ?Subroutine5                                   5
     ?Subroutine18                                  7
     ??Subroutine27_0                               9
     ZDApp_RegisterCBs                             31
     ?Subroutine11                                  2
     ??Subroutine23_0                               9
     ZDApp_ProcessSecMsg                           56
     ZDApp_ProcessNetworkJoin                     320
     ?Subroutine15                                 12
     ZDApp_SaveNwkKey                              82
     ?Subroutine4                                  10
     ?Subroutine22                                  6
     ??Subroutine24_0                               8
     ZDApp_ResetNwkKey                             38
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         16
     ?Subroutine13                                  5
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine8                                  14
     ZDApp_LeaveCtrlSet                            53
     ZDApp_LeaveCtrlBypass                         13
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              17
     ZDApp_LeaveUpdate                              3
     ?Subroutine0                                   3
     ZDApp_SendEventMsg                            13
     ?Subroutine14                                  9
     ZDApp_SendMsg                                 99
     ZDO_NetworkDiscoveryConfirmCB                366
     ZDO_NetworkFormationConfirmCB                 30
     ?Subroutine21                                 19
     ZDO_StartRouterConfirmCB                      37
     ZDO_JoinConfirmCB                             40
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine3                                   5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  41
     ?Subroutine17                                 13
     ZDO_LeaveInd                                  83
     ZDO_SyncIndicationCB                          29
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 91
     ZDApp_ChangeMatchDescRespPermission
                                                   11
     ZDApp_NetworkInit                             27
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        101
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               68
     ZDO_RegisterForZdoCB                          22
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 3 878 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    10 bytes in segment XDATA_I
    10 bytes in segment XDATA_ID
     8 bytes in segment XDATA_ROM_C
    44 bytes in segment XDATA_Z
 
 4 230 bytes of CODE  memory
     0 bytes of CONST memory (+ 8 bytes shared)
     0 bytes of DATA  memory (+ 2 bytes shared)
    54 bytes of XDATA memory

Errors: none
Warnings: none
