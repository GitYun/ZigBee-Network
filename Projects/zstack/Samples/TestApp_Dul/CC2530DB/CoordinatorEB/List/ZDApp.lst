###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         28/Jan/2016  17:04:40 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\Work Codes\ZigBee\Network\Components\stack\zdo\ #
#                          ZDApp.c                                            #
#    Command line       =  -f "E:\Work Codes\ZigBee\Network\Projects\zstack\S #
#                          amples\TestApp_Dul\CC2530DB\..\..\..\Tools\CC2530D #
#                          B\f8wCoord.cfg" (-DCPU32MHZ -DROOT=__near_func     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\TestApp_Dul\CC2530DB\..\..\..\Tools\CC2530DB\f #
#                          8wConfig.cfg" (-DSECURE=0 -DZG_SECURE_DYNAMIC=0    #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFB                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "E:\Work Codes\ZigBee\Network\Components\stack\zdo #
#                          \ZDApp.c" -D ZTOOL_P1 -D xMT_TASK -D xMT_SYS_FUNC  #
#                          -D xMT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC         #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\TestApp_Dul\CC2530DB\CoordinatorEB\List\" -lA  #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\TestApp_Dul\CC2530DB\CoordinatorEB\List\"      #
#                          --diag_suppress Pe001,Pa010 -o "E:\Work            #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\CoordinatorEB\Obj\" -e --debug     #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "E:\Work                   #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\" -I "E:\Work                      #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\SOURCE\" -I "E:\Work            #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I       #
#                          "E:\Work Codes\ZigBee\Network\Projects\zstack\Samp #
#                          les\TestApp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS #
#                          \MT\" -I "E:\Work Codes\ZigBee\Network\Projects\zs #
#                          tack\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\C #
#                          OMPONENTS\HAL\INCLUDE\" -I "E:\Work                #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARG #
#                          ET\CC2530EB\" -I "E:\Work                          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU #
#                          \CCSOC\" -I "E:\Work Codes\ZigBee\Network\Projects #
#                          \zstack\Samples\TestApp_Dul\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\OSAL\INCLUDE\" -I "E:\Work            #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF #
#                          \" -I "E:\Work Codes\ZigBee\Network\Projects\zstac #
#                          k\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\NWK\" -I "E:\Work                     #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SE #
#                          C\" -I "E:\Work Codes\ZigBee\Network\Projects\zsta #
#                          ck\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\COM #
#                          PONENTS\STACK\SAPI\" -I "E:\Work                   #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SY #
#                          S\" -I "E:\Work Codes\ZigBee\Network\Projects\zsta #
#                          ck\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\COM #
#                          PONENTS\STACK\ZDO\" -I "E:\Work                    #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W #
#                          \" -I "E:\Work Codes\ZigBee\Network\Projects\zstac #
#                          k\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\ZMAC\" -I "E:\Work                          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES #
#                          \SADDR\" -I "E:\Work Codes\ZigBee\Network\Projects #
#                          \zstack\Samples\TestApp_Dul\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\SERVICES\SDATA\" -I "E:\Work          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCL #
#                          UDE\" -I "E:\Work Codes\ZigBee\Network\Projects\zs #
#                          tack\Samples\TestApp_Dul\CC2530DB\..\..\..\..\..\C #
#                          OMPONENTS\MAC\HIGH_LEVEL\" -I "E:\Work             #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_ #
#                          LEVEL\srf04\" -I "E:\Work                          #
#                          Codes\ZigBee\Network\Projects\zstack\Samples\TestA #
#                          pp_Dul\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_ #
#                          LEVEL\srf04\SINGLE_CHIP\" -Ohz                     #
#                          --require_prototypes                               #
#    List file          =  E:\Work Codes\ZigBee\Network\Projects\zstack\Sampl #
#                          es\TestApp_Dul\CC2530DB\CoordinatorEB\List\ZDApp.l #
#                          st                                                 #
#    Object file        =  E:\Work Codes\ZigBee\Network\Projects\zstack\Sampl #
#                          es\TestApp_Dul\CC2530DB\CoordinatorEB\Obj\ZDApp.r5 #
#                          1                                                  #
#                                                                             #
#                                                                             #
###############################################################################

E:\Work Codes\ZigBee\Network\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-01-04 12:16:55 -0800 (Mon, 04 Jan 2010) $
      4            Revision:       $Revision: 21428 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          /* HAL */
     69          #include "hal_led.h"
     70          #include "hal_lcd.h"
     71          #include "hal_key.h"
     72          
     73          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     74            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     75          #endif
     76          /*********************************************************************
     77           * MACROS
     78           */
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          #if !defined( NWK_START_DELAY )
     84            #define NWK_START_DELAY             100   // in milliseconds
     85          #endif
     86          
     87          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     88            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     89          #endif
     90          
     91          #if !defined( BEACON_REQUEST_DELAY )
     92            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     93          #endif
     94          
     95          #if !defined( BEACON_REQ_DELAY_MASK )
     96            #define BEACON_REQ_DELAY_MASK       0x007F
     97          #endif
     98          
     99          #define MAX_RESUME_RETRY            3
    100          
    101          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    102          
    103          // Beacon Order Settings (see NLMEDE.h)
    104          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS // 15
    105          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER    // 15
    106          
    107          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    108            // The number of times the frame counter can change before
    109            // saving to NV
    110            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    111          #endif
    112          
    113          // Leave control bits
    114          #define ZDAPP_LEAVE_CTRL_INIT 0
    115          #define ZDAPP_LEAVE_CTRL_SET  1
    116          #define ZDAPP_LEAVE_CTRL_RA   2
    117          
    118          // Standard time to update NWK NV data
    119          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    120          
    121          // Address Manager Stub Implementation
    122          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    123          
    124          // Size of the ZDO callback function table zdoCBFunc[]
    125          #define MAX_ZDO_CB_FUNC 1
    126          
    127          
    128          /*********************************************************************
    129           * GLOBAL VARIABLES
    130           */
    131          
    132          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    134          #endif
    135          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    136          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    137          
    138          // zAddrType_t 主要用于 ZigBee 设备的（地址）绑定

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    140          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    146          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    148          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    151          
    152          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    154          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    156          
    157          /*********************************************************************
    158           * EXTERNAL VARIABLES
    159           */
    160          
    161          /*********************************************************************
    162           * EXTERNAL FUNCTIONS
    163           */
    164          
    165          /*********************************************************************
    166           * LOCAL FUNCTIONS
    167           */
    168          
    169          void ZDApp_NetworkStartEvt( void );
    170          void ZDApp_DeviceAuthEvt( void );
    171          void ZDApp_SaveNetworkStateEvt( void );
    172          
    173          uint8 ZDApp_ReadNetworkRestoreState( void );
    174          uint8 ZDApp_RestoreNetworkState( void );
    175          void ZDAppDetermineDeviceType( void );
    176          void ZDApp_InitUserDesc( void );
    177          void ZDAppCheckForHoldKey( void );
    178          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    179          void ZDApp_ProcessNetworkJoin( void );
    180          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    181          void ZDApp_SaveNwkKey( void );
    182          uint8 ZDApp_RestoreNwkKey( void );
    183            
    184          void ZDApp_SecInit( uint8 state );
    185          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    186          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    187          
    188          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    189          
    190          void ZDApp_ResetTimerStart( uint16 delay );
    191          void ZDApp_ResetTimerCancel( void );
    192          void ZDApp_LeaveCtrlInit( void );
    193          void ZDApp_LeaveCtrlSet( uint8 ra );
    194          uint8 ZDApp_LeaveCtrlBypass( void );
    195          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    196          void ZDApp_LeaveReset( uint8 ra );
    197          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    198                                  uint8 removeChildren );
    199          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    200          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    201          void ZDApp_RegisterCBs( void );
    202          
    203          /*********************************************************************
    204           * LOCAL VARIABLES
    205           */
    206          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    207          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    210          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    211          
    212          #if defined( HOLD_AUTO_START )
    213            devStates_t devState = DEV_HOLD;
    214          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    215            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    216          #endif
    217          
    218          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )
    219            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
    220            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    221                                  // to parent. Set to make the device do an Orphan scan.
    222          #else
    223            // Set the default to coodinator

   \                                 In  segment XDATA_I, align 1, keep-with-next
    224            devStartModes_t devStartMode = MODE_HARD; // 枚举量
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devStartMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    225          #endif
    226          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    227          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    228          
    229          // 端点0，每个 ZigBee 设备必须使用的端点，用于寻址所有活动端点

   \                                 In  segment XDATA_I, align 1, keep-with-next
    230          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    231          {
    232            ZDO_EP,   // endPoint, 0
    233            &ZDAppTaskID, // task_id, 是 osalInitTasks() 中分配的任务ID
    234            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    235            (afNetworkLatencyReq_t)0            // No Network Latency req
    236          };
    237          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    238          uint16 ZDApp_SavedPollRate = POLL_RATE;	// default value is 1000 ms
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    239          
    240          /*********************************************************************
    241           * @fn      ZDApp_Init
    242           *
    243           * @brief   ZDApp Initialization function.
    244           *
    245           * @param   task_id - ZDApp Task ID
    246           *
    247           * @return  None
    248           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    249          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    250          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    251            // Save the task ID
    252            ZDAppTaskID = task_id;
   \   000006   90....       MOV     DPTR,#ZDAppTaskID
   \   000009   F0           MOVX    @DPTR,A
    253          
    254            // Initialize the ZDO global device short address storage
    255          	// zAddrType_t 主要用于 ZigBee 设备的（地址）绑定
    256            ZDAppNwkAddr.addrMode = Addr16Bit;    // 2, enum
   \   00000A   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    257            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;  // 0xFFFE
   \   000010   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000013   74FE         MOV     A,#-0x2
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   04           INC     A
   \   000018   F0           MOVX    @DPTR,A
    258            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    259          
    260            // Check for manual "Hold Auto Start"
    261            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    262          
    263            // Initialize ZDO items and setup the device - type of device to create.
    264            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    265          
    266            // Register the endpoint description with the AF
    267            // This task doesn't have a Simple description, but we still need
    268            // to register the endpoint.
    269            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000024   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000026   12....       LCALL   ??afRegister?relay
    270          
    271          #if defined( ZDO_USERDESC_RESPONSE )
    272            ZDApp_InitUserDesc();
    273          #endif // ZDO_USERDESC_RESPONSE
    274          
    275            // Start the device?
    276            if ( devState != DEV_HOLD )
   \   000029   90....       MOV     DPTR,#devState
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   6009         JZ      ??ZDApp_Init_0
    277            {
    278              ZDOInitDevice( 0 );
   \   00002F                ; Setup parameters for call to function ZDOInitDevice
   \   00002F   7A00         MOV     R2,#0x0
   \   000031   7B00         MOV     R3,#0x0
   \   000033   12....       LCALL   ??ZDOInitDevice?relay
   \   000036   800D         SJMP    ??ZDApp_Init_1
    279            }
    280            else
    281            {
    282              // Blink LED to indicate HOLD_START
    283              HalLedBlink ( HAL_LED_4, 5, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   000038                ; Setup parameters for call to function HalLedBlink
   \   000038   7CF4         MOV     R4,#-0xc
   \   00003A   7D01         MOV     R5,#0x1
   \   00003C   7B32         MOV     R3,#0x32
   \   00003E   7A05         MOV     R2,#0x5
   \   000040   7908         MOV     R1,#0x8
   \   000042   12....       LCALL   ??HalLedBlink?relay
    284            }
    285            
    286            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000045                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000045   12....       LCALL   ??ZDApp_RegisterCBs?relay
    287          } /* ZDApp_Init() */
   \   000048   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    288          
    289          /*********************************************************************
    290           * @fn          ZDApp_SecInit
    291           *
    292           * @brief       ZDApp initialize security.
    293           *
    294           * @param       state - device initialization state
    295           *
    296           * @return      none
    297           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    298          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    299          {  
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    300            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    301            {
    302              // Set the Trust Center bit
    303              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    304            }
    305          
    306            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    307            {
    308              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    309            }
    310              
    311            // Initialize ZigBee Device Security Manager
    312            ZDSecMgrInit(state);
   \   000005                ; Setup parameters for call to function ZDSecMgrInit
   \   000005   12....       LCALL   ??ZDSecMgrInit?relay
    313          
    314            if ( ZG_SECURE_ENABLED )
    315            {
    316              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    317              {
    318                nwkFrameCounter = 0;
    319            
    320                if( _NIB.nwkKeyLoaded == FALSE )
    321                {
    322                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    323                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    324                  {
    325                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    326                      SSP_SwitchNwkKey( 0 );
    327                  }
    328                }
    329              }
    330            }    
    331          }
   \   000008   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    332          
    333          /*********************************************************************
    334           * @fn      ZDApp_event_loop()
    335           *
    336           * @brief   Main event loop for Zigbee device objects task. This function
    337           *          should be called at periodic intervals.
    338           *
    339           * @param   task_id - Task ID
    340           * @param   events  - Bitmap of events
    341           *
    342           * @return  none
    343           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    344          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    345          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    346            uint8 *msg_ptr;
    347          
    348            if ( events & SYS_EVENT_MSG ) // 0x8000
   \   000009   5480         ANL     A,#0x80
   \   00000B   7031         JNZ     ??ZDApp_event_loop_0
    349            {
    350              //接收任务号为ZDAppTaskID的命令信息
    351              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    352              {
    353                //关于命令信息的事件处理函数
    354                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    355          
    356                // Release the memory
    357                osal_msg_deallocate( msg_ptr );
    358              }
    359          
    360              // Return unprocessed events
    361              return (events ^ SYS_EVENT_MSG);
    362            }
    363          
    364            if ( events & ZDO_NETWORK_INIT )  // 0x0001, 网络初始化事件处理
   \   00000D   EE           MOV     A,R6
   \   00000E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000010   5045         JNC     ??ZDApp_event_loop_1
    365            {
    366              // Initialize apps and start the network
    367              devState = DEV_INIT;
   \   000012   90....       MOV     DPTR,#devState
   \   000015   7401         MOV     A,#0x1
   \   000017   F0           MOVX    @DPTR,A
    368              
    369              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,   // ..., MODE_HARD
    370                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );  // 15, 15
   \   000018                ; Setup parameters for call to function ZDO_StartDevice
   \   000018   7C0F         MOV     R4,#0xf
   \   00001A   7B0F         MOV     R3,#0xf
   \   00001C   90....       MOV     DPTR,#devStartMode
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   FA           MOV     R2,A
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   5407         ANL     A,#0x7
   \   000027   F9           MOV     R1,A
   \   000028   12....       LCALL   ??ZDO_StartDevice?relay
    371          
    372              // Return unprocessed events
    373              return (events ^ ZDO_NETWORK_INIT);
   \   00002B   EE           MOV     A,R6
   \   00002C   6401         XRL     A,#0x1
   \                     ??ZDApp_event_loop_2:
   \   00002E   FA           MOV     R2,A
   \   00002F   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_3:
   \   000030   FB           MOV     R3,A
   \   000031   02....       LJMP    ??ZDApp_event_loop_4 & 0xFFFF
    374            }
   \                     ??ZDApp_event_loop_5:
   \   000034                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000034   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   000037                ; Setup parameters for call to function osal_msg_deallocate
   \   000037   AA..         MOV     R2,?V0 + 0
   \   000039   AB..         MOV     R3,?V0 + 1
   \   00003B   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_0:
   \   00003E                ; Setup parameters for call to function osal_msg_receive
   \   00003E   90....       MOV     DPTR,#ZDAppTaskID
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??osal_msg_receive?relay
   \   000046   8A..         MOV     ?V0 + 0,R2
   \   000048   8B..         MOV     ?V0 + 1,R3
   \   00004A   A9..         MOV     R1,?V0 + 1
   \   00004C   EA           MOV     A,R2
   \   00004D   49           ORL     A,R1
   \   00004E   70E4         JNZ     ??ZDApp_event_loop_5
   \   000050   EE           MOV     A,R6
   \   000051   FA           MOV     R2,A
   \   000052   EF           MOV     A,R7
   \   000053   6480         XRL     A,#0x80
   \   000055   80D9         SJMP    ??ZDApp_event_loop_3
    375          
    376            if ( ZSTACK_ROUTER_BUILD )
    377            {
    378              if ( events & ZDO_NETWORK_START )   // 0x0002, 新网络开始事件
   \                     ??ZDApp_event_loop_1:
   \   000057   5402         ANL     A,#0x2
   \   000059   6008         JZ      ??ZDApp_event_loop_6
    379              {
    380                ZDApp_NetworkStartEvt();
   \   00005B                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   00005B   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    381            
    382                // Return unprocessed events
    383                return (events ^ ZDO_NETWORK_START);
   \   00005E   EE           MOV     A,R6
   \   00005F   6402         XRL     A,#0x2
   \                     ??ZDApp_event_loop_7:
   \   000061   80CB         SJMP    ??ZDApp_event_loop_2
    384              }
    385          
    386              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_6:
   \   000063   EE           MOV     A,R6
   \   000064   5420         ANL     A,#0x20
   \   000066   601E         JZ      ??ZDApp_event_loop_8
    387              {
    388                if ( nwkStatus == ZSuccess )
   \   000068   90....       MOV     DPTR,#nwkStatus
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   7010         JNZ     ??ZDApp_event_loop_9
    389                {
    390                  if ( devState == DEV_END_DEVICE )
   \   00006E   90....       MOV     DPTR,#devState
   \   000071   E0           MOVX    A,@DPTR
   \   000072   6406         XRL     A,#0x6
   \   000074   7003         JNZ     ??ZDApp_event_loop_10
    391                    devState = DEV_ROUTER;
   \   000076   7407         MOV     A,#0x7
   \   000078   F0           MOVX    @DPTR,A
    392            
    393                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_10:
   \   000079                ; Setup parameters for call to function osal_pwrmgr_device
   \   000079   7900         MOV     R1,#0x0
   \   00007B   12....       LCALL   ??osal_pwrmgr_device?relay
    394                }
    395                else
    396                {
    397                  // remain as end device!!
    398                }
    399                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_9:
   \   00007E                ; Setup parameters for call to function osal_set_event
   \   00007E   12....       LCALL   ?Subroutine8 & 0xFFFF
    400            
    401                // Return unprocessed events
    402                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_35:
   \   000081   EE           MOV     A,R6
   \   000082   6420         XRL     A,#0x20
   \   000084   80A8         SJMP    ??ZDApp_event_loop_2
    403              }
    404            }
    405            
    406            // ZDApp_NetworkStartEvt() 或 ZDApp_ProcessNetworkJoin()，... 函数
    407            // 中设置的 ZDO_STATE_CHANGE_EVT ZDO 状态改变事件
    408            if ( events & ZDO_STATE_CHANGE_EVT ) // 0x0010
   \                     ??ZDApp_event_loop_8:
   \   000086   EE           MOV     A,R6
   \   000087   5410         ANL     A,#0x10
   \   000089   6023         JZ      ??ZDApp_event_loop_11
    409            {
    410              // 向 AF 层中已注册（在 aspi.c 中的 SPAI_Init()中使用 afRegister(&sapi_epDesc) 注册）
    411              // 的端点描述符中的 task_id（应该为 spai_TaskID）所标识的任务
    412              // 发送 ZDO_STATE_CHANGE 事件（此事件被附加在一个系统消息
    413              // 事件 SYS_EVENT_MSG 中）
    414              // 当设备加入网络时，devState 在 ZDApp_ProcessOSALMsg() 中改变状态值为 DEV_END_DEVICE
    415              // 当设备建立网络时，devState 在 ZDApp_NetworkStartEvt() 中改变状态为 DEV_ZB_COORD
    416              ZDO_UpdateNwkStatus( devState );
   \   00008B                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00008B   90....       MOV     DPTR,#devState
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F9           MOV     R1,A
   \   000090   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    417              
    418              // At start up, do one MTO route discovery if the device is a concentrator
    419              if ( zgConcentratorEnable == TRUE ) // 默认设置为 false
   \   000093   90....       MOV     DPTR,#zgConcentratorEnable
   \   000096   E0           MOVX    A,@DPTR
   \   000097   6401         XRL     A,#0x1
   \   000099   700E         JNZ     ??CrossCallReturnLabel_57
    420              {
    421                // Start next event
    422                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   00009B                ; Setup parameters for call to function osal_start_timerEx
   \   00009B   7C64         MOV     R4,#0x64
   \   00009D   7D00         MOV     R5,#0x0
   \   00009F   7A00         MOV     R2,#0x0
   \   0000A1   7B08         MOV     R3,#0x8
   \   0000A3   90....       MOV     DPTR,#NWK_TaskID
   \   0000A6   12....       LCALL   ??Subroutine25_0 & 0xFFFF
    423              }
    424              
    425              // Return unprocessed events
    426              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_57:
   \   0000A9   EE           MOV     A,R6
   \   0000AA   6410         XRL     A,#0x10
   \   0000AC   8080         SJMP    ??ZDApp_event_loop_2
    427            }
    428          
    429            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_11:
   \   0000AE   EE           MOV     A,R6
   \   0000AF   5408         ANL     A,#0x8
   \   0000B1   6006         JZ      ??ZDApp_event_loop_12
    430            {
    431              // User defined logic
    432          
    433              // Return unprocessed events
    434              return (events ^ ZDO_COMMAND_CNF);
   \   0000B3   EE           MOV     A,R6
   \   0000B4   6408         XRL     A,#0x8
   \   0000B6   FA           MOV     R2,A
   \   0000B7   801E         SJMP    ??ZDApp_event_loop_4
    435            }
    436            
    437            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_12:
   \   0000B9   EF           MOV     A,R7
   \   0000BA   5402         ANL     A,#0x2
   \   0000BC   6006         JZ      ??ZDApp_event_loop_13
    438            {
    439              ZDApp_SaveNetworkStateEvt();
    440          
    441              // Return unprocessed events
    442              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000BE   EF           MOV     A,R7
   \   0000BF   6402         XRL     A,#0x2
   \   0000C1   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    443            }
    444          
    445            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_13:
   \   0000C4   EE           MOV     A,R6
   \   0000C5   5404         ANL     A,#0x4
   \   0000C7   600A         JZ      ??ZDApp_event_loop_14
    446            {
    447              // The device has been in the UNAUTH state, so reset
    448              // Note: there will be no return from this call
    449              SystemReset();
   \   0000C9   C2AF         CLR     0xa8.7
   \   0000CB   75C9AB       MOV     0xc9,#-0x55
   \   0000CE   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_15:
   \   0000D1   80FE         SJMP    ??ZDApp_event_loop_15
    450            }
    451          
    452            if ( ZG_SECURE_ENABLED )
    453            {
    454              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    455            }
    456            else
    457            {
    458              // Discard or make more handlers
    459              return 0;
   \                     ??ZDApp_event_loop_14:
   \   0000D3   7A00         MOV     R2,#0x0
   \   0000D5   7B00         MOV     R3,#0x0
    460            }
   \                     ??ZDApp_event_loop_4:
   \   0000D7   02....       LJMP    ??Subroutine29_0 & 0xFFFF
   \   0000DA                REQUIRE _A_IEN0
   \   0000DA                REQUIRE WDCTL
    461          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ??Subroutine22_0
   \   000002                ; // Fall through to label ??Subroutine22_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine29_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    462          
    463          /*********************************************************************
    464           * @fn      ZDApp_ProcessSecEvent()
    465           *
    466           * @brief   Process incoming security events.
    467           *
    468           * @param   task_id - Task ID
    469           * @param   events  - Bitmap of events
    470           *
    471           * @return  none
    472           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    473          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    474          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    475            (void)task_id;  // Intentionally unreferenced parameter
    476            
    477            if ( ZSTACK_ROUTER_BUILD )
    478            {
    479              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6019         JZ      ??ZDApp_ProcessSecEvent_0
    480              {
    481                // process the new device event
    482                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7009         JNZ     ??CrossCallReturnLabel_54
    483                {
    484                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   12....       LCALL   ?Subroutine12 & 0xFFFF
    485                }
    486          
    487                // Return unprocessed events
    488                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_54:
   \   00001F   EE           MOV     A,R6
   \   000020   6440         XRL     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \   000024   FB           MOV     R3,A
   \   000025   8040         SJMP    ??ZDApp_ProcessSecEvent_2
    489              }
    490            }
    491          
    492            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    493                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    494            {
    495              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    496              { 
    497                if ( events & ZDO_SECMGR_EVENT )
    498                {
    499                  ZDSecMgrEvent();
    500          
    501                  // Return unprocessed events
    502                  return (events ^ ZDO_SECMGR_EVENT);
    503                }
    504              }
    505            }
    506            
    507            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000027   EE           MOV     A,R6
   \   000028   5480         ANL     A,#0x80
   \   00002A   6008         JZ      ??ZDApp_ProcessSecEvent_3
    508            {
    509              ZDApp_DeviceAuthEvt();
   \   00002C                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00002C   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    510          
    511              // Return unprocessed events
    512              return (events ^ ZDO_DEVICE_AUTH);
   \   00002F   EE           MOV     A,R6
   \   000030   6480         XRL     A,#0x80
   \   000032   80EE         SJMP    ??ZDApp_ProcessSecEvent_1
    513            }
    514          
    515            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000034   EF           MOV     A,R7
   \   000035   5404         ANL     A,#0x4
   \   000037   602A         JZ      ??ZDApp_ProcessSecEvent_4
    516            {
    517              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000039   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00003C   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   00003F   E8           MOV     A,R0
   \   000040   2401         ADD     A,#0x1
   \   000042   FA           MOV     R2,A
   \   000043   E9           MOV     A,R1
   \   000044   3400         ADDC    A,#0x0
   \   000046   FB           MOV     R3,A
   \   000047   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004A   EA           MOV     A,R2
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   A3           INC     DPTR
   \   00004D   EB           MOV     A,R3
   \   00004E   F0           MOVX    @DPTR,A
   \   00004F   C3           CLR     C
   \   000050   E8           MOV     A,R0
   \   000051   94E9         SUBB    A,#-0x17
   \   000053   E9           MOV     A,R1
   \   000054   9403         SUBB    A,#0x3
   \   000056   4003         JC      ??ZDApp_ProcessSecEvent_5
    518                ZDApp_SaveNwkKey();
   \   000058                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000058   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    519          
    520              // Return unprocessed events
    521              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_5:
   \   00005B   EE           MOV     A,R6
   \   00005C   FA           MOV     R2,A
   \   00005D   EF           MOV     A,R7
   \   00005E   6404         XRL     A,#0x4
   \   000060   FB           MOV     R3,A
   \   000061   8004         SJMP    ??ZDApp_ProcessSecEvent_2
    522            }
    523            
    524            // Discard or make more handlers
    525            return 0;
   \                     ??ZDApp_ProcessSecEvent_4:
   \   000063   7A00         MOV     R2,#0x0
   \   000065   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000067   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    526          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine25_0
   \   000005                ; // Fall through to label ??Subroutine25_0
    527          
    528          /*********************************************************************
    529           * Application Functions
    530           */
    531          
    532          /*********************************************************************
    533           * @fn      ZDOInitDevice
    534           *
    535           * @brief   Start the device in the network.  This function will read
    536           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    537           *   restore the network state of the device.
    538           *
    539           * @param   startDelay - timeDelay to start device (in milliseconds).
    540           *      There is a jitter added to this delay:
    541           *              ((NWK_START_DELAY + startDelay)
    542           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    543           *
    544           * NOTE:    If the application would like to force a "new" join, the
    545           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    546           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    547           *          this function. "new" join means to not restore the network
    548           *          state of the device. Use zgWriteStartupOptions() to set these
    549           *          options.
    550           *
    551           * @return
    552           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    553           *          restored.
    554           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    555           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    556           *          it could mean that there was no network state to restore.
    557           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    558           *          with the rejoin option set to TRUE.  So, the device was not
    559           *          started in the network (one time only).  The next time this
    560           *          function is called it will start.
    561           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    562          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    563          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    564            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    565            uint16 extendedDelay = 0;
    566          
    567            // 如果在 IAR中定义了宏 HOLD_AUTO_START，
    568            // 则 devState 初始化时为 DEV_HOLD，否则，初始化为 DEV_INIT
    569            if ( devState == DEV_HOLD ) 
   \   000015   90....       MOV     DPTR,#devState
   \   000018   E0           MOVX    A,@DPTR
   \   000019   7005         JNZ     ??ZDOInitDevice_0
    570            {    
    571              // Initialize the RAM items table, in case an NV item has been updated.
    572              zgInitItems( FALSE );
   \   00001B                ; Setup parameters for call to function zgInitItems
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??zgInitItems?relay
    573            }
    574          
    575            ZDConfig_InitDescriptors();   // 初始化 ZDO 描述符，node  power
   \                     ??ZDOInitDevice_0:
   \   000020                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000020   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    576            //devtag.071807.todo - fix this temporary solution
    577            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000023   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000026   E0           MOVX    A,@DPTR
   \   000027   90....       MOV     DPTR,#_NIB + 14
   \   00002A   F0           MOVX    @DPTR,A
    578            
    579            devState = DEV_INIT;    // Remove the Hold state
   \   00002B   90....       MOV     DPTR,#devState
   \   00002E   7401         MOV     A,#0x1
   \   000030   F0           MOVX    @DPTR,A
    580          
    581            // Initialize leave control logic
    582            ZDApp_LeaveCtrlInit();
   \   000031                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000031   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    583          
    584            // Check leave control reset settings
    585            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000034                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A..         MOV     R2,#devState & 0xff
   \   000040   7B..         MOV     R3,#(devState >> 8) & 0xff
   \   000042   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    586          
    587            // Leave may make the hold state come back
    588            if ( devState == DEV_HOLD )
   \   000045   90....       MOV     DPTR,#devState
   \   000048   E0           MOVX    A,@DPTR
   \   000049   700E         JNZ     ??ZDOInitDevice_1
    589            {
    590              // Set the NV startup option to force a "new" join.
    591              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );	// 0xFF, 0x02
   \   00004B                ; Setup parameters for call to function zgWriteStartupOptions
   \   00004B   7A02         MOV     R2,#0x2
   \   00004D   79FF         MOV     R1,#-0x1
   \   00004F   12....       LCALL   ??zgWriteStartupOptions?relay
    592          
    593              // Notify the applications 
    594              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000052                ; Setup parameters for call to function osal_set_event
   \   000052   12....       LCALL   ?Subroutine8 & 0xFFFF
    595              
    596              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_36:
   \   000055   7902         MOV     R1,#0x2
   \   000057   8036         SJMP    ??ZDOInitDevice_2
    597            }
    598          
    599          #if defined ( NV_RESTORE )
    600            // Get Keypad directly to see if a reset nv is needed.
    601            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    602            // while booting to skip past NV Restore.
    603            if ( HalKeyRead() == SW_BYPASS_NV )
    604              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    605            else
    606            {
    607              // Determine if NV should be restored
    608              networkStateNV = ZDApp_ReadNetworkRestoreState();
    609            }
    610          
    611            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    612            {
    613              networkStateNV = ZDApp_RestoreNetworkState();
    614            }
    615            else
    616            {
    617              // Wipe out the network state in NV
    618              NLME_InitNV();
    619              NLME_SetDefaultNV();
    620            }
    621          #endif
    622          
    623            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    624            {
    625              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000059                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000059   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    626          
    627              // Only delay if joining network - not restoring network state
    628              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)	// 100 + startDelay
    629                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));	// random + 127
   \   00005C                ; Setup parameters for call to function osal_rand
   \   00005C   12....       LCALL   ??osal_rand?relay
   \   00005F   85..82       MOV     DPL,?XSP + 0
   \   000062   85..83       MOV     DPH,?XSP + 1
   \   000065   EA           MOV     A,R2
   \   000066   547F         ANL     A,#0x7f
   \   000068   F8           MOV     R0,A
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   28           ADD     A,R0
   \   00006B   F8           MOV     R0,A
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   3400         ADDC    A,#0x0
   \   000070   F9           MOV     R1,A
   \   000071   E8           MOV     A,R0
   \   000072   2464         ADD     A,#0x64
   \   000074   FE           MOV     R6,A
   \   000075   E9           MOV     A,R1
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    630            }
    631          
    632            // Initialize the security for type of device
    633            ZDApp_SecInit( networkStateNV );
   \   000079                ; Setup parameters for call to function ZDSecMgrInit
   \   000079   7901         MOV     R1,#0x1
   \   00007B   12....       LCALL   ??ZDSecMgrInit?relay
    634            
    635            // Trigger the network start
    636            ZDApp_NetworkInit( extendedDelay );   // 开始形成网络
   \   00007E                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00007E   EE           MOV     A,R6
   \   00007F   FA           MOV     R2,A
   \   000080   EF           MOV     A,R7
   \   000081   FB           MOV     R3,A
   \   000082   12....       LCALL   ??ZDApp_NetworkInit?relay
    637          
    638            // set broadcast address mask to support broadcast filtering
    639            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000085                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000085   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    640            
    641            return ( networkStateNV );
   \   00008D   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   00008F   02....       LJMP    ?Subroutine1 & 0xFFFF
    642          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine28_0
   \   000002                ; // Fall through to label ??Subroutine28_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine28_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine29_0
   \   000003                ; // Fall through to label ??Subroutine29_0
    643          
    644          /*********************************************************************
    645           * @fn      ZDApp_ReadNetworkRestoreState
    646           *
    647           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    648           *          or not to restore the network state.
    649           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    650           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    651           *
    652           * @param   none
    653           *
    654           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    655           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    656           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    657           *          ZCD_NV_STARTUP_OPTION
    658           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    659          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    660          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    661            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    662          
    663            // Look for the New Network State option.
    664            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    665            {
    666              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    667            }
    668          
    669            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    670          }
    671          
    672          /*********************************************************************
    673           * @fn      ZDAppDetermineDeviceType()
    674           *
    675           * @brief   Determines the type of device to start. 
    676           *
    677           *          Looks at zgDeviceLogicalType and determines what type of
    678           *          device to start.  The types are:
    679           *            ZG_DEVICETYPE_COORDINATOR
    680           *            ZG_DEVICETYPE_ROUTER
    681           *            ZG_DEVICETYPE_ENDDEVICE
    682           *
    683           * @param   none
    684           *
    685           * @return  none
    686           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    687          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    688          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    689            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    690            {
    691              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    692              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    693            }
    694            else
    695            {
    696              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    697                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    698              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    699                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    700              
    701              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    702              // The device shall do rejoin the network. Otherwise, do normal join
    703              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000036   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   90....       MOV     DPTR,#devStartMode
   \   00003F   7003         JNZ     ??ZDAppDetermineDeviceType_5
    704              {
    705                devStartMode = MODE_JOIN;     // Assume joining
   \   000041   E4           CLR     A
   \   000042   8002         SJMP    ??ZDAppDetermineDeviceType_1
    706              }
    707              else
    708              {
    709                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000044   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    710              }
    711            }
    712          }
   \   000047   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    713          
    714          /*********************************************************************
    715           * @fn      ZDApp_NetworkStartEvt()
    716           *
    717           * @brief   Process the Network Start Event
    718           *
    719           * @param   none
    720           *
    721           * @return  none
    722           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    723          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    724          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    725            // 若网络形成函数 NLME_NetworkFormationRequest() 建立网络成功，
    726            // 则返回 zSuccess，否则返回 zFailure 并将此返回值传递给
    727            // ZDO_NetworkFormationConfirmCB() 函数，再在其中将上面的 
    728            // zSuccess 或 zFailure 赋值给 nwkStatus
    729            if ( nwkStatus == ZSuccess )  // 网络建立成功?
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    730            {
    731              // Successfully started a ZigBee network
    732              // devState 在 ZDObject.c 中的 ZDO_StartDevice() 函数中
    733              // 改变状态
    734              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    735              {
    736                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    737              }
    738          
    739              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    740              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802B         SJMP    ??ZDApp_NetworkStartEvt_2
    741            }
    742            else
    743            {
    744              // Try again with a higher energy threshold !!
    745              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   2410         ADD     A,#0x10
   \   000022   F8           MOV     R0,A
   \   000023   E4           CLR     A
   \   000024   3400         ADDC    A,#0x0
   \   000026   F9           MOV     R1,A
   \   000027   E8           MOV     A,R0
   \   000028   94FF         SUBB    A,#-0x1
   \   00002A   E9           MOV     A,R1
   \   00002B   9400         SUBB    A,#0x0
   \   00002D   C3           CLR     C
   \   00002E   65D0         XRL     A,PSW
   \   000030   33           RLC     A
   \   000031   500E         JNC     ??ZDApp_NetworkStartEvt_3
    746              {
    747                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000033                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000033                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000033   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000036   E9           MOV     A,R1
   \   000037   2410         ADD     A,#0x10
   \   000039   F9           MOV     R1,A
   \   00003A   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    748                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003D                ; Setup parameters for call to function osal_set_event
   \   00003D   7A01         MOV     R2,#0x1
   \   00003F   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    749              }
    750              else
    751              {
    752                // Failed to start network. Enter a dormant state (until user intervenes)
    753                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000041   90....       MOV     DPTR,#devState
   \   000044   7401         MOV     A,#0x1
   \   000046   F0           MOVX    @DPTR,A
    754                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000047                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000047   7A10         MOV     R2,#0x10
    755              }
    756            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   000049   12....       LCALL   ??Subroutine22_0 & 0xFFFF
    757          }
   \                     ??CrossCallReturnLabel_39:
   \   00004C   02....       LJMP    ?Subroutine2 & 0xFFFF
    758          
    759          /*********************************************************************
    760           * @fn      ZDApp_DeviceAuthEvt()
    761           *
    762           * @brief   Process the Device Authentic Event
    763           *
    764           * @param   none
    765           *
    766           * @return  none
    767           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    768          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    769          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    770            // received authentication from trust center
    771            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   702B         JNZ     ??ZDApp_DeviceAuthEvt_0
    772            {
    773              // Stop the reset timer so it doesn't reset
    774              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    775          
    776              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine5 & 0xFFFF
    777              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    778          
    779              // Set the Power Manager Device
    780          #if defined ( POWER_SAVING )
    781              osal_pwrmgr_device( PWRMGR_BATTERY );
    782          #endif
    783          
    784              if ( ZSTACK_ROUTER_BUILD )
    785              {
    786                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_0:
   \   000012   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    787                {
    788                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    789                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    790                }
    791              }
    792          
    793              // Notify to save info into NV
    794              ZDApp_NVUpdate();
    795          
    796              // Save off the security
    797              ZDApp_SaveNwkKey();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000020   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    798          
    799              ZDApp_AnnounceNewAddress();
   \   000023                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000023   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    800              
    801              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000026   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002C   4009         JC      ??ZDApp_DeviceAuthEvt_0
    802              {
    803                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   00002E                ; Setup parameters for call to function NLME_SetPollRate
   \   00002E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000031   12....       LCALL   ?Subroutine13 & 0xFFFF
    804              }
    805            }
   \                     ??CrossCallReturnLabel_15:
   \   000034   12....       LCALL   ??NLME_SetPollRate?relay
    806            else
    807            {
    808              ZDApp_NVUpdate();
    809            }
    810          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000037   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   90....       MOV     DPTR,#devState
   \   000003   7406         MOV     A,#0x6
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008   7B00         MOV     R3,#0x0
   \   00000A   90....       MOV     DPTR,#ZDAppTaskID
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   12....       LCALL   ??osal_set_event?relay
   \   000012   22           RET
    811          
    812          /*********************************************************************
    813           * @fn      ZDApp_SaveNetworkStateEvt()
    814           *
    815           * @brief   Process the Save the Network State Event
    816           *
    817           * @param   none
    818           *
    819           * @return  none
    820           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    821          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    822          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    823          #if defined ( NV_RESTORE )
    824           #if defined ( NV_TURN_OFF_RADIO )
    825            // Turn off the radio's receiver during an NV update
    826            uint8 RxOnIdle;
    827            uint8 x = false;
    828            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    829            ZMacSetReq( ZMacRxOnIdle, &x );
    830           #endif
    831          
    832            // Update the Network State in NV
    833            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    834                           NWK_NV_DEVICELIST_ENABLE |
    835                           NWK_NV_BINDING_ENABLE    |
    836                           NWK_NV_ADDRMGR_ENABLE );
    837          
    838            // Reset the NV startup option to resume from NV by
    839            // clearing the "New" join option.
    840            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    841          
    842           #if defined ( NV_TURN_OFF_RADIO )
    843            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    844           #endif
    845          #endif  // NV_RESTORE
    846          }
   \   000000   02....       LJMP    ?BRET
    847          
    848          /*********************************************************************
    849           * @fn      ZDApp_RestoreNetworkState()
    850           *
    851           * @brief   This function will restore the network state of the
    852           *          device if the network state is stored in NV.
    853           *
    854           * @param   none
    855           *
    856           * @return
    857           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    858           *          restored.
    859           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    860           *          This could mean that zgStartupOption said to not restore, or
    861           *          it could mean that there was no network state to restore.
    862           *
    863           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    864          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    865          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    866            uint8 nvStat;
    867            nwkActiveKeyItems keyItems;
    868          
    869            // Initialize NWK NV items
    870            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    871          
    872            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   6038         JZ      ??ZDApp_RestoreNetworkState_0
    873            {
    874              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6032         JZ      ??ZDApp_RestoreNetworkState_0
    875              {
    876                // Are we a coordinator
    877                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    878                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000026   7007         JNZ     ??ZDApp_RestoreNetworkState_1
    879                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   54F8         ANL     A,#0xf8
   \   00002E   F0           MOVX    @DPTR,A
    880                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   00002F   90....       MOV     DPTR,#devStartMode
   \   000032   7401         MOV     A,#0x1
   \   000034   F0           MOVX    @DPTR,A
    881                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000035                ; Setup parameters for call to function sAddrExtCpy
   \   000035   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   000037   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   000039   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00003B   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00003D   12....       LCALL   ??sAddrExtCpy?relay
    882              }
    883              else
    884                nvStat = NV_ITEM_UNINIT;
    885          
    886              if ( ZG_SECURE_ENABLED )
    887              {
    888                nwkFrameCounterChanges = 0;
    889                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    890                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    891          
    892                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    893                {
    894                  ZDApp_RestoreNwkKey();
    895                }
    896              }
    897          
    898              // The default for RxOnWhenIdle is true for Routers and false for end devices
    899              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    900              // other than default.
    901            }
    902          
    903            if ( nvStat == ZSUCCESS )
   \   000040   EE           MOV     A,R6
   \   000041   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    904              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000043   7900         MOV     R1,#0x0
   \   000045   8002         SJMP    ??ZDApp_RestoreNetworkState_2
    905            else
    906              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000047   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000049   02....       LJMP    ??Subroutine26_0 & 0xFFFF
    907          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000003   E8           MOV     A,R0
   \   000004   49           ORL     A,R1
   \   000005   22           RET
    908          
    909          /*********************************************************************
    910           * @fn      ZDApp_InitUserDesc()
    911           *
    912           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    913           *          when needed.  If you want to initialize the User descriptor to
    914           *          something other than all zero, do it here.
    915           *
    916           * @param   none
    917           *
    918           * @return  none
    919           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    920          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    921          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    922            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    923          
    924            // Initialize the User Descriptor, the descriptor is read from NV
    925            // when needed.  If you want to initialize the User descriptor to something
    926            // other than all zero, do it here.
    927            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine18 & 0xFFFF
    928            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    929                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_26:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    930            {
    931              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    932                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    933              {
    934                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    935                {
    936                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    937                }
    938              }
    939            }
    940          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine28_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    941          
    942          /*********************************************************************
    943           * @fn      ZDAppCheckForHoldKey()
    944           *
    945           * @brief   Check for key to set the device into Hold Auto Start
    946           *
    947           * @param   none
    948           *
    949           * @return  none
    950           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    951          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    952          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    953          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    954            // Get Keypad directly to see if a HOLD_START is needed.
    955            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    956            // while booting to avoid starting up the device.
    957            if ( HalKeyRead () == SW_BYPASS_START)    // 0x01
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    958            {
    959              // Change the device state to HOLD on start up
    960              devState = DEV_HOLD;
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E4           CLR     A
   \   000010   F0           MOVX    @DPTR,A
    961            }
    962          #endif // HAL_KEY
    963          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ?Subroutine2 & 0xFFFF
    964          
    965          /*********************************************************************
    966           * @fn      ZDApp_ProcessOSALMsg()
    967           *
    968           * @brief   Process the incoming task message.
    969           *
    970           * @param   msgPtr - message to process
    971           *
    972           * @return  none
    973           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    974          void  ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    975          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    976            // Data Confirmation message fields
    977            uint8 sentEP;       // This should always be 0
    978            uint8 sentStatus;
    979            afDataConfirm_t *afDataConfirm;
    980            uint8 tmp;
    981          
    982            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   24E6         ADD     A,#-0x1a
   \   00000B   600A         JZ      ??ZDApp_ProcessOSALMsg_0
   \   00000D   2447         ADD     A,#0x47
   \   00000F   600B         JZ      ??ZDApp_ProcessOSALMsg_1
   \   000011   24D6         ADD     A,#-0x2a
   \   000013   600C         JZ      ??ZDApp_ProcessOSALMsg_2
   \   000015   801A         SJMP    ??ZDApp_ProcessOSALMsg_3
    983            {
    984              // Incoming ZDO Message
    985              case AF_INCOMING_MSG_CMD:   // 0x1A, AF 层信息输入事件
    986                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000017                ; Setup parameters for call to function ZDP_IncomingData
   \   000017   12....       LCALL   ??ZDP_IncomingData?relay
    987                break;
   \   00001A   8015         SJMP    ??ZDApp_ProcessOSALMsg_3
    988                
    989              case ZDO_CB_MSG:	// 0xD3
    990                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00001C                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00001C   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
    991                break;
   \   00001F   8010         SJMP    ??ZDApp_ProcessOSALMsg_3
    992          
    993              case AF_DATA_CONFIRM_CMD:
    994                // This message is received as a confirmation of a data packet sent.
    995                // The status is of ZStatus_t type [defined in NLMEDE.h]
    996                // The message fields are defined in AF.h
    997                afDataConfirm = (afDataConfirm_t *)msgPtr;
    998                sentEP = afDataConfirm->endpoint;
    999                sentStatus = afDataConfirm->hdr.status;
   1000          
   1001                // Action taken when confirmation is received.
   1002          #if defined ( ZIGBEE_FREQ_AGILITY )
   1003                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000021   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000024   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000027   6008         JZ      ??ZDApp_ProcessOSALMsg_3
   1004                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   000029                ; Setup parameters for indirect call
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F583         MOV     DPH,A
   \   00002C   8882         MOV     DPL,R0
   \   00002E   12....       LCALL   ?CALL_IND
   1005          #endif
   1006                (void)sentEP;
   1007                (void)sentStatus;
   1008                break;
   1009          
   1010              case ZDO_NWK_DISC_CNF:  // 网络发现确认事件
   1011                // devState 在 ZDObject.c 的 ZDO_StartDevice() 中改变状态
   1012                if (devState != DEV_NWK_DISC)
   1013                  break;
   1014                
   1015                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1016                {
   1017                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   1018                  {
   1019                    if ( devStartMode == MODE_JOIN )
   1020                    {
   1021                      devState = DEV_NWK_JOINING;
   1022            
   1023                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   1024            
   1025                      // 此函数允许上层去请求设备将自己加入到一个网络中。
   1026                      // 这个行为的结果（状态）返回到 ZDO_JoinConfirmCB() 回调函数中。
   1027                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
   1028                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
   1029                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
   1030                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   1031                      {
   1032                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1033                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1034                      }
   1035                    }
   1036                    else if ( devStartMode == MODE_REJOIN )
   1037                    {
   1038                      devState = DEV_NWK_REJOIN;
   1039          
   1040                      // Before trying to do rejoin, check if the device has a valid short address
   1041                      // If not, generate a random short address for itself
   1042                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   1043                      {
   1044                        _NIB.nwkDevAddress = osal_rand();
   1045                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   1046                      }
   1047          
   1048                      if ( ZG_SECURE_ENABLED )
   1049                      {
   1050                        ZDApp_RestoreNwkKey();
   1051                      }
   1052                      
   1053                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1054                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   1055                      {
   1056                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   1057                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   1058                      }
   1059          
   1060                      tmp = true;
   1061                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
   1062                      
   1063                      // 此函数重新加入一个设备已经加入过的网络。
   1064                      // 此函数的结果（状态）返回到 ZDO_JoinConfirmCB() 回调函数中。
   1065                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   1066                      {
   1067                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1068                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1069                      }
   1070                    }
   1071            
   1072                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   1073                    {
   1074                      // The receiver is on, turn network layer polling off.
   1075                      NLME_SetPollRate( 0 );
   1076                      NLME_SetQueuedPollRate( 0 );
   1077                      NLME_SetResponseRate( 0 );
   1078                    }
   1079                    else
   1080                    {
   1081                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1082                      {
   1083                        ZDApp_SavedPollRate = zgPollRate;
   1084                        NLME_SetPollRate( zgRejoinPollRate );
   1085                      }
   1086                    }
   1087                  }
   1088                  else
   1089                  {
   1090                    if ( continueJoining )
   1091                    {
   1092              #if defined ( MANAGED_SCAN )
   1093                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1094              #else
   1095                      zdoDiscCounter++;
   1096                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1097                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   1098              #endif
   1099                    }
   1100                  }
   1101                }
   1102                break;
   1103          
   1104                // 来自 ZDO_JoinConfirmCB() 函数中发送的 ZDO_NWK_JOIN_IND 事件
   1105              case ZDO_NWK_JOIN_IND:  // 网络加入指示事件
   1106                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1107                {
   1108                  ZDApp_ProcessNetworkJoin();
   1109                }
   1110                break;
   1111          
   1112              case ZDO_NWK_JOIN_REQ:
   1113                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1114                {
   1115                  retryCnt = 0;
   1116                  devStartMode = MODE_RESUME;
   1117                  _tmpRejoinState = true;
   1118                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1119                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   1120                  ZDApp_NetworkInit( 0 );
   1121                }
   1122                break;
   1123          
   1124              default:
   1125                if ( ZG_SECURE_ENABLED )
   1126                  ZDApp_ProcessSecMsg( msgPtr );
   1127                break;
   1128            }
   1129          
   1130          }
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   000031   02....       LJMP    ?Subroutine2 & 0xFFFF
   1131          
   1132          /*********************************************************************
   1133           * @fn      ZDApp_ProcessMsgCBs()
   1134           *
   1135           * @brief   Process response messages
   1136           *
   1137           * @param   none
   1138           *
   1139           * @return  none
   1140           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1141          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1142          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 44
   \   000005   74D4         MOV     A,#-0x2c
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1143            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   00001B   8A..         MOV     ?V0 + 0,R2
   \   00001D   8B..         MOV     ?V0 + 1,R3
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000024   0300         DW        3
   \   000026   2100         DW        33
   \   000028   2200         DW        34
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002C   0080         DW        32768
   \   00002E   0180         DW        32769
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000032   2180         DW        32801
   \   000034   2280         DW        32802
   \   000036   ....         DW        ??ZDApp_ProcessMsgCBs_2
   \   000038   0100         DW        1
   \   00003A   2000         DW        32
   \   00003C   ....         DW        ??ZDApp_ProcessMsgCBs_3
   \   00003E   ....         DW        ??ZDApp_ProcessMsgCBs_4
   1144            {
   1145          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1146              case NWK_addr_rsp:
   1147              case IEEE_addr_rsp:
   1148                {
   1149                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1150                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000040                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000040   EE           MOV     A,R6
   \   000041   FA           MOV     R2,A
   \   000042   EF           MOV     A,R7
   \   000043   FB           MOV     R3,A
   \   000044   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   000047   8A..         MOV     ?V0 + 0,R2
   \   000049   8B..         MOV     ?V0 + 1,R3
   \   00004B   AE..         MOV     R6,?V0 + 0
   \   00004D   AF..         MOV     R7,?V0 + 1
   1151                  if ( pAddrRsp )
   \   00004F   EE           MOV     A,R6
   \   000050   4F           ORL     A,R7
   \   000051   7003         JNZ     $+5
   \   000053   02....       LJMP    ??ZDApp_ProcessMsgCBs_4 & 0xFFFF
   1152                  {
   1153                    if ( pAddrRsp->status == ZSuccess )
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   700F         JNZ     ??ZDApp_ProcessMsgCBs_5
   1154                    {
   1155                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   00005D                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   00005D   EE           MOV     A,R6
   \   00005E   2403         ADD     A,#0x3
   \   000060   FC           MOV     R4,A
   \   000061   EF           MOV     A,R7
   \   000062   3400         ADDC    A,#0x0
   \   000064   FD           MOV     R5,A
   \   000065   A3           INC     DPTR
   \   000066   12....       LCALL   ?Subroutine13 & 0xFFFF
   1156                    }
   \                     ??CrossCallReturnLabel_17:
   \   000069   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1157                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_5:
   \   00006C                ; Setup parameters for call to function osal_mem_free
   \   00006C   EE           MOV     A,R6
   \   00006D   FA           MOV     R2,A
   \   00006E   EF           MOV     A,R7
   \   00006F   02....       LJMP    ??ZDApp_ProcessMsgCBs_6 & 0xFFFF
   1158                  }
   1159                }
   1160                break;
   1161          #endif
   1162                
   1163          #if defined ( REFLECTOR )
   1164              case Bind_req:
   1165              case Unbind_req:
   1166                {
   1167                  ZDO_BindUnbindReq_t bindReq;
   1168                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000072                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000072   7417         MOV     A,#0x17
   \   000074   12....       LCALL   ?XSTACK_DISP0_8
   \   000077   AC82         MOV     R4,DPL
   \   000079   AD83         MOV     R5,DPH
   \   00007B   EE           MOV     A,R6
   \   00007C   FA           MOV     R2,A
   \   00007D   EF           MOV     A,R7
   \   00007E   FB           MOV     R3,A
   \   00007F   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1169                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000082                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000082   7417         MOV     A,#0x17
   \   000084   12....       LCALL   ?XSTACK_DISP0_8
   \   000087   AC82         MOV     R4,DPL
   \   000089   AD83         MOV     R5,DPH
   \   00008B   EE           MOV     A,R6
   \   00008C   FA           MOV     R2,A
   \   00008D   EF           MOV     A,R7
   \   00008E   FB           MOV     R3,A
   \   00008F   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1170                }
   1171                break;
   \   000092   8073         SJMP    ??ZDApp_ProcessMsgCBs_4
   1172          #endif      
   1173          
   1174          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1175              case Bind_rsp:
   1176              case Unbind_rsp:
   1177                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000094   90....       MOV     DPTR,#matchED
   \   000097   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00009A   606B         JZ      ??ZDApp_ProcessMsgCBs_4
   1178                {
   1179                  ZDMatchSendState(
   1180                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1181                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   \   00009C   7421         MOV     A,#0x21
   \   00009E   6A           XRL     A,R2
   \   00009F   7003         JNZ     ??ZDApp_ProcessMsgCBs_7
   \   0000A1   7480         MOV     A,#-0x80
   \   0000A3   6B           XRL     A,R3
   \                     ??ZDApp_ProcessMsgCBs_7:
   \   0000A4   7004         JNZ     ??ZDApp_ProcessMsgCBs_8
   \   0000A6   7903         MOV     R1,#0x3
   \   0000A8   8002         SJMP    ??ZDApp_ProcessMsgCBs_9
   \                     ??ZDApp_ProcessMsgCBs_8:
   \   0000AA   7902         MOV     R1,#0x2
   \                     ??ZDApp_ProcessMsgCBs_9:
   \   0000AC                ; Setup parameters for call to function ZDMatchSendState
   \   0000AC   12....       LCALL   ?Subroutine17 & 0xFFFF
   1182                }
   \                     ??CrossCallReturnLabel_62:
   \   0000AF   FB           MOV     R3,A
   \   0000B0   EE           MOV     A,R6
   \   0000B1   2413         ADD     A,#0x13
   \   0000B3   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   0000B6   F583         MOV     DPH,A
   \   0000B8   8882         MOV     DPL,R0
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   FA           MOV     R2,A
   \   0000BC   12....       LCALL   ??ZDMatchSendState?relay
   \   0000BF   8046         SJMP    ??ZDApp_ProcessMsgCBs_4
   1183                break;
   1184                
   1185              case End_Device_Bind_req:
   1186                if (ZG_DEVICE_COORDINATOR_TYPE)
   1187                {
   1188                  ZDEndDeviceBind_t bindReq;
   1189                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   0000C1                ; Setup parameters for call to function ZDO_ParseEndDeviceBindReq
   \   0000C1   85..82       MOV     DPL,?XSP + 0
   \   0000C4   85..83       MOV     DPH,?XSP + 1
   \   0000C7   AC82         MOV     R4,DPL
   \   0000C9   AD83         MOV     R5,DPH
   \   0000CB   EE           MOV     A,R6
   \   0000CC   FA           MOV     R2,A
   \   0000CD   EF           MOV     A,R7
   \   0000CE   FB           MOV     R3,A
   \   0000CF   12....       LCALL   ??ZDO_ParseEndDeviceBindReq?relay
   1190                  ZDO_MatchEndDeviceBind( &bindReq );
   \   0000D2                ; Setup parameters for call to function ZDO_MatchEndDeviceBind
   \   0000D2   85..82       MOV     DPL,?XSP + 0
   \   0000D5   85..83       MOV     DPH,?XSP + 1
   \   0000D8   AA82         MOV     R2,DPL
   \   0000DA   AB83         MOV     R3,DPH
   \   0000DC   12....       LCALL   ??ZDO_MatchEndDeviceBind?relay
   1191                  
   1192                  // Freeing the cluster lists - if allocated.
   1193                  if ( bindReq.numInClusters )
   \   0000DF   7411         MOV     A,#0x11
   \   0000E1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E4   E0           MOVX    A,@DPTR
   \   0000E5   600B         JZ      ??ZDApp_ProcessMsgCBs_10
   1194                    osal_mem_free( bindReq.inClusters );
   \   0000E7                ; Setup parameters for call to function osal_mem_free
   \   0000E7   7412         MOV     A,#0x12
   \   0000E9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EC   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   0000EF   12....       LCALL   ??osal_mem_free?relay
   1195                  if ( bindReq.numOutClusters )
   \                     ??ZDApp_ProcessMsgCBs_10:
   \   0000F2   7414         MOV     A,#0x14
   \   0000F4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   600D         JZ      ??ZDApp_ProcessMsgCBs_4
   1196                    osal_mem_free( bindReq.outClusters );
   \   0000FA                ; Setup parameters for call to function osal_mem_free
   \   0000FA   7415         MOV     A,#0x15
   \   0000FC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   FA           MOV     R2,A
   \   000101   A3           INC     DPTR
   \   000102   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_6:
   \   000103   FB           MOV     R3,A
   \   000104   12....       LCALL   ??osal_mem_free?relay
   1197                }
   1198                break;
   1199          #endif
   1200            }
   1201          }
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000107   742C         MOV     A,#0x2c
   \   000109   02....       LJMP    ??Subroutine28_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   EE           MOV     A,R6
   \   000001   240F         ADD     A,#0xf
   \   000003                REQUIRE ??Subroutine27_0
   \   000003                ; // Fall through to label ??Subroutine27_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine27_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET
   1202          
   1203          /*********************************************************************
   1204           * @fn      ZDApp_RegisterCBs()
   1205           *
   1206           * @brief   Process response messages
   1207           *
   1208           * @param   none
   1209           *
   1210           * @return  none
   1211           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1212          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1213          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1214          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1215            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine9 & 0xFFFF
   1216          #endif
   1217          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1218            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_43:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine9 & 0xFFFF
   1219          #endif  
   1220          #if ZG_BUILD_COORDINATOR_TYPE
   1221            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   \                     ??CrossCallReturnLabel_44:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   12....       LCALL   ?Subroutine9 & 0xFFFF
   1222            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   \                     ??CrossCallReturnLabel_45:
   \   000013                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000013   7A22         MOV     R2,#0x22
   \   000015   12....       LCALL   ?Subroutine9 & 0xFFFF
   1223            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   \                     ??CrossCallReturnLabel_46:
   \   000018                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000018   7A20         MOV     R2,#0x20
   \   00001A   7B00         MOV     R3,#0x0
   \   00001C   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   1224          #endif
   1225          #if defined ( REFLECTOR )
   1226            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_47:
   \   00001F                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001F   7A21         MOV     R2,#0x21
   \   000021   7B00         MOV     R3,#0x0
   \   000023   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   1227            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_48:
   \   000026                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000026   7A22         MOV     R2,#0x22
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   1228          #endif  
   1229          }
   \                     ??CrossCallReturnLabel_49:
   \   00002D   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine23_0
   \   000002                ; // Fall through to label ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1230          
   1231          /*********************************************************************
   1232           * @fn      ZDApp_ProcessSecMsg()
   1233           *
   1234           * @brief   Process the incoming security message.
   1235           *
   1236           * @param   msgPtr - message to process
   1237           *
   1238           * @return  none
   1239           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1240          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1241          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1242            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6407         XRL     A,#0x7
   \   00000B   7003         JNZ     ??ZDApp_ProcessSecMsg_0
   1243            {
   1244              case ZDO_ESTABLISH_KEY_CFM:
   1245                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1246                {
   1247                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1248                }
   1249                break;
   1250          
   1251              case ZDO_ESTABLISH_KEY_IND:
   1252                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1253                {
   1254                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1255                  {
   1256                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1257                  }
   1258                }
   1259                break;
   1260          
   1261              case ZDO_TRANSPORT_KEY_IND:
   1262                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1263                {
   1264                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   1265                }
   1266                break;
   1267          
   1268              case ZDO_UPDATE_DEVICE_IND:
   1269                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1270                {
   1271                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   \   00000D                ; Setup parameters for call to function ZDSecMgrUpdateDeviceInd
   \   00000D   12....       LCALL   ??ZDSecMgrUpdateDeviceInd?relay
   1272                }
   1273                break;
   1274          
   1275              case ZDO_REMOVE_DEVICE_IND:
   1276                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1277                {
   1278                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1279                }
   1280                break;
   1281          
   1282              case ZDO_REQUEST_KEY_IND:
   1283                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1284                {
   1285                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1286                  {
   1287                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1288                  }
   1289                }
   1290                break;
   1291          
   1292              case ZDO_SWITCH_KEY_IND:
   1293                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1294                {
   1295                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   1296                }
   1297                break;
   1298              
   1299              case ZDO_AUTHENTICATE_IND:
   1300                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1301                {
   1302                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1303                }
   1304                break;
   1305          
   1306              case ZDO_AUTHENTICATE_CFM:
   1307                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1308                {
   1309                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1310                }
   1311                break;
   1312          
   1313              default:
   1314                // Unsupported messages
   1315                break;
   1316            }
   1317          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   1318          
   1319          /*********************************************************************
   1320           * @fn      ZDApp_ProcessNetworkJoin()
   1321           *
   1322           * @brief
   1323           *
   1324           *   Save off the Network key information.
   1325           *
   1326           * @param   none
   1327           *
   1328           * @return  none
   1329           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1330          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1331          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1332            // devState 在 ZDO_StartDevice() 函数中改变状态值
   1333            if ( (devState == DEV_NWK_JOINING) ||
   1334                ((devState == DEV_NWK_ORPHAN)  &&
   1335                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1336            {
   1337              // Result of a Join attempt by this device.
   1338              // nwkStatus 在 ZDO_JoinConfirmCB() 函数中改变状态值，
   1339              // 实际来自于 NLME_JoinRequest() 函数的返回结果，此返回
   1340              // 结果被反馈给了 ZDO_JoinConfirmCB()
   1341              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   703A         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1342              {
   1343                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine8 & 0xFFFF
   1344          
   1345          #if defined ( POWER_SAVING )
   1346                osal_pwrmgr_device( PWRMGR_BATTERY );
   1347          #endif
   1348          
   1349                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1350                {
   1351                  // wait for auth from trust center!!
   1352                  devState = DEV_END_DEVICE_UNAUTH;
   1353          
   1354                  // Start the reset timer for MAX UNAUTH time
   1355                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1356                }
   1357                else
   1358                {
   1359                  if ( ZSTACK_ROUTER_BUILD )
   1360                  {
   1361                    if ( devState == DEV_NWK_ORPHAN 
   1362                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_37:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   640A         XRL     A,#0xa
   \   000036   700D         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000038   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00003B   6010         JZ      ??ZDApp_ProcessNetworkJoin_5
   1363                    {
   1364                      // Change NIB state to router for restore
   1365                      _NIB.nwkState = NWK_ROUTER;
   \   00003D   90....       MOV     DPTR,#_NIB + 35
   \   000040   7408         MOV     A,#0x8
   \   000042   F0           MOVX    @DPTR,A
   \   000043   8008         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1366                    }
   1367                  }
   1368                          
   1369                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1370                  {
   1371                    ZDApp_AnnounceNewAddress();
   \   00004A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00004A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1372                  }
   1373                  
   1374                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00004D   90....       MOV     DPTR,#devState
   \   000050   7406         MOV     A,#0x6
   \   000052   F0           MOVX    @DPTR,A
   1375                  if ( ZSTACK_ROUTER_BUILD )
   1376                  {
   1377                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1378                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000053   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000056   7003         JNZ     $+5
   \   000058   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1379                    {
   1380                      NLME_StartRouterRequest( 0, 0, false );
   \   00005B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00005B   7B00         MOV     R3,#0x0
   \   00005D   7A00         MOV     R2,#0x0
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000064   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1381                    }
   1382                  }
   1383                }
   1384              }
   1385              else
   1386              {
   1387                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6401         XRL     A,#0x1
   \   00006D   7031         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00006F   90....       MOV     DPTR,#retryCnt
   \   000072   E0           MOVX    A,@DPTR
   \   000073   04           INC     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   C3           CLR     C
   \   000076   9403         SUBB    A,#0x3
   \   000078   4026         JC      ??ZDApp_ProcessNetworkJoin_7
   1388                {
   1389                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00007A   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   00007D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00007F   74FF         MOV     A,#-0x1
   \   000081   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000082   600A         JZ      ??ZDApp_ProcessNetworkJoin_9
   \   000084   74FE         MOV     A,#-0x2
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   000089   74FF         MOV     A,#-0x1
   \   00008B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   00008C   7006         JNZ     ??ZDApp_ProcessNetworkJoin_11
   1390                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008E   90....       MOV     DPTR,#devStartMode
   \   000091   E4           CLR     A
   \   000092   800B         SJMP    ??ZDApp_ProcessNetworkJoin_12
   1391                  else
   1392                  {
   1393                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   000094   90....       MOV     DPTR,#devStartMode
   \   000097   7403         MOV     A,#0x3
   \   000099   F0           MOVX    @DPTR,A
   1394                    _tmpRejoinState = true;
   \   00009A   90....       MOV     DPTR,#_tmpRejoinState
   \   00009D   7401         MOV     A,#0x1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   00009F   F0           MOVX    @DPTR,A
   1395                  }
   1396                }
   1397          
   1398                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1399                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   0000A0                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000A0   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   74FE         MOV     A,#-0x2
   \   0000A9   65..         XRL     A,?V0 + 0
   \   0000AB   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000AD   74FF         MOV     A,#-0x1
   \   0000AF   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000B1   700D         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000B3   90....       MOV     DPTR,#_NIB + 20
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FE         XRL     A,#0xfe
   \   0000B9   7003         JNZ     ??ZDApp_ProcessNetworkJoin_15
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   F4           CPL     A
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000BE   6023         JZ      ??ZDApp_ProcessNetworkJoin_16
   1400                {
   1401                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000C0   85..82       MOV     DPL,?XSP + 0
   \   0000C3   85..83       MOV     DPH,?XSP + 1
   \   0000C6   74FE         MOV     A,#-0x2
   \   0000C8   F0           MOVX    @DPTR,A
   \   0000C9   A3           INC     DPTR
   \   0000CA   04           INC     A
   \   0000CB   F0           MOVX    @DPTR,A
   1402                  // Invalidate nwk addr so end device does not use in its data reqs.
   1403                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000CC   90....       MOV     DPTR,#_NIB + 20
   \   0000CF   14           DEC     A
   \   0000D0   F0           MOVX    @DPTR,A
   \   0000D1   A3           INC     DPTR
   \   0000D2   04           INC     A
   \   0000D3   F0           MOVX    @DPTR,A
   1404                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D4                ; Setup parameters for call to function ZMacSetReq
   \   0000D4   85..82       MOV     DPL,?XSP + 0
   \   0000D7   85..83       MOV     DPH,?XSP + 1
   \   0000DA   AA82         MOV     R2,DPL
   \   0000DC   AB83         MOV     R3,DPH
   \   0000DE   7953         MOV     R1,#0x53
   \   0000E0   12....       LCALL   ??ZMacSetReq?relay
   1405                }
   1406          
   1407                // Clear the neighbor Table and network discovery tables.
   1408                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000E3                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000E3   12....       LCALL   ??nwkNeighborInitTable?relay
   1409                NLME_NwkDiscTerm();
   \   0000E6                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000E6   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1410          
   1411                zdoDiscCounter = 1;
   \   0000E9   90....       MOV     DPTR,#zdoDiscCounter
   \   0000EC   7401         MOV     A,#0x1
   \   0000EE   F0           MOVX    @DPTR,A
   1412          
   1413          //      ZDApp_NetworkInit( (uint16)
   1414          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1415          //                          (NWK_START_DELAY * 5)) );
   1416                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1417                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000EF                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000EF                ; Setup parameters for call to function osal_rand
   \   0000EF   02....       LJMP    ??ZDApp_ProcessNetworkJoin_17 & 0xFFFF
   1418              }
   1419            }
   1420            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000F2   E0           MOVX    A,@DPTR
   \   0000F3   6404         XRL     A,#0x4
   \   0000F5   6003         JZ      $+5
   \   0000F7   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1421            {
   1422              // results of an orphaning attempt by this device
   1423              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000FA   90....       MOV     DPTR,#nwkStatus
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   7033         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1424              {
   1425                if ( ZG_SECURE_ENABLED )
   1426                {
   1427                  ZDApp_RestoreNwkKey();
   1428                }
   1429                
   1430                devState = DEV_END_DEVICE;
   \   000100   12....       LCALL   ?Subroutine5 & 0xFFFF
   1431                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1432                // setup Power Manager Device
   1433          #if defined ( POWER_SAVING )
   1434                osal_pwrmgr_device( PWRMGR_BATTERY );
   1435          #endif
   1436          
   1437                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_1:
   \   000103   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000106   E0           MOVX    A,@DPTR
   \   000107   A2E3         MOV     C,0xE0 /* A   */.3
   \   000109   5015         JNC     ??ZDApp_ProcessNetworkJoin_19
   1438                {
   1439                  // The receiver is on, turn network layer polling off.
   1440                  NLME_SetPollRate( 0 );
   \   00010B                ; Setup parameters for call to function NLME_SetPollRate
   \   00010B   7A00         MOV     R2,#0x0
   \   00010D   7B00         MOV     R3,#0x0
   \   00010F   12....       LCALL   ??NLME_SetPollRate?relay
   1441                  NLME_SetQueuedPollRate( 0 );
   \   000112                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000112   7A00         MOV     R2,#0x0
   \   000114   7B00         MOV     R3,#0x0
   \   000116   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1442                  NLME_SetResponseRate( 0 );
   \   000119                ; Setup parameters for call to function NLME_SetResponseRate
   \   000119   7A00         MOV     R2,#0x0
   \   00011B   7B00         MOV     R3,#0x0
   \   00011D   12....       LCALL   ??NLME_SetResponseRate?relay
   1443                }
   1444          
   1445                if ( ZSTACK_ROUTER_BUILD )
   1446                {
   1447                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1448                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000120   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000123   6009         JZ      ??ZDApp_ProcessNetworkJoin_20
   1449                  {
   1450                    NLME_StartRouterRequest( 0, 0, false );
   \   000125                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000125   7B00         MOV     R3,#0x0
   \   000127   7A00         MOV     R2,#0x0
   \   000129   7900         MOV     R1,#0x0
   \   00012B   12....       LCALL   ??NLME_StartRouterRequest?relay
   1451                  }
   1452                }
   1453                
   1454                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   00012E                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00012E   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000131   8057         SJMP    ??ZDApp_ProcessNetworkJoin_6
   1455              }
   1456              else
   1457              {
   1458                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000133   90....       MOV     DPTR,#devStartMode
   \   000136   E0           MOVX    A,@DPTR
   \   000137   6401         XRL     A,#0x1
   \   000139   703B         JNZ     ??ZDApp_ProcessNetworkJoin_21
   1459                {
   1460                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   00013B   90....       MOV     DPTR,#retryCnt
   \   00013E   E0           MOVX    A,@DPTR
   \   00013F   04           INC     A
   \   000140   F0           MOVX    @DPTR,A
   \   000141   C3           CLR     C
   \   000142   9404         SUBB    A,#0x4
   \   000144   5028         JNC     ??ZDApp_ProcessNetworkJoin_22
   1461                  {
   1462                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000146   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000149   7003         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   00014B   74FF         MOV     A,#-0x1
   \   00014D   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00014E   600A         JZ      ??ZDApp_ProcessNetworkJoin_24
   \   000150   74FE         MOV     A,#-0x2
   \   000152   68           XRL     A,R0
   \   000153   7003         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   000155   74FF         MOV     A,#-0x1
   \   000157   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   000158   7007         JNZ     ??ZDApp_ProcessNetworkJoin_26
   1463                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00015A   90....       MOV     DPTR,#devStartMode
   \   00015D   E4           CLR     A
   \                     ??ZDApp_ProcessNetworkJoin_27:
   \   00015E   F0           MOVX    @DPTR,A
   \   00015F   8015         SJMP    ??ZDApp_ProcessNetworkJoin_21
   1464                    else
   1465                    {
   1466                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   000161   90....       MOV     DPTR,#devStartMode
   \   000164   7403         MOV     A,#0x3
   \   000166   F0           MOVX    @DPTR,A
   1467                      _tmpRejoinState = true;
   \   000167   90....       MOV     DPTR,#_tmpRejoinState
   \   00016A   7401         MOV     A,#0x1
   \   00016C   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_27
   1468                    }
   1469                  }
   1470                  // Do a normal join to the network after certain times of rejoin retries
   1471                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00016E   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   000171   E0           MOVX    A,@DPTR
   \   000172   6401         XRL     A,#0x1
   \   000174   60E4         JZ      ??ZDApp_ProcessNetworkJoin_24
   1472                  {
   1473                    devStartMode = MODE_JOIN;
   1474                  }
   1475                }
   1476          
   1477                // Clear the neighbor Table and network discovery tables.
   1478                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   000176                ; Setup parameters for call to function nwkNeighborInitTable
   \   000176   12....       LCALL   ??nwkNeighborInitTable?relay
   1479                NLME_NwkDiscTerm();
   \   000179                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   000179   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1480          
   1481                // setup a retry for later...
   1482                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1483                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   00017C                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00017C                ; Setup parameters for call to function osal_rand
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   00017C   12....       LCALL   ??osal_rand?relay
   \   00017F   EA           MOV     A,R2
   \   000180   547F         ANL     A,#0x7f
   \   000182   2464         ADD     A,#0x64
   \   000184   FA           MOV     R2,A
   \   000185   7B00         MOV     R3,#0x0
   \   000187   12....       LCALL   ??ZDApp_NetworkInit?relay
   1484              }
   1485            }
   1486          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1487            else
   1488            {
   1489              // Assume from address conflict
   1490              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1491              {
   1492                // Notify the network
   1493                ZDApp_AnnounceNewAddress();
   1494                
   1495                // Notify apps
   1496                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1497              }
   1498            }
   1499          #endif
   1500          }
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   00018A   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   90....       MOV     DPTR,#_NIB + 33
   \   000003   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000006   74FF         MOV     A,#-0x1
   \   000008   68           XRL     A,R0
   \   000009   22           RET
   1501          
   1502          /*********************************************************************
   1503           * @fn      ZDApp_SaveNwkKey()
   1504           *
   1505           * @brief   Save off the Network key information.
   1506           *
   1507           * @param   none
   1508           *
   1509           * @return  none
   1510           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1511          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1512          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1513            nwkActiveKeyItems keyItems;
   1514          
   1515            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1516            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1517          
   1518            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1519                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1520          
   1521            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1522          }
   \   000052                REQUIRE ?Subroutine4
   \   000052                ; // Fall through to label ?Subroutine4

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine24_0
   \   000006                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1523          
   1524          /*********************************************************************
   1525           * @fn      ZDApp_ResetNwkKey()
   1526           *
   1527           * @brief   Reset the Network key information in NV.
   1528           *
   1529           * @param   none
   1530           *
   1531           * @return  none
   1532           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1533          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1534          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1535            nwkActiveKeyItems keyItems;
   1536          
   1537            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine18 & 0xFFFF
   1538            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1539                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_27:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1540          }
   \   000023   7415         MOV     A,#0x15
   \   000025   02....       LJMP    ??Subroutine28_0 & 0xFFFF
   1541          
   1542          /*********************************************************************
   1543           * @fn      ZDApp_RestoreNwkKey()
   1544           *
   1545           * @brief
   1546           *
   1547           *   Save off the Network key information.
   1548           *
   1549           * @param   none
   1550           *
   1551           * @return  true if restored from NV, false if not
   1552           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1553          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1554          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1555            nwkActiveKeyItems keyItems;
   1556            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1557          
   1558            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1559                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1560            {
   1561              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   E5..         MOV     A,?V0 + 0
   \   000046   45..         ORL     A,?V0 + 1
   \   000048   45..         ORL     A,?V0 + 2
   \   00004A   45..         ORL     A,?V0 + 3
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1562              {
   1563                // Restore the key information
   1564                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1565                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1566                ret = true;
   \   00005E   0E           INC     R6
   1567              }
   1568          
   1569              // Force a save for the first frame counter increment
   1570              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1571            }
   1572            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine4 & 0xFFFF
   1573          }
   1574          
   1575          /*********************************************************************
   1576           * @fn      ZDApp_ResetTimerStart
   1577           *
   1578           * @brief   Start the reset timer.
   1579           *
   1580           * @param   delay - delay time(ms) before reset
   1581           *
   1582           * @return  none
   1583           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1584          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1585          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1586            // Start the rest timer
   1587            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine12 & 0xFFFF
   1588          }
   \                     ??CrossCallReturnLabel_55:
   \   00000D   80..         SJMP    ?Subroutine2
   1589          
   1590          /*********************************************************************
   1591           * @fn      ZDApp_ResetTimerCancel
   1592           *
   1593           * @brief   Cancel the reset timer.
   1594           *
   1595           * @param   none
   1596           *
   1597           * @return  none
   1598           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1599          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1600          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1601            // Cancel the reset timer
   1602            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1603          }
   \   000010                REQUIRE ?Subroutine2
   \   000010                ; // Fall through to label ?Subroutine2
   1604          
   1605          /*********************************************************************
   1606           * @fn      ZDApp_LeaveCtrlInit
   1607           *
   1608           * @brief   Initialize the leave control logic.
   1609           *
   1610           * @param   none
   1611           *
   1612           * @return  none
   1613           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1614          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1615          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1616            uint8 status;
   1617          
   1618          
   1619            // Initialize control state
   1620            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine6 & 0xFFFF
   1621          
   1622            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1623                                        sizeof(ZDApp_LeaveCtrl),
   1624                                        &ZDApp_LeaveCtrl );
   1625          
   1626            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1627            {
   1628              // Read saved control
   1629              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1630                            0,
   1631                            sizeof( uint8 ),
   1632                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1633            }
   1634          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine29_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   000008   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1635          
   1636          /*********************************************************************
   1637           * @fn      ZDApp_LeaveCtrlSet
   1638           *
   1639           * @brief   Set the leave control logic.
   1640           *
   1641           * @param   ra - reassociate flag
   1642           *
   1643           * @return  none
   1644           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1645          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1646          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1647            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1648          
   1649            if ( ra == TRUE )
   \   00000D   6E           XRL     A,R6
   \   00000E   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1650            {
   1651              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   1652            }
   1653          
   1654            // Write the leave control
   1655            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1656                           0,
   1657                           sizeof( uint8 ),
   1658                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000013                ; Setup parameters for call to function osal_nv_write
   \   000013   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   000016   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000019   78..         MOV     R0,#?V0 + 0
   \   00001B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001E   75..01       MOV     ?V0 + 0,#0x1
   \   000021   75..00       MOV     ?V0 + 1,#0x0
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000029   7C00         MOV     R4,#0x0
   \   00002B   7D00         MOV     R5,#0x0
   \   00002D   7A85         MOV     R2,#-0x7b
   \   00002F   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   000032   02....       LJMP    ??Subroutine28_0 & 0xFFFF
   1659          }
   1660          
   1661          /*********************************************************************
   1662           * @fn      ZDApp_LeaveCtrlBypass
   1663           *
   1664           * @brief   Check if NV restore should be skipped during a leave reset.
   1665           *
   1666           * @param   none
   1667           *
   1668           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1669           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1670          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1671          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1672            uint8 bypass;
   1673          
   1674            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1675            {
   1676              bypass = TRUE;
   1677            }
   1678            else
   1679            {
   1680              bypass = FALSE;
   1681            }
   1682          
   1683            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   33           RLC     A
   \   00000C   F9           MOV     R1,A
   \   00000D   02....       LJMP    ?Subroutine2 & 0xFFFF
   1684          }
   1685          
   1686          /*********************************************************************
   1687           * @fn      ZDApp_LeaveCtrlStartup
   1688           *
   1689           * @brief   Check for startup conditions during a leave reset.
   1690           *
   1691           * @param   state      - devState_t determined by leave control logic
   1692           * @param   startDelay - startup delay
   1693           *
   1694           * @return  none
   1695           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1696          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1697          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1698            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1699          
   1700            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1701            {
   1702              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1703              {
   1704                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1705              }
   1706              else
   1707              {
   1708                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   8A82         MOV     DPL,R2
   \   000027   8B83         MOV     DPH,R3
   \   000029   E4           CLR     A
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1709              }
   1710          
   1711              // Set leave control to initialized state
   1712              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine6 & 0xFFFF
   1713          
   1714              // Write initialized control
   1715              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1716                            0,
   1717                            sizeof( uint8 ),
   1718                            &ZDApp_LeaveCtrl);
   1719            }
   \                     ??CrossCallReturnLabel_3:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1720          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine29_0 & 0xFFFF
   1721          
   1722          /*********************************************************************
   1723           * @fn      ZDApp_LeaveReset
   1724           *
   1725           * @brief   Setup a device reset due to a leave indication/confirm.
   1726           *
   1727           * @param   ra - reassociate flag
   1728           *
   1729           * @return  none
   1730           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1731          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1732          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1733            ZDApp_LeaveCtrlSet( ra );
   \   000005                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000005   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1734          
   1735            ZDApp_ResetTimerStart( 5000 );
   \   000008                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000008   7A88         MOV     R2,#-0x78
   \   00000A   7B13         MOV     R3,#0x13
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1736          }
   \   00000F   80..         SJMP    ??Subroutine26_0
   1737          
   1738          /*********************************************************************
   1739           * @fn      ZDApp_LeaveUpdate
   1740           *
   1741           * @brief   Update local device data related to leaving device.
   1742           *
   1743           * @param   nwkAddr        - NWK address of leaving device
   1744           * @param   extAddr        - EXT address of leaving device
   1745           * @param   removeChildren - remove children of leaving device
   1746           *
   1747           * @return  none
   1748           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1749          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1750                                  uint8 removeChildren )
   1751          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EC           MOV     A,R4
   \   000006   FA           MOV     R2,A
   \   000007   ED           MOV     A,R5
   \   000008   FB           MOV     R3,A
   1752            /*
   1753            AddrMgrEntry_t entry;
   1754            */
   1755            (void)nwkAddr;  // Intentionally unreferenced parameter
   1756          
   1757            // Remove if child
   1758            if ( ZSTACK_ROUTER_BUILD )
   1759            {
   1760              NLME_RemoveChild( extAddr, removeChildren );
   \   000009                ; Setup parameters for call to function NLME_RemoveChild
   \   000009   12....       LCALL   ??NLME_RemoveChild?relay
   1761            }
   1762          
   1763            /*
   1764            // Set NWK address to invalid
   1765            entry.user    = ADDRMGR_USER_DEFAULT;
   1766            entry.nwkAddr = INVALID_NODE_ADDR;
   1767            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1768            AddrMgrEntryUpdate( &entry );
   1769          
   1770            // Check
   1771            if ( removeChildren == TRUE )
   1772            {
   1773              // Set index to INVALID_NODE_ADDR to start search
   1774              entry.index = INVALID_NODE_ADDR;
   1775          
   1776              // Get first entry
   1777              AddrMgrEntryGetNext( &entry );
   1778          
   1779              // Remove all descendents
   1780              while ( entry.index != INVALID_NODE_ADDR )
   1781              {
   1782                // Check NWK address allocation algorithm
   1783                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1784                {
   1785                  // Set NWK address to invalid
   1786                  entry.nwkAddr = INVALID_NODE_ADDR;
   1787                  AddrMgrEntryUpdate( &entry );
   1788                }
   1789          
   1790                // Get next entry
   1791                AddrMgrEntryGetNext( &entry );
   1792              }
   1793            }
   1794            */
   1795          }
   \   00000C   80..         SJMP    ??Subroutine26_0
   1796          
   1797          /*********************************************************************
   1798           * CALLBACK FUNCTIONS
   1799           */
   1800          
   1801          
   1802          /*********************************************************************
   1803           * @fn      ZDApp_SendEventMsg()
   1804           *
   1805           * @brief
   1806           *
   1807           *   Sends a Network Join message
   1808           *
   1809           * @param  cmd - command ID
   1810           * @param  len - length (in bytes) of the buf field
   1811           * @param  buf - buffer for the rest of the message.
   1812           *
   1813           * @return  none
   1814           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000003                REQUIRE ??Subroutine26_0
   \   000003                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1815          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1816          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   1817            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000008                ; Setup parameters for call to function ZDApp_SendMsg
   \   000008   FB           MOV     R3,A
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B   80..         SJMP    ?Subroutine0
   1818          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1819          
   1820          /*********************************************************************
   1821           * @fn      ZDApp_SendMsg()
   1822           *
   1823           * @brief   Sends a OSAL message
   1824           *
   1825           * @param  taskID - Where to send the message
   1826           * @param  cmd - command ID
   1827           * @param  len - length (in bytes) of the buf field
   1828           * @param  buf - buffer for the rest of the message.
   1829           *
   1830           * @return  none
   1831           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1832          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1833          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 6,R2
   \   000009   8B..         MOV     ?V0 + 5,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1834            osal_event_hdr_t *msgPtr;
   1835          
   1836            // Send the address to the task
   1837            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014   75..00       MOV     ?V0 + 1,#0x0
   \   000017                ; Setup parameters for call to function osal_msg_allocate
   \   000017   AA..         MOV     R2,?V0 + 0
   \   000019   AB..         MOV     R3,?V0 + 1
   \   00001B   12....       LCALL   ??osal_msg_allocate?relay
   \   00001E   8A..         MOV     ?V0 + 8,R2
   \   000020   8B..         MOV     ?V0 + 9,R3
   \   000022   AE..         MOV     R6,?V0 + 8
   \   000024   AF..         MOV     R7,?V0 + 9
   1838            if ( msgPtr )
   \   000026   EE           MOV     A,R6
   \   000027   4F           ORL     A,R7
   \   000028   6034         JZ      ??ZDApp_SendMsg_0
   1839            {
   1840              if ( (len > 0) && (buf != NULL) )
   \   00002A   E5..         MOV     A,?V0 + 5
   \   00002C   6020         JZ      ??ZDApp_SendMsg_1
   \   00002E   E5..         MOV     A,?V0 + 2
   \   000030   45..         ORL     A,?V0 + 3
   \   000032   601A         JZ      ??ZDApp_SendMsg_1
   1841                osal_memcpy( msgPtr, buf, len );
   \   000034                ; Setup parameters for call to function osal_memcpy
   \   000034   85....       MOV     ?V0 + 8,?V0 + 2
   \   000037   85....       MOV     ?V0 + 9,?V0 + 3
   \   00003A   75..00       MOV     ?V0 + 10,#0x0
   \   00003D   78..         MOV     R0,#?V0 + 8
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000042   AC..         MOV     R4,?V0 + 0
   \   000044   AD..         MOV     R5,?V0 + 1
   \   000046   12....       LCALL   ??osal_memcpy?relay
   \   000049   7403         MOV     A,#0x3
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
   1842          
   1843              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   E5..         MOV     A,?V0 + 6
   \   000054   F0           MOVX    @DPTR,A
   1844              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000055                ; Setup parameters for call to function osal_msg_send
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   A9..         MOV     R1,?V0 + 4
   \   00005B   12....       LCALL   ??osal_msg_send?relay
   1845            }
   1846          }
   \                     ??ZDApp_SendMsg_0:
   \   00005E   7F0B         MOV     R7,#0xb
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   1847          
   1848          /*********************************************************************
   1849           * Call Back Functions from NWK  - API
   1850           */
   1851          
   1852          /*********************************************************************
   1853           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1854           *
   1855           * @brief       This function returns a choice of PAN to join.
   1856           *
   1857           * @param       ResultCount - Number of routers discovered
   1858           * @param               NetworkList - Pointer to list of network descriptors
   1859           *
   1860           * @return      ZStatus_t
   1861           */
   1862          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1863          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1864                                                   networkDesc_t *NetworkList )
   1865          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 4,R1
   \   00000C   8A..         MOV     ?V0 + 6,R2
   \   00000E   8B..         MOV     ?V0 + 7,R3
   1866            networkDesc_t *pNwkDesc = NetworkList;
   1867            ZDO_NetworkDiscoveryCfm_t msg;
   1868            uint8 i = ResultCount;
   1869            uint8 stackProfile;
   1870            uint8 stackProfilePro;
   1871            uint8 selected;
   1872          
   1873          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1874            if ( zdappMgmtNwkDiscReqInProgress )
   1875            {
   1876              zdappMgmtNwkDiscReqInProgress = false;
   1877              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1878              return ( ZSuccess );
   1879            }
   1880          #endif
   1881          
   1882            // process discovery results
   1883            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1884            selected = FALSE;
   1885          
   1886            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 5,#0x0
   1887            {
   1888              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 6
   \   000018   AF..         MOV     R7,?V0 + 7
   1889              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1890              {
   1891                if ( zgConfigPANID != 0xFFFF )
   1892                {
   1893                  // PAN Id is preconfigured. check if it matches
   1894                  if ( pNwkDesc->panId != zgConfigPANID )
   1895                    continue;
   1896                }
   1897                
   1898          
   1899                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1900                {
   1901                  // If the extended Pan ID is commissioned to a non zero value
   1902                  // Only join the Pan that has match EPID
   1903                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1904                    continue;
   1905                  
   1906                }
   1907          
   1908          
   1909                  // check that network is allowing joining
   1910                  if ( ZSTACK_ROUTER_BUILD )
   1911                  {
   1912                    if ( stackProfilePro == FALSE )
   1913                    {
   1914                      if ( !pNwkDesc->routerCapacity )
   1915                      {
   1916                        continue;
   1917                      }
   1918                    }
   1919                    else
   1920                    {
   1921                      if ( !pNwkDesc->deviceCapacity )
   1922                      {
   1923                        continue;
   1924                      }
   1925                    }
   1926                  }
   1927                  else if ( ZSTACK_END_DEVICE_BUILD )
   1928                  {
   1929                    if ( !pNwkDesc->deviceCapacity )
   1930                    {
   1931                      continue;
   1932                    }
   1933                  }
   1934          
   1935                  // check version of zigbee protocol
   1936                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1937                    continue;
   1938          
   1939                  // check version of stack profile
   1940                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1941                  {
   1942                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1943                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   68           XRL     A,R0
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1944                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   1945                    
   1946                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 5
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_58:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 4
   \   000058   4003         JC      $+5
   \   00005A   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00005D   90....       MOV     DPTR,#zgConfigPANID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F4           CPL     A
   \   000062   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000064   A3           INC     DPTR
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F4           CPL     A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000067   6013         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   000070   90....       MOV     DPTR,#zgConfigPANID
   \   000073   E0           MOVX    A,@DPTR
   \   000074   68           XRL     A,R0
   \   000075   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00007A   70B7         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   00007C                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00007C   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00007E   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000080   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000083   E9           MOV     A,R1
   \   000084   6401         XRL     A,#0x1
   \   000086   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   000088                ; Setup parameters for call to function sAddrExtCmp
   \   000088   AC..         MOV     R4,?V0 + 2
   \   00008A   AD..         MOV     R5,?V0 + 3
   \   00008C   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00008E   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000090   12....       LCALL   ??sAddrExtCmp?relay
   \   000093   E9           MOV     A,R1
   \   000094   609D         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   000096   E5..         MOV     A,?V0 + 8
   \   000098   8E82         MOV     DPL,R6
   \   00009A   8F83         MOV     DPH,R7
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   7005         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   7006         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_13
   \   0000A6   808B         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000A8   A3           INC     DPTR
   \   0000A9   E0           MOVX    A,@DPTR
   \   0000AA   6087         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000AC   85..82       MOV     DPL,?V0 + 0
   \   0000AF   85..83       MOV     DPH,?V0 + 1
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F8           MOV     R0,A
   \   0000B4   90....       MOV     DPTR,#_NIB + 17
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   68           XRL     A,R0
   \   0000B9   6003         JZ      $+5
   \   0000BB   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000BE   8E82         MOV     DPL,R6
   \   0000C0   8F83         MOV     DPH,R7
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   A3           INC     DPTR
   \   0000C5   A3           INC     DPTR
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   F8           MOV     R0,A
   \   0000CC   90....       MOV     DPTR,#zgStackProfile
   \   0000CF   E0           MOVX    A,@DPTR
   \   0000D0   68           XRL     A,R0
   \   0000D1   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   6401         XRL     A,#0x1
   \   0000D6   6003         JZ      $+5
   \   0000D8   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000DB   7402         MOV     A,#0x2
   \   0000DD   68           XRL     A,R0
   \   0000DE   6003         JZ      $+5
   \   0000E0   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000E3   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1947                    {
   1948                      continue;
   1949                    }
   1950                  }
   1951          
   1952                // check if beacon order is the right value..
   1953                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1954                //    continue;
   1955          
   1956                // choose this pan for joining
   1957                break;
   1958              } 
   1959              if (i < ResultCount)
   1960              {
   1961               selected = TRUE;
   1962                break;
   1963              }
   1964             
   1965              // break if selected or stack profile pro wasn't found
   1966              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000E6   E5..         MOV     A,?V0 + 8
   \   0000E8   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_14
   1967              {
   1968                break;
   1969              }
   1970            }
   \   0000EA   05..         INC     ?V0 + 5
   \   0000EC   E5..         MOV     A,?V0 + 5
   \   0000EE   C3           CLR     C
   \   0000EF   9402         SUBB    A,#0x2
   \   0000F1   5003         JNC     $+5
   \   0000F3   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1971          
   1972            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   0000F6   E5..         MOV     A,?V0 + 4
   \   0000F8   65..         XRL     A,?V0 + 9
   \   0000FA   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1973            {
   1974              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000FC   7401         MOV     A,#0x1
   \   0000FE   12....       LCALL   ?XSTACK_DISP0_8
   \   000101   7401         MOV     A,#0x1
   \   000103   F0           MOVX    @DPTR,A
   \   000104   8053         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_15
   1975            }
   1976            else
   1977            {
   1978              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000106   7401         MOV     A,#0x1
   \   000108   12....       LCALL   ?XSTACK_DISP0_8
   \   00010B   E4           CLR     A
   \   00010C   F0           MOVX    @DPTR,A
   1979              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   00010D   8E82         MOV     DPL,R6
   \   00010F   8F83         MOV     DPH,R7
   \   000111   E0           MOVX    A,@DPTR
   \   000112   C0E0         PUSH    A
   \   000114   7402         MOV     A,#0x2
   \   000116   12....       LCALL   ?XSTACK_DISP0_8
   \   000119   D0E0         POP     A
   \   00011B   F0           MOVX    @DPTR,A
   1980              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   00011C   8E82         MOV     DPL,R6
   \   00011E   8F83         MOV     DPH,R7
   \   000120   A3           INC     DPTR
   \   000121   E0           MOVX    A,@DPTR
   \   000122   C0E0         PUSH    A
   \   000124   7403         MOV     A,#0x3
   \   000126   12....       LCALL   ?XSTACK_DISP0_8
   \   000129   D0E0         POP     A
   \   00012B   F0           MOVX    @DPTR,A
   1981              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   00012C   8E82         MOV     DPL,R6
   \   00012E   8F83         MOV     DPH,R7
   \   000130   A3           INC     DPTR
   \   000131   A3           INC     DPTR
   \   000132   E0           MOVX    A,@DPTR
   \   000133   C0E0         PUSH    A
   \   000135   7404         MOV     A,#0x4
   \   000137   12....       LCALL   ?XSTACK_DISP0_8
   \   00013A   D0E0         POP     A
   \   00013C   12....       LCALL   ?Subroutine7 & 0xFFFF
   1982              msg.version = pNwkDesc->version;
   \                     ??CrossCallReturnLabel_4:
   \   00013F   C0E0         PUSH    A
   \   000141   7405         MOV     A,#0x5
   \   000143   12....       LCALL   ?XSTACK_DISP0_8
   \   000146   D0E0         POP     A
   \   000148   F0           MOVX    @DPTR,A
   1983              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000149                ; Setup parameters for call to function sAddrExtCpy
   \   000149   AC..         MOV     R4,?V0 + 2
   \   00014B   AD..         MOV     R5,?V0 + 3
   \   00014D   7406         MOV     A,#0x6
   \   00014F   12....       LCALL   ?XSTACK_DISP0_8
   \   000152   AA82         MOV     R2,DPL
   \   000154   AB83         MOV     R3,DPH
   \   000156   12....       LCALL   ??sAddrExtCpy?relay
   1984            }
   1985          
   1986            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000159                ; Setup parameters for call to function ZDApp_SendMsg
   \   000159   85..82       MOV     DPL,?XSP + 0
   \   00015C   85..83       MOV     DPH,?XSP + 1
   \   00015F   AC82         MOV     R4,DPL
   \   000161   AD83         MOV     R5,DPH
   \   000163   7B0E         MOV     R3,#0xe
   \   000165   7A01         MOV     R2,#0x1
   \   000167   12....       LCALL   ?Subroutine14 & 0xFFFF
   1987          
   1988            return (ZSuccess);
   \                     ??CrossCallReturnLabel_20:
   \   00016A   7900         MOV     R1,#0x0
   \   00016C   740E         MOV     A,#0xe
   \   00016E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000171   7F0A         MOV     R7,#0xa
   \   000173   02....       LJMP    ?BANKED_LEAVE_XDATA
   1989          }  // ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   85..82       MOV     DPL,?V0 + 0
   \   000004   85..83       MOV     DPH,?V0 + 1
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1990          
   1991          /*********************************************************************
   1992           * @fn          ZDO_NetworkFormationConfirmCB
   1993           *
   1994           * @brief       This function reports the results of the request to
   1995           *              initialize a coordinator in a network.
   1996           *
   1997           * @param       Status - Result of NLME_NetworkFormationRequest()
   1998           *
   1999           * @return      none
   2000           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2001          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2002          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2003            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2004          
   2005            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2006            {
   2007              // LED on shows Coordinator started
   2008              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine20 & 0xFFFF
   2009          
   2010              // LED off forgets HOLD_AUTO_START
   2011              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   2012          
   2013          #if defined ( ZBIT )
   2014              SIM_SetColor(0xd0ffd0);
   2015          #endif
   2016          
   2017              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_28:
   \   00000F   700A         JNZ     ??CrossCallReturnLabel_40
   2018              {
   2019                // Began with HOLD_AUTO_START
   2020                devState = DEV_COORD_STARTING;
   \   000011   7408         MOV     A,#0x8
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8005         SJMP    ??CrossCallReturnLabel_40
   2021              }
   2022            }
   2023          #if defined(BLINK_LEDS)
   2024            else
   2025              //HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   2026          #endif
   2027          
   2028            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000016                ; Setup parameters for call to function osal_set_event
   \   000016   7A02         MOV     R2,#0x2
   \   000018   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   2029          }
   \                     ??CrossCallReturnLabel_40:
   \   00001B   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7904         MOV     R1,#0x4
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7908         MOV     R1,#0x8
   \   00000B   12....       LCALL   ??HalLedSet?relay
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
   2030          
   2031          /*********************************************************************
   2032           * @fn          ZDO_StartRouterConfirmCB
   2033           *
   2034           * @brief       This function reports the results of the request to
   2035           *              start functioning as a router in a network.
   2036           *
   2037           * @param       Status - Result of NLME_StartRouterRequest()
   2038           *
   2039           * @return      none
   2040           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2041          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2042          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2043            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2044          
   2045            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   2046            {
   2047              // LED on shows Router started
   2048              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine20 & 0xFFFF
   2049              // LED off forgets HOLD_AUTO_START
   2050              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2051              
   2052              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_29:
   \   00000F   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2053              {
   2054                // Began with HOLD_AUTO_START
   2055                devState = DEV_END_DEVICE;
   \   000011   7406         MOV     A,#0x6
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2056              }
   2057            }
   2058          #if defined(BLINK_LEDS)
   2059            else
   2060              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2061          #endif
   2062          
   2063            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A20         MOV     R2,#0x20
   \   00001F   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   2064          }
   \                     ??CrossCallReturnLabel_41:
   \   000022   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2065          
   2066          /*********************************************************************
   2067           * @fn          ZDO_JoinConfirmCB
   2068           *
   2069           * @brief       This function allows the next hight layer to be notified
   2070           *              of the results of its request to join itself or another
   2071           *              device to a network.
   2072           *
   2073           * @param       Status - Result of NLME_JoinRequest()
   2074           *
   2075           * @return      none
   2076           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2077          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2078          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2079            (void)PanId;  // remove if this parameter is used.
   2080            
   2081            // Status 为 NLME_JoinReques() 函数返回的结果；
   2082            // 若加入网络成功，则为 zSuccess，否则，为 zFailure
   2083            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2084          
   2085            if ( Status == ZSUCCESS ) // 加入网络成功？
   \   00000A   700A         JNZ     ??ZDO_JoinConfirmCB_0
   2086            {
   2087              // LED on shows device joined
   2088              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine20 & 0xFFFF
   2089              // LED off forgets HOLD_AUTO_START
   2090              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2091              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_30:
   \   00000F   700C         JNZ     ??ZDO_JoinConfirmCB_1
   2092              {
   2093                // Began with HOLD_AUTO_START
   2094                devState = DEV_NWK_JOINING;
   \   000011   7403         MOV     A,#0x3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_JoinConfirmCB_1
   2095              }
   2096          
   2097              if ( !ZG_SECURE_ENABLED )
   2098              {
   2099                // Notify to save info into NV
   2100                // 需要在 IAR 中定义 NV_RESTORE 预处理命令
   2101                ZDApp_NVUpdate();
   2102              }
   2103            }
   2104            else
   2105            {
   2106          #if defined(BLINK_LEDS)
   2107              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2108          #endif
   2109            }
   2110          
   2111            // Notify ZDApp
   2112            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00001D   7C00         MOV     R4,#0x0
   \   00001F   7D00         MOV     R5,#0x0
   \   000021   7B02         MOV     R3,#0x2
   \   000023   7A02         MOV     R2,#0x2
   \   000025   02....       LJMP    ?Subroutine0 & 0xFFFF
   2113          }
   2114          
   2115          /*********************************************************************
   2116           * @fn          ZDO_AddrChangeIndicationCB
   2117           *
   2118           * @brief       This function notifies the application that this
   2119           *              device's address has changed.  Could happen in 
   2120           *              a network with stochastic addressing (PRO).
   2121           *
   2122           * @param       newAddr - the new address
   2123           *
   2124           * @return      none
   2125           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2126          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2127          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2128            (void)newAddr;  // remove if this parameter is used
   2129            
   2130            // Notify to save info into NV
   2131            ZDApp_NVUpdate();
   2132          
   2133            // Notify the applications   
   2134            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine8 & 0xFFFF
   2135          
   2136            // Send out a device announce
   2137            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_38:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2138          }
   \   00000A   02....       LJMP    ?Subroutine2 & 0xFFFF
   2139          
   2140          /*********************************************************************
   2141           * @fn          ZDO_JoinIndicationCB
   2142           *
   2143           * @brief       This function allows the next higher layer of a
   2144           *              coordinator to be notified of a remote join request.
   2145           *
   2146           * @param       ShortAddress - 16-bit address
   2147           * @param       ExtendedAddress - IEEE (64-bit) address
   2148           * @param       CapabilityInformation - Association Capability Information
   2149           * @param       type - of joining - 
   2150           *                          NWK_ASSOC_JOIN
   2151           *                          NWK_ASSOC_REJOIN_UNSECURE
   2152           *                          NWK_ASSOC_REJOIN_SECURE
   2153           *
   2154           * @return      ZStatus_t
   2155           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2156          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2157                                          uint8 CapabilityInformation, uint8 type )
   2158          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2159            (void)ShortAddress;
   2160            (void)ExtendedAddress;
   2161            (void)CapabilityInformation;
   2162            
   2163              // Notify to save info into NV
   2164              ZDApp_NVUpdate();
   2165            
   2166              // send notification to TC of new device..
   2167              if ( ZG_SECURE_ENABLED )
   2168              {
   2169                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2170                {
   2171                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2172                }
   2173              }
   2174            
   2175              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine3
   \   000000                ; // Fall through to label ?Subroutine3

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2176          }
   2177          
   2178          /*********************************************************************
   2179           * @fn          ZDO_ConcentratorIndicationCB
   2180           *
   2181           * @brief       This function allows the next higher layer of a
   2182           *              device to be notified of existence of the concentrator.
   2183           *
   2184           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2185           *
   2186           * @return      void 
   2187           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2188          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2189          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2190            // Write your code here to do something with the concentrator's
   2191            // address.
   2192            (void)nwkAddr;
   2193          }
   \   000000   02....       LJMP    ?BRET
   2194          
   2195          /*********************************************************************
   2196           * @fn          ZDO_LeaveCnf
   2197           *
   2198           * @brief       This function allows the next higher layer to be
   2199           *              notified of the results of its request for this or
   2200           *              a child device to leave the network.
   2201           *
   2202           * @param       cnf - NLME_LeaveCnf_t
   2203           *
   2204           * @return      none
   2205           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2206          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2207          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2208            // Check for this device
   2209            if ( osal_ExtAddrEqual( cnf->extAddr,
   2210                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   700C         JNZ     ??ZDO_LeaveCnf_0
   2211            {
   2212              // Prepare to leave with reset
   2213              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   2214            }
   \                     ??CrossCallReturnLabel_59:
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000030   8017         SJMP    ??ZDO_LeaveCnf_1
   2215            else if ( ZSTACK_ROUTER_BUILD )
   2216            {
   2217              // Remove device address(optionally descendents) from data
   2218              ZDApp_LeaveUpdate( cnf->dstAddr,
   2219                                 cnf->extAddr,
   2220                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000032                ; Setup parameters for call to function NLME_RemoveChild
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   AA..         MOV     R2,?V0 + 0
   \   000044   AB..         MOV     R3,?V0 + 1
   \   000046   12....       LCALL   ??NLME_RemoveChild?relay
   2221            }
   2222          }
   \                     ??ZDO_LeaveCnf_1:
   \   000049   02....       LJMP    ??Subroutine29_0 & 0xFFFF
   2223          
   2224          /*********************************************************************
   2225           * @fn          ZDO_LeaveInd
   2226           *
   2227           * @brief       This function allows the next higher layer of a
   2228           *              device to be notified of a remote leave request or
   2229           *              indication.
   2230           *
   2231           * @param       ind - NLME_LeaveInd_t
   2232           *
   2233           * @return      none
   2234           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2235          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2236          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2237            uint8 leave;
   2238          
   2239          
   2240            // Parent is requesting the leave - NWK layer filters out illegal
   2241            // requests
   2242            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240B         ADD     A,#0xb
   \   000011   F8           MOV     R0,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F9           MOV     R1,A
   \   000016   88..         MOV     ?V0 + 0,R0
   \   000018   89..         MOV     ?V0 + 1,R1
   \   00001A   EE           MOV     A,R6
   \   00001B   240C         ADD     A,#0xc
   \   00001D   08           INC     R0
   \   00001E   EF           MOV     A,R7
   \   00001F   3400         ADDC    A,#0x0
   \   000021   F9           MOV     R1,A
   \   000022   88..         MOV     ?V0 + 2,R0
   \   000024   89..         MOV     ?V0 + 3,R1
   \   000026   8E82         MOV     DPL,R6
   \   000028   8F83         MOV     DPH,R7
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   6401         XRL     A,#0x1
   \   000037   702C         JNZ     ??ZDO_LeaveInd_0
   2243            {
   2244              // Notify network of leave
   2245              if ( ZSTACK_ROUTER_BUILD )
   2246              {
   2247                NLME_LeaveRsp_t rsp;
   2248                rsp.rejoin         = ind->rejoin;
   \   000039   8882         MOV     DPL,R0
   \   00003B   8983         MOV     DPH,R1
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   C0E0         PUSH    A
   \   000040   7401         MOV     A,#0x1
   \   000042   12....       LCALL   ?XSTACK_DISP0_8
   \   000045   D0E0         POP     A
   \   000047   12....       LCALL   ?Subroutine7 & 0xFFFF
   2249                rsp.removeChildren = ind->removeChildren;
   \                     ??CrossCallReturnLabel_5:
   \   00004A   85..82       MOV     DPL,?XSP + 0
   \   00004D   85..83       MOV     DPH,?XSP + 1
   \   000050   F0           MOVX    @DPTR,A
   2250                NLME_LeaveRsp( &rsp );
   \   000051                ; Setup parameters for call to function NLME_LeaveRsp
   \   000051   AA82         MOV     R2,DPL
   \   000053   AB83         MOV     R3,DPH
   \   000055   12....       LCALL   ??NLME_LeaveRsp?relay
   2251              }
   2252          
   2253              // Prepare to leave with reset
   2254              ZDApp_LeaveReset( ind->rejoin );
   \   000058                ; Setup parameters for call to function ZDApp_LeaveReset
   \                     ??ZDO_LeaveInd_1:
   \   000058   85..82       MOV     DPL,?V0 + 2
   \   00005B   85..83       MOV     DPH,?V0 + 3
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   F9           MOV     R1,A
   \   000060   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000063   802D         SJMP    ??ZDO_LeaveInd_2
   2255            }
   2256            else
   2257            {
   2258              leave = FALSE;
   2259          
   2260              // Check if this device needs to leave as a child or descendent
   2261              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000065                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000065   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000068   85..82       MOV     DPL,?V0 + 0
   \   00006B   85..83       MOV     DPH,?V0 + 1
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F9           MOV     R1,A
   \   000070   8E82         MOV     DPL,R6
   \   000072   8F83         MOV     DPH,R7
   \   000074   E0           MOVX    A,@DPTR
   \   000075   6A           XRL     A,R2
   \   000076   7003         JNZ     ??ZDO_LeaveInd_3
   \   000078   A3           INC     DPTR
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   00007B   700A         JNZ     ??ZDO_LeaveInd_4
   2262              {
   2263                if ( ( ind->removeChildren == TRUE               ) ||
   2264                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2265                       NODETYPE_DEVICE                           )    )
   \   00007D   7401         MOV     A,#0x1
   \   00007F   69           XRL     A,R1
   \   000080   60D6         JZ      ??ZDO_LeaveInd_1
   \   000082   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000085   60D1         JZ      ??ZDO_LeaveInd_1
   2266                {
   2267                  leave = TRUE;
   2268                }
   2269              }
   2270              else if ( ind->removeChildren == TRUE )
   2271              {
   2272                // Check NWK address allocation algorithm
   2273                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2274              }
   2275          
   2276              if ( leave == TRUE )
   2277              {
   2278                // Prepare to leave with reset
   2279                ZDApp_LeaveReset( ind->rejoin );
   \   000087                ; Setup parameters for call to function ZDApp_LeaveReset
   2280              }
   2281              else
   2282              {
   2283                // Remove device address(optionally descendents) from data
   2284                ZDApp_LeaveUpdate( ind->srcAddr,
   2285                                   ind->extAddr,
   2286                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   000087                ; Setup parameters for call to function NLME_RemoveChild
   \   000087   EE           MOV     A,R6
   \   000088   2402         ADD     A,#0x2
   \   00008A   FA           MOV     R2,A
   \   00008B   EF           MOV     A,R7
   \   00008C   3400         ADDC    A,#0x0
   \   00008E   FB           MOV     R3,A
   \   00008F   12....       LCALL   ??NLME_RemoveChild?relay
   2287              }
   2288            }
   2289          }
   \                     ??ZDO_LeaveInd_2:
   \   000092   7402         MOV     A,#0x2
   \   000094   12....       LCALL   ?DEALLOC_XSTACK8
   \   000097   7F06         MOV     R7,#0x6
   \   000099   02....       LJMP    ?BANKED_LEAVE_XDATA
   2290          
   2291          /*********************************************************************
   2292           * @fn          ZDO_SyncIndicationCB
   2293           *
   2294           * @brief       This function allows the next higher layer of a
   2295           *              coordinator to be notified of a loss of synchronization
   2296           *                          with the parent/child device.
   2297           *
   2298           * @param       type: 0 - child; 1 - parent
   2299           *
   2300           *
   2301           * @return      none
   2302           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2303          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2304          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2305            (void)shortAddr;  // Remove this line if this parameter is used.
   2306            
   2307            if ( ZSTACK_END_DEVICE_BUILD
   2308              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000007   90....       MOV     DPTR,#_NIB + 14
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   4013         JC      ??CrossCallReturnLabel_21
   2309            {
   2310              if ( type == 1 )
   \   00000F   7401         MOV     A,#0x1
   \   000011   6E           XRL     A,R6
   \   000012   700E         JNZ     ??CrossCallReturnLabel_21
   2311              {
   2312                // We lost contact with our parent.  Clear the neighbor Table.
   2313                nwkNeighborInitTable();
   \   000014                ; Setup parameters for call to function nwkNeighborInitTable
   \   000014   12....       LCALL   ??nwkNeighborInitTable?relay
   2314                
   2315                // Start the rejoin process.
   2316                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000017                ; Setup parameters for call to function ZDApp_SendMsg
   \   000017   7C00         MOV     R4,#0x0
   \   000019   7D00         MOV     R5,#0x0
   \   00001B   7B02         MOV     R3,#0x2
   \   00001D   7A03         MOV     R2,#0x3
   \   00001F   12....       LCALL   ?Subroutine14 & 0xFFFF
   2317              }
   2318            }
   2319          }
   \                     ??CrossCallReturnLabel_21:
   \   000022   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2320          
   2321          /*********************************************************************
   2322           * @fn          ZDO_ManytoOneFailureIndicationCB
   2323           *
   2324           * @brief       This function allows the next higher layer of a
   2325           *              concentrator to be notified of a many-to-one route 
   2326           *              failure. 
   2327           *
   2328           * @param       none
   2329           *
   2330           *
   2331           * @return      none
   2332           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2333          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2334          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2335            // By default, the concentrator automatically redo many-to-one route 
   2336            // discovery to update all many-to-one routes in the network
   2337            // If you want anything processing other than the default,
   2338            // please replace the following code.
   2339            
   2340            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2341          }
   \   000007   02....       LJMP    ?Subroutine2 & 0xFFFF
   2342          
   2343          
   2344          /*********************************************************************
   2345           * @fn          ZDO_PollConfirmCB
   2346           *
   2347           * @brief       This function allows the next higher layer to be
   2348           *              notified of a Poll Confirm.
   2349           *
   2350           * @param       none
   2351           *
   2352           * @return      none
   2353           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2354          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2355          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2356            (void)status;  // Remove this line if this parameter is used.
   2357            return;
   \   000000   02....       LJMP    ?BRET
   2358          }
   2359          
   2360          /******************************************************************************
   2361           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2362           *
   2363           * @brief       Stub routine implemented by NHLE. NHLE should call
   2364           *              <AddrMgrWriteNV> when appropriate.
   2365           *
   2366           * @param       none
   2367           *
   2368           * @return      none
   2369           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2370          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2371          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2372          #if defined ( NV_RESTORE )  
   2373            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2374            {
   2375              // Trigger to save info into NV
   2376              ZDApp_NVUpdate();
   2377            }
   2378          #endif
   2379          }
   \   000000   02....       LJMP    ?BRET
   2380          
   2381          /*********************************************************************
   2382           * Call Back Functions from Security  - API
   2383           */
   2384          
   2385           /*********************************************************************
   2386           * @fn          ZDO_UpdateDeviceIndication
   2387           *
   2388           * @brief       This function notifies the "Trust Center" of a
   2389           *              network when a device joins or leaves the network.
   2390           *
   2391           * @param       extAddr - pointer to 64 bit address of new device
   2392           * @param       status  - 0 if a new device joined securely
   2393           *                      - 1 if a new device joined un-securely
   2394           *                      - 2 if a device left the network
   2395           *
   2396           * @return      true if newly joined device should be allowed to
   2397           *                                              remain on network
   2398           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2399          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2400          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2401            // can implement a network access policy based on the
   2402            // IEEE address of newly joining devices...
   2403            (void)extAddr;
   2404            (void)status;
   2405            
   2406            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine3 & 0xFFFF
   2407          }
   2408          
   2409          /*********************************************************************
   2410           * @fn          ZDApp_InMsgCB
   2411           *
   2412           * @brief       This function is called to pass up any message that is
   2413           *              not yet supported.  This allows for the developer to
   2414           *              support features themselves..
   2415           *
   2416           * @return      none
   2417           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2418          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2419          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2420            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   00000F   F9           MOV     R1,A
   \   000010   5480         ANL     A,#0x80
   \   000012   7045         JNZ     ??ZDApp_InMsgCB_0
   2421            {
   2422              // Handle the response message
   2423            }
   2424            else
   2425            {
   2426              // Handle the request message by sending a generic "not supported".
   2427              // Device Announce doesn't have a response.
   2428              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000014   EE           MOV     A,R6
   \   000015   240B         ADD     A,#0xb
   \   000017   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_60:
   \   00001A   703D         JNZ     ??ZDApp_InMsgCB_0
   \   00001C   7413         MOV     A,#0x13
   \   00001E   68           XRL     A,R0
   \   00001F   7001         JNZ     ??ZDApp_InMsgCB_1
   \   000021   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_1:
   \   000022   6035         JZ      ??ZDApp_InMsgCB_0
   2429              {
   2430                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2431                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000024                ; Setup parameters for call to function ZDP_GenericRsp
   \   000024   E8           MOV     A,R0
   \   000025   F5..         MOV     ?V0 + 0,A
   \   000027   E9           MOV     A,R1
   \   000028   4480         ORL     A,#0x80
   \   00002A   F5..         MOV     ?V0 + 1,A
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   E4           CLR     A
   \   000032   F5..         MOV     ?V0 + 0,A
   \   000034   F5..         MOV     ?V0 + 1,A
   \   000036   78..         MOV     R0,#?V0 + 0
   \   000038   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003B   EE           MOV     A,R6
   \   00003C   240E         ADD     A,#0xe
   \   00003E   12....       LCALL   ??Subroutine27_0 & 0xFFFF
   2432              }
   2433            }
   \                     ??CrossCallReturnLabel_61:
   \   000041   FD           MOV     R5,A
   \   000042   7C84         MOV     R4,#-0x7c
   \   000044   EE           MOV     A,R6
   \   000045   2402         ADD     A,#0x2
   \   000047   0A           INC     R2
   \   000048   0A           INC     R2
   \   000049   EF           MOV     A,R7
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FB           MOV     R3,A
   \   00004D   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_63:
   \   000050   F9           MOV     R1,A
   \   000051   12....       LCALL   ??ZDP_GenericRsp?relay
   \   000054   7404         MOV     A,#0x4
   \   000056   12....       LCALL   ?DEALLOC_XSTACK8
   2434          }
   \                     ??ZDApp_InMsgCB_0:
   \   000059   02....       LJMP    ??Subroutine29_0 & 0xFFFF
   2435          
   2436          
   2437          /*********************************************************************
   2438           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2439           *
   2440           * @brief   Changes the Match Descriptor Response permission.
   2441           *
   2442           * @param   endpoint - endpoint to allow responses
   2443           * @param   action - true to allow responses, false to not
   2444           *
   2445           * @return  none
   2446           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2447          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2448          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   2449            // Store the action
   2450            afSetMatch( endpoint, action );
   \   000005                ; Setup parameters for call to function afSetMatch
   \   000005   12....       LCALL   ??afSetMatch?relay
   2451          }
   \   000008   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2452          
   2453          /*********************************************************************
   2454           * @fn      ZDApp_NetworkInit()
   2455           *
   2456           * @brief   Used to start the network joining process
   2457           *
   2458           * @param   delay - mSec delay to wait before starting
   2459           *
   2460           * @return  none
   2461           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2462          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2463          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2464            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   4B           ORL     A,R3
   \   000006   600B         JZ      ??ZDApp_NetworkInit_0
   2465            {
   2466              // Wait awhile before starting the device
   2467              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   000008                ; Setup parameters for call to function osal_start_timerEx
   \   000008   EA           MOV     A,R2
   \   000009   FC           MOV     R4,A
   \   00000A   EB           MOV     A,R3
   \   00000B   FD           MOV     R5,A
   \   00000C   7A01         MOV     R2,#0x1
   \   00000E   12....       LCALL   ?Subroutine12 & 0xFFFF
   2468            }
   \                     ??CrossCallReturnLabel_56:
   \   000011   8005         SJMP    ??CrossCallReturnLabel_42
   2469            else
   2470            {
   2471              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000013                ; Setup parameters for call to function osal_set_event
   \   000013   7A01         MOV     R2,#0x1
   \   000015   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   2472            }
   2473          }
   \                     ??CrossCallReturnLabel_42:
   \   000018   02....       LJMP    ?Subroutine2 & 0xFFFF
   2474          
   2475          /*********************************************************************
   2476           * @fn      ZDApp_NwkStateUpdateCB()
   2477           *
   2478           * @brief   This function notifies that this device's network 
   2479           *          state info has been changed.
   2480           *
   2481           * @param   none
   2482           *
   2483           * @return  none
   2484           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2485          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2486          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2487            // Notify to save info into NV
   2488            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2489            {
   2490              // Trigger to save info into NV
   2491              ZDApp_NVUpdate();
   2492            }
   2493          }
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   2494          
   2495          /*********************************************************************
   2496           * @fn      ZDApp_NodeProfileSync()
   2497           *
   2498           * @brief   Sync node with stack profile.
   2499           *
   2500           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2501           *
   2502           * @return  none
   2503           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2504          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2505          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2506            networkDesc_t* desc;
   2507            uint16         panID;
   2508          
   2509            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5056         JNC     ??ZDApp_NodeProfileSync_0
   2510            {
   2511              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2512          
   2513              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2514          
   2515              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   4583         ORL     A,DPH
   \   00003D   6024         JZ      ??ZDApp_NodeProfileSync_0
   2516              {
   2517                if ( desc->stackProfile != zgStackProfile )
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F8           MOV     R0,A
   \   000049   90....       MOV     DPTR,#zgStackProfile
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   68           XRL     A,R0
   \   00004E   6013         JZ      ??ZDApp_NodeProfileSync_0
   2518                {
   2519                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000050   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000053   E0           MOVX    A,@DPTR
   \   000054   54F8         ANL     A,#0xf8
   \   000056   4402         ORL     A,#0x2
   \   000058   F0           MOVX    @DPTR,A
   2520                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   000059   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00005C   740C         MOV     A,#0xc
   \   00005E   F0           MOVX    @DPTR,A
   2521                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   00005F                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   00005F   F9           MOV     R1,A
   \   000060   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2522                }
   2523              }
   2524            }
   2525          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000063   80..         SJMP    ??Subroutine29_0
   2526          
   2527          /*********************************************************************
   2528           * @fn      ZDApp_StartJoiningCycle()
   2529           *
   2530           * @brief   Starts the joining cycle of a device.  This will only 
   2531           *          continue an already started (or stopped) joining cycle.
   2532           *
   2533           * @param   none
   2534           *
   2535           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2536           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2537          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2538          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2539            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2540            {
   2541              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   7401         MOV     A,#0x1
   \   000016   F0           MOVX    @DPTR,A
   2542              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2543          
   2544              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2545            }
   2546            else
   2547              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ?Subroutine2 & 0xFFFF
   2548          }
   2549          
   2550          /*********************************************************************
   2551           * @fn      ZDApp_StopJoiningCycle()
   2552           *
   2553           * @brief   Stops the joining or rejoining process of a device.
   2554           *
   2555           * @param   none
   2556           *
   2557           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2558           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2559          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2560          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2561            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2562            {
   2563              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
   2564              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2565            }
   2566            else
   2567              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ?Subroutine2 & 0xFFFF
   2568          }
   2569          
   2570          /*********************************************************************
   2571           * @fn      ZDApp_AnnounceNewAddress()
   2572           *
   2573           * @brief   Send Device Announce and hold all transmissions for 
   2574           *          new address timeout.
   2575           *
   2576           * @param   none
   2577           *
   2578           * @return  none
   2579           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2580          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2581          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2582          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2583            // Turn off data request hold
   2584            APSME_HoldDataRequests( 0 );
   2585          #endif
   2586            
   2587            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2588                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine28_0
   2589            
   2590          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2591            // Setup the timeout
   2592            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2593          #endif  
   2594          }
   2595          
   2596          /*********************************************************************
   2597           * @fn          ZDApp_NVUpdate
   2598           *
   2599           * @brief       Set the NV Update Timer.
   2600           *
   2601           * @param       none
   2602           *
   2603           * @return      none
   2604           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2605          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2606          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2607          #if defined ( NV_RESTORE )
   2608            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2609          #endif
   2610          }
   \   000000   02....       LJMP    ?BRET
   2611          
   2612          /*********************************************************************
   2613           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2614           *
   2615           * @brief   Returns a PAN ID for the network layer to use during
   2616           *          a coordinator start and there is another network with 
   2617           *          the intended PANID.
   2618           *
   2619           * @param   panid - the intended PAN ID
   2620           *
   2621           * @return  PANID to try
   2622           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2623          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2624          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2625            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   0A           INC     R2
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   2626          }
   2627          
   2628          /*********************************************************************
   2629           * @fn          ZDO_SrcRtgIndCB
   2630           *
   2631           * @brief       This function notifies the ZDO available src route record received.
   2632           *
   2633           * @param       srcAddr - source address of the source route
   2634           * @param       relayCnt - number of devices in the relay list
   2635           * @param       relayList - relay list of the source route
   2636           *
   2637           * @return      none
   2638           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2639          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2640          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2641            zdoSrcRtg_t srcRtg;
   2642            
   2643            srcRtg.srcAddr = srcAddr;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   2644            srcRtg.relayCnt = relayCnt;
   \   000015   7402         MOV     A,#0x2
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   E9           MOV     A,R1
   \   00001B   F0           MOVX    @DPTR,A
   2645            srcRtg.pRelayList = pRelayList;
   \   00001C   7403         MOV     A,#0x3
   \   00001E   12....       LCALL   ?XSTACK_DISP0_8
   \   000021   EC           MOV     A,R4
   \   000022   F0           MOVX    @DPTR,A
   \   000023   A3           INC     DPTR
   \   000024   ED           MOV     A,R5
   \   000025   F0           MOVX    @DPTR,A
   2646            
   2647            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   000026   90....       MOV     DPTR,#zdoCBFunc
   \   000029   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   00002C   6015         JZ      ??ZDO_SrcRtgIndCB_0
   2648            {
   2649              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   00002E                ; Setup parameters for indirect call
   \   00002E   85..82       MOV     DPL,?XSP + 0
   \   000031   85..83       MOV     DPH,?XSP + 1
   \   000034   AA82         MOV     R2,DPL
   \   000036   AB83         MOV     R3,DPH
   \   000038   90....       MOV     DPTR,#zdoCBFunc + 1
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   F583         MOV     DPH,A
   \   00003E   8882         MOV     DPL,R0
   \   000040   12....       LCALL   ?CALL_IND
   2650            }
   2651          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000043   7405         MOV     A,#0x5
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   \   000048   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2652          
   2653          
   2654          /*********************************************************************
   2655           * @fn          ZDO_RegisterForZdoCB
   2656           *
   2657           * @brief       Call this function to register the higher layer (for 
   2658           *              example, the Application layer or MT layer) with ZDO 
   2659           *              callbacks to get notified of some ZDO indication like
   2660           *              existence of a concentrator or receipt of a source 
   2661           *              route record.
   2662           *
   2663           * @param       indID - ZDO Indication ID
   2664           * @param       pFn   - Callback function pointer
   2665           *
   2666           * @return      ZSuccess - successful, ZInvalidParameter if not
   2667           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2668          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2669          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   2670            // Check the range of the indication ID
   2671            if ( indID < MAX_ZDO_CB_FUNC )
   \   000005   700C         JNZ     ??ZDO_RegisterForZdoCB_0
   2672            {
   2673              zdoCBFunc[indID] = pFn;
   \   000007   90....       MOV     DPTR,#zdoCBFunc
   \   00000A   EA           MOV     A,R2
   \   00000B   F0           MOVX    @DPTR,A
   \   00000C   A3           INC     DPTR
   \   00000D   EB           MOV     A,R3
   \   00000E   F0           MOVX    @DPTR,A
   2674              return ZSuccess;
   \   00000F   7900         MOV     R1,#0x0
   \   000011   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2675            }
   2676            
   2677            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000013   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000015   02....       LJMP    ?Subroutine2 & 0xFFFF
   2678          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devStartMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2679          
   2680          /*********************************************************************
   2681          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      9
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> ZDAppCheckForHoldKey          0      0     18
       -> ZDO_Init                      0      0     18
       -> afRegister                    0      0     18
       -> ZDOInitDevice                 0      0     18
       -> HalLedBlink                   0      0     18
       -> ZDApp_RegisterCBs             0      0     18
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             0      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   0      0     25
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0      9
       -> NLME_RemoveChild              0      0     18
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     12
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     10
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     54
       -> ZDO_ParseAddrRsp              0      0    108
       -> ZDO_UpdateAddrManager         0      0    108
       -> osal_mem_free                 0      0    108
       -> ZDO_ParseBindUnbindReq        0      0    108
       -> ZDO_ProcessBindUnbindReq      0      0    108
       -> ZDMatchSendState              0      0    108
       -> ZDO_ParseEndDeviceBindReq     0      0    108
       -> ZDO_MatchEndDeviceBind        0      0    108
       -> osal_mem_free                 0      0    108
       -> osal_mem_free                 0      0    108
     ZDApp_ProcessNetworkJoin           0      0     12
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               2      0     10
       -> ZDP_IncomingData              4      0      0
       -> ZDApp_ProcessMsgCBs           4      0      0
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrUpdateDeviceInd       4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      9
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      9
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      0      0      9
       -> ZDSecMgrInit                  0      0     18
     ZDApp_SendEventMsg                 0      0      9
       -> ZDApp_SendMsg                 0      0     18
     ZDApp_SendMsg                      1      0     54
       -> osal_msg_allocate             0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_msg_send                 0      0     38
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> osal_start_timerEx            0      0     20
     ZDOInitDevice                      0      0     21
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_LeaveInd                       1      0     16
       -> NLME_LeaveRsp                 0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_GetCoordShortAddr        0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_RemoveChild              0      0     32
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     14
     ZDO_StartRouterConfirmCB           0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      2
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    75
     ??Subroutine26_0                               5
     ZDApp_SecInit                                 11
     ZDApp_event_loop                             218
     ?Subroutine8                                   2
     ??Subroutine22_0                              11
     ??Subroutine25_0                               6
     ??Subroutine29_0                               5
     ZDApp_ProcessSecEvent                        106
     ?Subroutine21                                  6
     ?Subroutine12                                  5
     ZDOInitDevice                                146
     ?Subroutine1                                   2
     ??Subroutine28_0                               3
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ?Subroutine2                                   7
     ZDApp_NetworkStartEvt                         79
     ZDApp_DeviceAuthEvt                           58
     ?Subroutine13                                  6
     ?Subroutine11                                  9
     ?Subroutine5                                  19
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     76
     ?Subroutine10                                  6
     ZDApp_InitUserDesc                            93
     ?Subroutine18                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                          52
     ZDApp_ProcessMsgCBs                          268
     ?Subroutine17                                  3
     ??Subroutine27_0                               9
     ?Subroutine16                                 12
     ZDApp_RegisterCBs                             48
     ?Subroutine9                                   2
     ??Subroutine23_0                               9
     ZDApp_ProcessSecMsg                           19
     ZDApp_ProcessNetworkJoin                     397
     ?Subroutine15                                 10
     ZDApp_SaveNwkKey                              82
     ?Subroutine4                                  10
     ?Subroutine19                                  6
     ??Subroutine24_0                               8
     ZDApp_ResetNwkKey                             40
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         15
     ZDApp_ResetTimerCancel                        16
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine6                                  14
     ZDApp_LeaveCtrlSet                            53
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              17
     ZDApp_LeaveUpdate                             14
     ?Subroutine0                                   3
     ZDApp_SendEventMsg                            13
     ?Subroutine14                                  9
     ZDApp_SendMsg                                 99
     ZDO_NetworkDiscoveryConfirmCB                374
     ?Subroutine7                                   9
     ZDO_NetworkFormationConfirmCB                 30
     ?Subroutine20                                 19
     ZDO_StartRouterConfirmCB                      37
     ZDO_JoinConfirmCB                             40
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine3                                   5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  76
     ZDO_LeaveInd                                 156
     ZDO_SyncIndicationCB                          37
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 92
     ZDApp_ChangeMatchDescRespPermission
                                                   11
     ZDApp_NetworkInit                             27
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        101
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               75
     ZDO_RegisterForZdoCB                          24
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for devStartMode>                1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 3 890 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    12 bytes in segment XDATA_I
    12 bytes in segment XDATA_ID
     8 bytes in segment XDATA_ROM_C
    42 bytes in segment XDATA_Z
 
 4 244 bytes of CODE  memory
     0 bytes of CONST memory (+ 8 bytes shared)
     0 bytes of DATA  memory (+ 2 bytes shared)
    54 bytes of XDATA memory

Errors: none
Warnings: none
